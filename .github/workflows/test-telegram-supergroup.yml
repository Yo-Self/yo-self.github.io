name: Test Telegram Supergroup Notifications

on:
  workflow_dispatch:
  schedule:
    - cron: '0 12 * * 1'  # Toda segunda-feira Ã s 12:00

jobs:
  test-notification:
    runs-on: ubuntu-latest
    steps:
      - name: Test Telegram API with message_thread_id
        run: |
          # Teste usando a API direta do Telegram com message_thread_id
          curl -X POST \
            "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
            -H "Content-Type: application/json" \
            -d '{
              "chat_id": "${{ secrets.TELEGRAM_CHAT_ID }}",
              "message_thread_id": 2,
              "text": "ğŸ§ª **Teste de NotificaÃ§Ã£o - Supergrupo**\n\nâœ… Esta mensagem deve aparecer na aba CI/CD\n\nğŸ”§ Teste realizado via API direta do Telegram\n\nâ° Data: $(date)",
              "parse_mode": "Markdown"
            }'
        
      - name: Test with HTML formatting
        run: |
          # Teste alternativo com formataÃ§Ã£o HTML
          curl -X POST \
            "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
            -H "Content-Type: application/json" \
            -d '{
              "chat_id": "${{ secrets.TELEGRAM_CHAT_ID }}",
              "message_thread_id": 2,
              "text": "<b>ğŸ§ª Teste de NotificaÃ§Ã£o - Supergrupo</b>\n\nâœ… Esta mensagem deve aparecer na aba CI/CD\n\nğŸ”§ Teste realizado via API direta do Telegram\n\nâ° Data: $(date)",
              "parse_mode": "HTML"
            }'
        
      - name: Verify response
        run: |
          echo "âœ… Teste de notificaÃ§Ã£o concluÃ­do!"
          echo "ğŸ“± Verifique se as mensagens apareceram na aba CI/CD do supergrupo"
          echo "ğŸ”— Chat ID: ${{ secrets.TELEGRAM_CHAT_ID }}"
          echo "ğŸ“Œ Message Thread ID: 2 (aba CI/CD)"
