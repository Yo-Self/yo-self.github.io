name: Test Telegram Supergroup Notifications

on:
  workflow_dispatch:
  schedule:
    - cron: '0 12 * * 1'  # Toda segunda-feira às 12:00

jobs:
  test-notification:
    runs-on: ubuntu-latest
    steps:
      - name: Test Telegram API with message_thread_id
        run: |
          # Teste usando a API direta do Telegram com message_thread_id
          curl -X POST \
            "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
            -H "Content-Type: application/json" \
            -d '{
              "chat_id": "${{ secrets.TELEGRAM_CHAT_ID }}",
              "message_thread_id": 2,
              "text": "🧪 **Teste de Notificação - Supergrupo**\n\n✅ Esta mensagem deve aparecer na aba CI/CD\n\n🔧 Teste realizado via API direta do Telegram\n\n⏰ Data: $(date)",
              "parse_mode": "Markdown"
            }'
        
      - name: Test with HTML formatting
        run: |
          # Teste alternativo com formatação HTML
          curl -X POST \
            "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
            -H "Content-Type: application/json" \
            -d '{
              "chat_id": "${{ secrets.TELEGRAM_CHAT_ID }}",
              "message_thread_id": 2,
              "text": "<b>🧪 Teste de Notificação - Supergrupo</b>\n\n✅ Esta mensagem deve aparecer na aba CI/CD\n\n🔧 Teste realizado via API direta do Telegram\n\n⏰ Data: $(date)",
              "parse_mode": "HTML"
            }'
        
      - name: Verify response
        run: |
          echo "✅ Teste de notificação concluído!"
          echo "📱 Verifique se as mensagens apareceram na aba CI/CD do supergrupo"
          echo "🔗 Chat ID: ${{ secrets.TELEGRAM_CHAT_ID }}"
          echo "📌 Message Thread ID: 2 (aba CI/CD)"
