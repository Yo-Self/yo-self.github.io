name: Check Secrets Configuration

on:
  workflow_dispatch:

jobs:
  check-secrets:
    runs-on: ubuntu-latest
    steps:
      - name: Check if secrets exist
        run: |
          echo "üîç Verificando configura√ß√£o dos secrets..."
          echo ""
          
          # Verificar TELEGRAM_BOT_TOKEN
          if [ -n "${{ secrets.TELEGRAM_BOT_TOKEN }}" ]; then
            echo "‚úÖ TELEGRAM_BOT_TOKEN: CONFIGURADO"
            echo "   Comprimento: ${#TELEGRAM_BOT_TOKEN} caracteres"
            echo "   Primeiros 20 chars: ${TELEGRAM_BOT_TOKEN:0:20}..."
          else
            echo "‚ùå TELEGRAM_BOT_TOKEN: N√ÉO CONFIGURADO"
          fi
          
          echo ""
          
          # Verificar TELEGRAM_CHAT_ID
          if [ -n "${{ secrets.TELEGRAM_CHAT_ID }}" ]; then
            echo "‚úÖ TELEGRAM_CHAT_ID: CONFIGURADO"
            echo "   Valor: $TELEGRAM_CHAT_ID"
            echo "   Comprimento: ${#TELEGRAM_CHAT_ID} caracteres"
          else
            echo "‚ùå TELEGRAM_CHAT_ID: N√ÉO CONFIGURADO"
          fi
          
          echo ""
          echo "üìã Resumo:"
          echo "   - Token configurado: ${{ secrets.TELEGRAM_BOT_TOKEN != '' && '‚úÖ Sim' || '‚ùå N√£o' }}"
          echo "   - Chat ID configurado: ${{ secrets.TELEGRAM_CHAT_ID != '' && '‚úÖ Sim' || '‚ùå N√£o' }}"
          
          # Verificar se ambos est√£o configurados
          if [ -n "${{ secrets.TELEGRAM_BOT_TOKEN }}" ] && [ -n "${{ secrets.TELEGRAM_CHAT_ID }}" ]; then
            echo "üéØ Status: AMBOS CONFIGURADOS - Pode testar as notifica√ß√µes!"
          else
            echo "üö® Status: SECRETS INCOMPLETOS - Configure os secrets primeiro!"
            exit 1
          fi
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}

      - name: Test API connection
        run: |
          echo "üîó Testando conex√£o com a API do Telegram..."
          
          # Testar se o bot existe
          BOT_INFO=$(curl -s "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/getMe")
          echo "üì± Informa√ß√µes do bot:"
          echo "$BOT_INFO"
          
          if echo "$BOT_INFO" | grep -q '"ok":true'; then
            echo "‚úÖ Bot encontrado e v√°lido!"
            
            # Testar se pode enviar mensagem (sem enviar de fato)
            CHAT_INFO=$(curl -s "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/getChat?chat_id=${TELEGRAM_CHAT_ID}")
            echo "üë• Informa√ß√µes do chat:"
            echo "$CHAT_INFO"
            
            if echo "$CHAT_INFO" | grep -q '"ok":true'; then
              echo "‚úÖ Chat encontrado e acess√≠vel!"
            else
              echo "‚ùå Chat n√£o encontrado ou inacess√≠vel"
              echo "   Verifique se o bot foi adicionado ao grupo/canal"
            fi
          else
            echo "‚ùå Bot n√£o encontrado ou token inv√°lido"
            echo "   Verifique o token do bot"
          fi
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
