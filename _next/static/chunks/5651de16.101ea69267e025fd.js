"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[269],{3377:function(e,t,s){s.r(t),s.d(t,{App:function(){return sP},Messages:function(){return nm},SanitizeLevel:function(){return ir},default:function(){return nv},tracker:function(){return nw}});var i,n,r={},o=function(e,t,s,i,n){var o=new Worker(r[t]||(r[t]=URL.createObjectURL(new Blob([e+';addEventListener("error",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'],{type:"text/javascript"}))));return o.onmessage=function(e){var t=e.data,s=t.$e$;if(s){var i=Error(s[0]);i.code=s[1],i.stack=s[2],n(i,null)}else n(null,t)},o.postMessage(s,i),o},a=Uint8Array,l=Uint16Array,h=Int32Array,c=new a([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),u=new a([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),d=new a([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),p=function(e,t){for(var s=new l(31),i=0;i<31;++i)s[i]=t+=1<<e[i-1];for(var n=new h(s[30]),i=1;i<30;++i)for(var r=s[i];r<s[i+1];++r)n[r]=r-s[i]<<5|i;return{b:s,r:n}},f=p(c,2),g=f.b,m=f.r;g[28]=258,m[258]=28;for(var b=p(u,0).r,y=new l(32768),v=0;v<32768;++v){var S=(43690&v)>>1|(21845&v)<<1;S=(61680&(S=(52428&S)>>2|(13107&S)<<2))>>4|(3855&S)<<4,y[v]=((65280&S)>>8|(255&S)<<8)>>1}for(var w=function(e,t,s){for(var i,n=e.length,r=0,o=new l(t);r<n;++r)e[r]&&++o[e[r]-1];var a=new l(t);for(r=1;r<t;++r)a[r]=a[r-1]+o[r-1]<<1;if(s){i=new l(1<<t);var h=15-t;for(r=0;r<n;++r)if(e[r])for(var c=r<<4|e[r],u=t-e[r],d=a[e[r]-1]++<<u,p=d|(1<<u)-1;d<=p;++d)i[y[d]>>h]=c}else for(r=0,i=new l(n);r<n;++r)e[r]&&(i[r]=y[a[e[r]-1]++]>>15-e[r]);return i},k=new a(288),v=0;v<144;++v)k[v]=8;for(var v=144;v<256;++v)k[v]=9;for(var v=256;v<280;++v)k[v]=7;for(var v=280;v<288;++v)k[v]=8;for(var T=new a(32),v=0;v<32;++v)T[v]=5;var I=w(k,9,0),x=w(T,5,0),C=function(e){return(e+7)/8|0},E=function(e,t,s){return(null==t||t<0)&&(t=0),(null==s||s>e.length)&&(s=e.length),new a(e.subarray(t,s))},_=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],N=function(e,t,s){var i=Error(t||_[e]);if(i.code=e,Error.captureStackTrace&&Error.captureStackTrace(i,N),!s)throw i;return i},O=function(e,t,s){s<<=7&t;var i=t/8|0;e[i]|=s,e[i+1]|=s>>8},R=function(e,t,s){s<<=7&t;var i=t/8|0;e[i]|=s,e[i+1]|=s>>8,e[i+2]|=s>>16},M=function(e,t){for(var s=[],i=0;i<e.length;++i)e[i]&&s.push({s:i,f:e[i]});var n=s.length,r=s.slice();if(!n)return{t:B,l:0};if(1==n){var o=new a(s[0].s+1);return o[s[0].s]=1,{t:o,l:1}}s.sort(function(e,t){return e.f-t.f}),s.push({s:-1,f:25001});var h=s[0],c=s[1],u=0,d=1,p=2;for(s[0]={s:-1,f:h.f+c.f,l:h,r:c};d!=n-1;)h=s[s[u].f<s[p].f?u++:p++],c=s[u!=d&&s[u].f<s[p].f?u++:p++],s[d++]={s:-1,f:h.f+c.f,l:h,r:c};for(var f=r[0].s,i=1;i<n;++i)r[i].s>f&&(f=r[i].s);var g=new l(f+1),m=D(s[d-1],g,0);if(m>t){var i=0,b=0,y=m-t,v=1<<y;for(r.sort(function(e,t){return g[t.s]-g[e.s]||e.f-t.f});i<n;++i){var S=r[i].s;if(g[S]>t)b+=v-(1<<m-g[S]),g[S]=t;else break}for(b>>=y;b>0;){var w=r[i].s;g[w]<t?b-=1<<t-g[w]++-1:++i}for(;i>=0&&b;--i){var k=r[i].s;g[k]==t&&(--g[k],++b)}m=t}return{t:new a(g),l:m}},D=function(e,t,s){return -1==e.s?Math.max(D(e.l,t,s+1),D(e.r,t,s+1)):t[e.s]=s},A=function(e){for(var t=e.length;t&&!e[--t];);for(var s=new l(++t),i=0,n=e[0],r=1,o=function(e){s[i++]=e},a=1;a<=t;++a)if(e[a]==n&&a!=t)++r;else{if(!n&&r>2){for(;r>138;r-=138)o(32754);r>2&&(o(r>10?r-11<<5|28690:r-3<<5|12305),r=0)}else if(r>3){for(o(n),--r;r>6;r-=6)o(8304);r>2&&(o(r-3<<5|8208),r=0)}for(;r--;)o(n);r=1,n=e[a]}return{c:s.subarray(0,i),n:t}},L=function(e,t){for(var s=0,i=0;i<t.length;++i)s+=e[i]*t[i];return s},F=function(e,t,s){var i=s.length,n=C(t+2);e[n]=255&i,e[n+1]=i>>8,e[n+2]=255^e[n],e[n+3]=255^e[n+1];for(var r=0;r<i;++r)e[n+r+4]=s[r];return(n+4+i)*8},j=function(e,t,s,i,n,r,o,a,h,p,f){O(t,f++,s),++n[256];for(var g,m,b,y,v=M(n,15),S=v.t,C=v.l,E=M(r,15),_=E.t,N=E.l,D=A(S),j=D.c,P=D.n,B=A(_),U=B.c,H=B.n,z=new l(19),$=0;$<j.length;++$)++z[31&j[$]];for(var $=0;$<U.length;++$)++z[31&U[$]];for(var q=M(z,7),W=q.t,V=q.l,K=19;K>4&&!W[d[K-1]];--K);var X=p+5<<3,J=L(n,k)+L(r,T)+o,G=L(n,S)+L(r,_)+o+14+3*K+L(z,W)+2*z[16]+3*z[17]+7*z[18];if(h>=0&&X<=J&&X<=G)return F(t,f,e.subarray(h,h+p));if(O(t,f,1+(G<J)),f+=2,G<J){g=w(S,C,0),m=S,b=w(_,N,0),y=_;var Q=w(W,V,0);O(t,f,P-257),O(t,f+5,H-1),O(t,f+10,K-4),f+=14;for(var $=0;$<K;++$)O(t,f+3*$,W[d[$]]);f+=3*K;for(var Y=[j,U],Z=0;Z<2;++Z)for(var ee=Y[Z],$=0;$<ee.length;++$){var et=31&ee[$];O(t,f,Q[et]),f+=W[et],et>15&&(O(t,f,ee[$]>>5&127),f+=ee[$]>>12)}}else g=I,m=k,b=x,y=T;for(var $=0;$<a;++$){var es=i[$];if(es>255){var et=es>>18&31;R(t,f,g[et+257]),f+=m[et+257],et>7&&(O(t,f,es>>23&31),f+=c[et]);var ei=31&es;R(t,f,b[ei]),f+=y[ei],ei>3&&(R(t,f,es>>5&8191),f+=u[ei])}else R(t,f,g[es]),f+=m[es]}return R(t,f,g[256]),f+m[256]},P=new h([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),B=new a(0),U=function(e,t,s,i,n,r){var o=r.z||e.length,d=new a(i+o+5*(1+Math.ceil(o/7e3))+n),p=d.subarray(i,d.length-n),f=r.l,g=7&(r.r||0);if(t){g&&(p[0]=r.r>>3);for(var y=P[t-1],v=y>>13,S=8191&y,w=(1<<s)-1,k=r.p||new l(32768),T=r.h||new l(w+1),I=Math.ceil(s/3),x=2*I,_=function(t){return(e[t]^e[t+1]<<I^e[t+2]<<x)&w},N=new h(25e3),O=new l(288),R=new l(32),M=0,D=0,A=r.i||0,L=0,B=r.w||0,U=0;A+2<o;++A){var H=_(A),z=32767&A,$=T[H];if(k[z]=$,T[H]=z,B<=A){var q=o-A;if((M>7e3||L>24576)&&(q>423||!f)){g=j(e,p,0,N,O,R,D,L,U,A-U,g),L=M=D=0,U=A;for(var W=0;W<286;++W)O[W]=0;for(var W=0;W<30;++W)R[W]=0}var V=2,K=0,X=S,J=z-$&32767;if(q>2&&H==_(A-J))for(var G=Math.min(v,q)-1,Q=Math.min(32767,A),Y=Math.min(258,q);J<=Q&&--X&&z!=$;){if(e[A+V]==e[A+V-J]){for(var Z=0;Z<Y&&e[A+Z]==e[A+Z-J];++Z);if(Z>V){if(V=Z,K=J,Z>G)break;for(var ee=Math.min(J,Z-2),et=0,W=0;W<ee;++W){var es=A-J+W&32767,ei=k[es],en=es-ei&32767;en>et&&(et=en,$=es)}}}$=k[z=$],J+=z-$&32767}if(K){N[L++]=268435456|m[V]<<18|b[K];var er=31&m[V],eo=31&b[K];D+=c[er]+u[eo],++O[257+er],++R[eo],B=A+V,++M}else N[L++]=e[A],++O[e[A]]}}for(A=Math.max(A,B);A<o;++A)N[L++]=e[A],++O[e[A]];g=j(e,p,f,N,O,R,D,L,U,A-U,g),f||(r.r=7&g|p[g/8|0]<<3,g-=7,r.h=T,r.p=k,r.i=A,r.w=B)}else{for(var A=r.w||0;A<o+f;A+=65535){var ea=A+65535;ea>=o&&(p[g/8|0]=f,ea=o),g=F(p,g+1,e.subarray(A,ea))}r.i=o}return E(d,0,i+C(g)+n)},H=function(){for(var e=new Int32Array(256),t=0;t<256;++t){for(var s=t,i=9;--i;)s=(1&s&&-306674912)^s>>>1;e[t]=s}return e}(),z=function(){var e=-1;return{p:function(t){for(var s=e,i=0;i<t.length;++i)s=H[255&s^t[i]]^s>>>8;e=s},d:function(){return~e}}},$=function(e,t,s,i,n){if(!n&&(n={l:1},t.dictionary)){var r=t.dictionary.subarray(-32768),o=new a(r.length+e.length);o.set(r),o.set(e,r.length),e=o,n.w=r.length}return U(e,null==t.level?6:t.level,null==t.mem?n.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):20:12+t.mem,s,i,n)},q=function(e,t){var s={};for(var i in e)s[i]=e[i];for(var i in t)s[i]=t[i];return s},W=function(e,t,s){for(var i=e(),n=e.toString(),r=n.slice(n.indexOf("[")+1,n.lastIndexOf("]")).replace(/\s+/g,"").split(","),o=0;o<i.length;++o){var a=i[o],l=r[o];if("function"==typeof a){t+=";"+l+"=";var h=a.toString();if(a.prototype){if(-1!=h.indexOf("[native code]")){var c=h.indexOf(" ",8)+1;t+=h.slice(c,h.indexOf("(",c))}else for(var u in t+=h,a.prototype)t+=";"+l+".prototype."+u+"="+a.prototype[u].toString()}else t+=h}else s[l]=a}return t},V=[],K=function(e){var t=[];for(var s in e)e[s].buffer&&t.push((e[s]=new e[s].constructor(e[s])).buffer);return t},X=function(e,t,s,i){if(!V[s]){for(var n="",r={},a=e.length-1,l=0;l<a;++l)n=W(e[l],n,r);V[s]={c:W(e[a],n,r),e:r}}var h=q({},V[s].e);return o(V[s].c+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",s,h,K(h),i)},J=function(){return[a,l,h,c,u,d,m,b,I,k,x,T,y,P,B,w,O,R,M,D,A,L,F,j,C,E,U,$,es,Q]},G=function(){return[ee,et,Z,z,H]},Q=function(e){return postMessage(e,[e.buffer])},Y=function(e,t,s,i,n,r){var o=X(s,i,n,function(e,t){o.terminate(),r(e,t)});return o.postMessage([e,t],t.consume?[e.buffer]:[]),function(){o.terminate()}},Z=function(e,t,s){for(;s;++t)e[t]=s,s>>>=8},ee=function(e,t){var s=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:9==t.level?2:0,e[9]=3,0!=t.mtime&&Z(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),s){e[3]=8;for(var i=0;i<=s.length;++i)e[i+10]=s.charCodeAt(i)}},et=function(e){return 10+(e.filename?e.filename.length+1:0)};function es(e,t){return $(e,t||{},0,0)}function ei(e,t){t||(t={});var s=z(),i=e.length;s.p(e);var n=$(e,t,et(t),8),r=n.length;return ee(n,t),Z(n,r-8,s.d()),Z(n,r-4,i),n}var en="undefined"!=typeof TextDecoder&&new TextDecoder;try{en.decode(B,{stream:!0})}catch(e){}class er{constructor(){this.lastTs=0,this.lastSuffix=1,this.backDict={},this.getKey=e=>{let t=!1,s=`__${e}`;if(!this.backDict[s]){t=!0;let e=Date.now()%1e11,i=e;i===this.lastTs?(i=1e4*i+this.lastSuffix,this.lastSuffix+=1):this.lastSuffix=1,this.backDict[s]=i,this.lastTs=e}return[this.backDict[s],t]}}}class eo{constructor(e){this.sendSetAttribute=(e,t,s)=>{if(this.isDictDisabled){let i=[12,e,t,s];return this.app.send(i)}{let i=[35,e,this.applyDict(t),this.applyDict(s)];return this.app.send(i)}},this.app=e.app,this.isDictDisabled=e.isDictDisabled,this.dict=new er}applyDict(e){let[t,s]=this.dict.getKey(e);return s&&this.app.send([34,t,e]),t}clear(){this.dict=new er}}class ea{constructor(e,t){this.app=e,this.startParams=t,this.conditions=[],this.hasStarted=!1,this.createConditionFromFilter=e=>{let t=eh(e);if(t.type)return t},this.durationInt=null}setConditions(e){this.conditions=e}async fetchConditions(e,t){try{let s=await fetch(`${this.app.options.ingestPoint}/v1/web/conditions/${e}`,{method:"GET",headers:{Authorization:`Bearer ${t}`}}),{conditions:i}=await s.json(),n=[];i.forEach(e=>{e.filters.forEach(t=>{let s;"fetch"===t.type?(s={type:"network_request",subConditions:[],name:e.name},t.filters.forEach(e=>{let t=this.createConditionFromFilter(e);t&&s.subConditions.push(t)})):s=this.createConditionFromFilter(t),s&&("session_duration"===s.type&&this.processDuration(s.value[0],e.name),n.push({...s,name:e.name}))})}),this.conditions=n}catch(e){this.app.debug.error("Critical: cannot fetch start conditions")}}trigger(e){if(!this.hasStarted)try{this.hasStarted=!0,this.app.start(this.startParams,void 0,e)}catch(e){this.app.debug.error(e)}}processMessage(e){if(!this.hasStarted)switch(e[0]){case 78:this.jsExceptionEvent(e);break;case 27:this.customEvent(e);break;case 68:this.clickEvent(e);break;case 122:this.pageLocationEvent(e);break;case 83:this.networkRequest(e)}}processFlags(e){let t=this.conditions.filter(e=>"feature_flag"===e.type);t.length&&t.forEach(t=>{let s=el[t.operator];s&&e.find(e=>s(e.key,t.value))&&this.trigger(t.name)})}processDuration(e,t){this.durationInt=setInterval(()=>{performance.now()>e&&this.trigger(t)},1e3),this.app.attachStopCallback(()=>{this.durationInt&&clearInterval(this.durationInt)})}networkRequest(e){let t=this.conditions.filter(e=>"network_request"===e.type);t.length&&t.forEach(t=>{let s=t.subConditions.filter(e=>"isAny"!==e.operator);s.length?s.every(t=>{let s;switch(t.key){case"url":s=e[3];break;case"status":s=e[6];break;case"method":s=e[2];break;case"duration":s=e[8]}let i=el[t.operator];if(i&&i(s,t.value))return!0})&&this.trigger(t.name):0===s.length&&t.subConditions.length&&this.trigger(t.name)})}customEvent(e){let t=this.conditions.filter(e=>"custom_event"===e.type);t.length&&t.forEach(t=>{let s=el[t.operator];s&&(s(e[1],t.value)||s(e[2],t.value))&&this.trigger(t.name)})}clickEvent(e){let t=this.conditions.filter(e=>"click"===e.type);t.length&&t.forEach(t=>{let s=el[t.operator];s&&(s(e[3],t.value)||s(e[4],t.value))&&this.trigger(t.name)})}pageLocationEvent(e){let t=this.conditions.filter(e=>"visited_url"===e.type);t&&t.forEach(t=>{let s=el[t.operator];s&&s(e[1],t.value)&&this.trigger(t.name)})}jsExceptionEvent(e){let t=[e[1],e[2],e[3]],s=this.conditions.filter(e=>"exception"===e.type);s&&s.forEach(e=>{let s=el[e.operator];s&&t.some(t=>s(t,e.value))&&this.trigger(e.name)})}}let el={is:(e,t)=>t.some(t=>e.includes(t)),isAny:()=>!0,isNot:(e,t)=>!t.some(t=>e.includes(t)),contains:(e,t)=>t.some(t=>e.includes(t)),notContains:(e,t)=>!t.some(t=>e.includes(t)),startsWith:(e,t)=>t.some(t=>e.startsWith(t)),endsWith:(e,t)=>t.some(t=>e.endsWith(t)),greaterThan:(e,t)=>e>t,greaterOrEqual:(e,t)=>e>=t,lessOrEqual:(e,t)=>e<=t,lessThan:(e,t)=>e<t},eh=e=>{let t={on:"is",notOn:"isNot",">":"greaterThan","<":"lessThan","=":"is","<=":"lessOrEqual",">=":"greaterOrEqual"},s=e=>{if(Object.keys(t).includes(e))return t[e]},i={type:"",operator:"",value:e.value,key:""};switch(e.type){case"click":i={type:"click",operator:s(e.operator),value:e.value,key:""};break;case"location":i={type:"visited_url",operator:e.operator,value:e.value,key:""};break;case"custom":i={type:"custom_event",operator:e.operator,value:e.value,key:""};break;case"metadata":i={type:"featureFlag"===e.source?"feature_flag":e.type,operator:e.operator,value:e.value,key:""};break;case"error":i={type:"exception",operator:e.operator,value:e.value,key:""};break;case"duration":i={type:"session_duration",value:e.value,key:"",operator:"is"};break;case"fetchUrl":i={type:"network_request",key:"url",operator:e.operator,value:e.value};break;case"fetchStatusCode":i={type:"network_request",key:"status",operator:s(e.operator),value:e.value};break;case"fetchMethod":i={type:"network_request",key:"method",operator:s(e.operator),value:e.value};break;case"fetchDuration":i={type:"network_request",key:"duration",operator:s(e.operator),value:e.value}}return i};class ec{constructor(e){this.app=e,this.flags=[],this.storageKey="__openreplay_flags";let t=this.app.sessionStorage.getItem(this.storageKey);if(t){let e=t.split(";").filter(Boolean);this.flags=e.map(e=>JSON.parse(e))}}getFeatureFlag(e){return this.flags.find(t=>t.key===e)}isFlagEnabled(e){return -1!==this.flags.findIndex(t=>t.key===e)}onFlagsLoad(e){this.onFlagsCb=e}async reloadFlags(e){let t=this.app.sessionStorage.getItem(this.storageKey),s={};t&&t.split(";").filter(Boolean).forEach(e=>{let t=JSON.parse(e);s[t.key]={key:t.key,value:t.value}});let i=this.app.session.getInfo(),n=this.app.session.userInfo,r={projectID:i.projectID,userID:i.userID,metadata:i.metadata,referrer:document.referrer,os:n.userOS,device:n.userDevice,country:n.userCountry,state:n.userState,city:n.userCity,browser:n.userBrowser,persistFlags:s},o=e??this.app.session.getSessionToken(),a=await fetch(this.app.options.ingestPoint+"/v1/web/feature-flags",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(r)});if(200===a.status){let e=await a.json();return this.handleFlags(e.flags)}}handleFlags(e){let t=[];e.forEach(e=>{e.is_persist&&t.push(e)});let s="";return this.diffPersist(t).forEach(e=>{s+=`${JSON.stringify(e)};`}),this.app.sessionStorage.setItem(this.storageKey,s),this.flags=e,this.onFlagsCb?.(e)}clearPersistFlags(){this.app.sessionStorage.removeItem(this.storageKey)}diffPersist(e){let t=this.app.sessionStorage.getItem(this.storageKey);if(!t)return e;let s=t.split(";").filter(Boolean).map(e=>JSON.parse(e));return e.filter(e=>-1===s.findIndex(t=>t.key===e.key))}}let eu={htmlmasked:"hidden",masked:"obscured"},ed="undefined"!=typeof window,ep=ed&&navigator.userAgent.match(/firefox|fxios/i),ef=ed?Date.now()-performance.now():0;function eg(){ef=Date.now()-performance.now()}let em=ed&&performance.now?()=>Math.round(performance.now()+ef):()=>Date.now(),eb="repeat"in String.prototype?e=>"*".repeat(e.length):e=>e.replace(/./g,"*");function ey(e){return e.trim().replace(/\s+/g," ")}function ev(e){return e.startsWith("https://")||e.startsWith("http://")}let eS="https://docs.openreplay.com",ew={};function ek(e,t,s="/"){ew[e]||(console.warn(`OpenReplay: ${e} is deprecated. ${t?`Please, use ${t} instead.`:""} Visit ${eS}${s} for more information.`),ew[e]=!0)}function eT(e){let t=e.getAttribute("data-openreplay-label");return null!==t||null!==(t=e.getAttribute("data-asayer-label"))&&ek('"data-asayer-label" attribute','"data-openreplay-label" attribute',"/"),t}function eI(e,t){let s=`data-openreplay-${t}`;return!!e.hasAttribute(s)&&(eu[t]&&ek(`"${s}" attribute`,`"${eu[t]}" attribute`,"/en/sdk/sanitize-data"),!0)}function ex(e){try{e instanceof HTMLIFrameElement?e.contentDocument:e instanceof Window?e.document:e instanceof Document?e.defaultView:"nodeType"in e?e.nodeType:"addEventListener"in e&&e.addEventListener}catch(e){if(e instanceof DOMException&&"SecurityError"===e.name)return!1}return!0}function eC(e){return e.toString(16).padStart(2,"0")}function eE(){try{return window.self&&window.top&&window.self!==window.top}catch(e){return!0}}function e_(e){return window.Zone&&"__symbol__"in window.Zone?window.Zone.__symbol__(e):e}function eN(e,t){if(t)return new MutationObserver(e);{let t=e_("MutationObserver");return new window[t](e)}}function eO(e,t,s,i,n){if(!ex(e))return;let r="addEventListener";n||(r=e_("addEventListener"));try{e[r]?e[r](t,s,i):e.addEventListener(t,s,i)}catch(i){let s=i.message;console.error(`Openreplay: ${s}; if this error is caused by an IframeObserver, ignore it`,t,e)}}function eR(e,t,s,i,n){if(!ex(e))return;let r="removeEventListener";n||(r=e_("removeEventListener"));try{e[r]?e[r](t,s,i):e.removeEventListener(t,s,i)}catch(i){let s=i.message;console.error(`Openreplay: ${s}; if this error is caused by an IframeObserver, ignore it`,t,e)}}class eM{constructor(){this.taskQueue=[],this.isRunning=!1}addTask(e){this.taskQueue.push(e),this.runTasks()}runTasks(){if(this.isRunning||0===this.taskQueue.length)return;this.isRunning=!0;let e=()=>{if(0===this.taskQueue.length){this.isRunning=!1;return}Promise.resolve(this.taskQueue.shift()()).then(()=>{requestAnimationFrame(()=>e())})};e()}}let eD=new eM;function eA(e){eD.addTask(e)}function eL(e){return[0,e]}function eF(e,t){return[5,e,t]}function ej(e,t){return[6,e,t]}function eP(){return[7]}function eB(e,t,s,i,n){return[8,e,t,s,i,n]}function eU(e,t,s){return[9,e,t,s]}function eH(e,t,s){return[10,e,t,s]}function ez(e){return[11,e]}function e$(e,t,s){return[12,e,t,s]}function eq(e,t){return[13,e,t]}function eW(e,t){return[14,e,t]}function eV(e,t,s){return[16,e,t,s]}function eK(e,t,s){return[18,e,t,s]}function eX(e,t){return[19,e,t]}function eJ(e,t){return[20,e,t]}function eG(e,t){return[22,e,t]}function eQ(e,t,s,i,n,r,o,a,l){return[23,e,t,s,i,n,r,o,a,l]}function eY(e,t,s){return[24,e,t,s]}function eZ(e,t){return[27,e,t]}function e0(e){return[28,e]}function e1(e){return[29,e]}function e2(e,t){return[30,e,t]}function e5(e,t,s,i){return[49,e,t,s,i]}function e3(e,t){return[54,e,t]}function e4(e){return[55,e]}function e8(e,t,s,i){return[57,e,t,s,i]}function e6(e){return[58,e]}function e9(e,t,s,i){return[60,e,t,s,i]}function e7(e,t,s){return[61,e,t,s]}function te(e,t){return[63,e,t]}function tt(e,t){return[64,e,t]}function ts(e,t,s,i,n,r){return[68,e,t,s,i,n,r]}function ti(e,t){return[70,e,t]}function tn(e,t,s){return[71,e,t,s]}function tr(e,t,s,i){return[73,e,t,s,i]}function to(e,t){return[75,e,t]}function ta(e,t){return[76,e,t]}function tl(e,t){return[77,e,t]}function th(e,t,s,i){return[78,e,t,s,i]}function tc(e,t,s,i,n,r,o,a,l){return[83,e,t,s,i,n,r,o,a,l]}function tu(e,t,s,i,n,r){return[84,e,t,s,i,n,r]}function td(e,t,s,i,n,r){return[112,e,t,s,i,n,r]}function tp(e,t,s){return[113,e,t,s]}function tf(e){return[114,e]}function tg(e){return[115,e]}function tm(e,t,s,i,n,r,o,a,l,h){return[116,e,t,s,i,n,r,o,a,l,h]}function tb(e){return[117,e]}function ty(e){return[118,e]}function tv(e,t){return[119,e,t]}function tS(e){return[120,e]}function tw(e,t,s,i){return[122,e,t,s,i]}function tk(e,t){return[124,e,t]}var tT=Object.freeze({__proto__:null,AdoptedSSAddOwner:ta,AdoptedSSDeleteRule:to,AdoptedSSInsertRuleURLBased:tr,AdoptedSSRemoveOwner:tl,AdoptedSSReplaceURLBased:tn,BatchMetadata:function(e,t,s,i,n){return[81,e,t,s,i,n]},CSSDeleteRule:function(e,t){return[38,e,t]},CSSInsertRule:function(e,t,s){return[37,e,t,s]},CSSInsertRuleURLBased:function(e,t,s,i){return[67,e,t,s,i]},CanvasNode:tv,ConnectionInformation:e3,ConsoleLog:eG,CreateDocument:eP,CreateElementNode:eB,CreateIFrameDocument:ti,CreateTextNode:eU,CustomEvent:eZ,CustomIssue:tt,Fetch:function(e,t,s,i,n,r,o){return[39,e,t,s,i,n,r,o]},GraphQL:function(e,t,s,i,n){return[123,e,t,s,i,n]},GraphQLDeprecated:function(e,t,s,i,n){return[48,e,t,s,i,n]},InputChange:td,JSException:th,LoadFontFace:e8,LongTask:function(e,t,s,i,n,r,o){return[59,e,t,s,i,n,r,o]},Metadata:e2,MobX:function(e,t){return[46,e,t]},MouseClick:ts,MouseClickDeprecated:function(e,t,s,i){return[69,e,t,s,i]},MouseMove:eJ,MouseThrashing:tf,MoveNode:eH,NetworkRequest:tc,NetworkRequestDeprecated:function(e,t,s,i,n,r,o,a){return[21,e,t,s,i,n,r,o,a]},NgRx:function(e,t,s){return[47,e,t,s]},OTable:function(e,t){return[41,e,t]},PageLoadTiming:eQ,PageRenderTiming:eY,PartitionedMessage:function(e,t){return[82,e,t]},PerformanceTrack:e5,Profiler:function(e,t,s,i){return[40,e,t,s,i]},Redux:function(e,t,s,i){return[121,e,t,s,i]},ReduxDeprecated:function(e,t,s){return[44,e,t,s]},RemoveNode:ez,RemoveNodeAttribute:eq,ResourceTiming:tm,ResourceTimingDeprecated:function(e,t,s,i,n,r,o,a){return[53,e,t,s,i,n,r,o,a]},SelectionChange:tp,SetCSSDataURLBased:e7,SetInputChecked:eX,SetInputTarget:function(e,t){return[17,e,t]},SetInputValue:eK,SetNodeAttribute:e$,SetNodeAttributeDict:function(e,t,s){return[52,e,t,s]},SetNodeAttributeDictDeprecated:function(e,t,s){return[51,e,t,s]},SetNodeAttributeDictGlobal:function(e,t,s){return[35,e,t,s]},SetNodeAttributeURLBased:e9,SetNodeData:eW,SetNodeFocus:e6,SetNodeScroll:eV,SetPageLocation:tw,SetPageLocationDeprecated:function(e,t,s){return[4,e,t,s]},SetPageVisibility:e4,SetViewportScroll:ej,SetViewportSize:eF,StateAction:function(e){return[42,e]},StringDict:function(e,t){return[43,e,t]},StringDictDeprecated:function(e,t){return[50,e,t]},StringDictGlobal:function(e,t){return[34,e,t]},TabChange:tb,TabData:ty,TagTrigger:tS,TechnicalInfo:te,Timestamp:eL,UnbindNodes:tg,UserAnonymousID:e1,UserID:e0,Vuex:function(e,t){return[45,e,t]},WSChannel:tu,WebVitals:tk,Zustand:function(e,t){return[79,e,t]}});let tI=ed&&"performance"in window&&"memory"in performance?performance:{memory:{}},tx=ed?1024*(navigator.deviceMemory||0):0,tC=tI.memory.jsHeapSizeLimit||0,tE="__or__watched_tags__";class t_{constructor(e){this.intervals={},this.tags=[],this.sessionStorage=e.sessionStorage,this.errLog=e.errLog,this.onTag=e.onTag;let t=JSON.parse(e.sessionStorage.getItem(tE)??"[]");this.setTags(t),this.observer=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting&&e.target){let t=e.target.__or_watcher_tagname;t&&this.onTagRendered(t),this.observer.unobserve(e.target)}})})}async fetchTags(e,t){return fetch(`${e}/v1/web/tags`,{method:"GET",headers:{Authorization:`Bearer ${t}`}}).then(e=>e.json()).then(({tags:e})=>{if(e&&e.length){this.setTags(e);let t=JSON.stringify(e);this.sessionStorage.setItem(tE,t||"")}}).catch(e=>this.errLog(e))}setTags(e){this.tags=e,this.intervals={},e.forEach(e=>{this.intervals[e.id]=setInterval(()=>{let t=document.querySelectorAll(e.selector);if(t.length>0){let s=t[0];s.__or_watcher_tagname=e.id,this.observer.observe(s)}},500)})}onTagRendered(e){this.intervals[e]&&clearInterval(this.intervals[e]),this.onTag(e)}clear(){this.tags.forEach(e=>{clearInterval(this.intervals[e.id])}),this.tags=[],this.intervals={},this.observer.disconnect()}}let tN={position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0, 0, 0, 0.40)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999999,fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"'},tO={display:"flex",flexDirection:"column",gap:"2rem",alignItems:"center",padding:"1.5rem",borderRadius:"2px",border:"1px solid rgb(255 255 255 / var(--tw-bg-opacity, 1))",background:"#FFF",width:"22rem"},tR={display:"flex","flex-direction":"column",gap:"unset","align-items":"center",padding:"unset",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',"border-radius":"2px",border:"1px solid rgb(255 255 255 / var(--tw-bg-opacity, 1))",background:"rgba(255, 255, 255, 0.75)",width:"22rem"},tM={fontFamily:"Verdana, sans-serif",fontSize:"1.25rem",fontStyle:"normal",fontWeight:"500",lineHeight:"1.75rem",color:"rgba(0, 0, 0, 0.85)"},tD={borderTop:"1px solid rgba(0, 0, 0, 0.06)",borderBottom:"1px solid rgba(0, 0, 0, 0.06)",padding:"1.25rem 0rem",color:"rgba(0, 0, 0, 0.85)",fontFamily:"Verdana, sans-serif",fontSize:"13px",fontStyle:"normal",fontWeight:"400",lineHeight:"auto",whiteSpace:"pre-wrap"},tA={display:"flex",padding:"0.4rem 0.9375rem",justifyContent:"center",alignItems:"center",gap:"0.625rem",borderRadius:"0.25rem",border:"1px solid #394EFF",background:"#394EFF",boxShadow:"0px 2px 0px 0px rgba(0, 0, 0, 0.04)",color:"#FFF",textAlign:"center",fontFamily:"Verdana, sans-serif",fontSize:"1rem",fontStyle:"normal",fontWeight:"500",lineHeight:"1.5rem",cursor:"pointer"},tL={fontFamily:"Verdana, sans-serif",fontSize:"13px",fontWeight:"500",lineHeight:"auto",display:"flex",justifyContent:"space-between",width:"100%",cursor:"pointer"},tF={display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.625rem",fontSize:"13px",lineHeight:"auto"},tj={padding:"0.5rem",gap:"0.5rem",fontFamily:"Verdana, sans-serif",fontSize:"16px",fontStyle:"normal",fontWeight:"500",lineHeight:"auto",color:"white",display:"flex",alignItems:"center",width:"100%",borderRadius:"2px",background:"rgba(0, 0, 0, 0.75)",boxSizing:"border-box"},tP={boxSizing:"border-box",display:"block",width:"100%",borderBottom:"1px solid rgb(255 255 255 / var(--tw-bg-opacity, 1))",background:"#FFF",padding:"0.65rem",alignSelf:"stretch",color:"#000",fontFamily:"Verdana, sans-serif",fontStyle:"normal",fontWeight:"400"},tB={...tP,display:"flex",flexDirection:"column",alignItems:"center",gap:"0.625rem"},tU={fontSize:"1.25rem",fontWeight:"500",cursor:"pointer",color:"#394EFF"},tH={display:"flex",padding:"0.4rem 0.9375rem",justifyContent:"center",alignItems:"center",gap:"0.625rem",borderRadius:"0.25rem",border:"1px solid #394EFF",background:"#394EFF",boxShadow:"0px 2px 0px 0px rgba(0, 0, 0, 0.04)",color:"#FFF",textAlign:"center",fontFamily:"Verdana, sans-serif",fontSize:"1rem",fontStyle:"normal",fontWeight:"500",lineHeight:"1.5rem",width:"100%",boxSizing:"border-box",cursor:"pointer"},tz={marginTop:"1rem",marginBottom:"1rem",cursor:"pointer",display:"block",fontWeight:"500",fontSize:"13px!important",lineHeight:"auto"},t$={display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem",padding:"0.5rem",width:"100%",boxSizing:"border-box"},tq={display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:"6.25em",outline:"1px solid #394EFF",fontSize:"13px",height:"24px",width:"24px"},tW={display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:"6.25em",outline:"1px solid #D2DFFF",boxShadow:"0px 2px 0px 0px rgba(0, 0, 0, 0.04)",background:"#D2DFFF",fontSize:"13px",height:"24px",width:"24px"},tV={borderRadius:"0.375rem",border:"1px solid rgba(0, 0, 0, 0.06)",background:"#F5F7FF",boxShadow:"0px 2px 0px 0px rgba(0, 0, 0, 0.04)",display:"flex",flexDirection:"column",padding:"0.625rem 0.9375rem",gap:"0.5rem",alignSelf:"stretch"},tK={fontWeight:"bold"},tX={fontSize:"13px",lineHeight:"auto"},tJ={marginRight:"0.5rem",cursor:"pointer",color:"#394EFF",textAlign:"center",fontFamily:"Verdana, sans-serif",fontSize:"13px",fontStyle:"normal",fontWeight:"500",lineHeight:"auto"},tG={...tJ,display:"flex",padding:"0.25rem 0.9375rem",justifyContent:"center",alignItems:"center",gap:"0.5rem",borderRadius:"0.25rem",border:"1px solid #394EFF"},tQ={display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",boxSizing:"border-box"},tY={border:"4px solid rgba(255, 255, 255, 0.4)",width:"16px",height:"16px",borderRadius:"50%",borderLeftColor:"#fff",animation:"spin 0.5s linear infinite"},tZ={Standard:{width:1280,height:720}};class t0{constructor(e){this.app=e,this.mediaRecorder=null,this.recordedChunks=[],this.stream=null,this.recStartTs=null}async startRecording(e,t,s,i){this.recStartTs=this.app.timestamp();try{this.stream=await navigator.mediaDevices.getUserMedia({video:!!i&&{...t,frameRate:{ideal:e}},audio:s}),this.mediaRecorder=new MediaRecorder(this.stream,{mimeType:"video/webm;codecs=vp9"}),this.recordedChunks=[],this.mediaRecorder.ondataavailable=e=>{e.data.size>0&&this.recordedChunks.push(e.data)},this.mediaRecorder.start()}catch(e){console.error(e)}}async stopRecording(){return new Promise(e=>{this.mediaRecorder&&(this.mediaRecorder.onstop=()=>{e(new Blob(this.recordedChunks,{type:"video/webm"}))},this.mediaRecorder.stop())})}async sendToAPI(){let e=await this.stopRecording();return fetch(`${this.app.options.ingestPoint}/v1/web/uxt/upload-url`,{headers:{Authorization:`Bearer ${this.app.session.getSessionToken()}`}}).then(e=>{if(e.ok)return e.json();throw Error("Failed to get upload url")}).then(({url:t})=>fetch(t,{method:"PUT",headers:{"Content-Type":"video/webm"},body:e})).catch(console.error).finally(()=>{this.discard()})}async saveToFile(e="recorded-video.webm"){let t=await this.stopRecording(),s=URL.createObjectURL(t),i=document.createElement("a");i.style.display="none",i.href=s,i.download=e,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(s),document.body.removeChild(i)}discard(){this.mediaRecorder?.stop(),this.stream?.getTracks().forEach(e=>e.stop())}}function t1(e,t,s,i,n){let r=document.createElement(e);return r.className=t,Object.assign(r.style,s),i&&(r.textContent=i),n&&(r.id=n),r}let t2="or_uxt_test_start",t5="or_uxt_task_index",t3="or_uxt_session_id";class t4{constructor(e,t,s,i,n,r,o,a,l){this.ingestPoint=e,this.getTimestamp=t,this.token=s,this.testId=i,this.storageKey=n,this.setStorageKey=r,this.removeStorageKey=o,this.getStorageKey=a,this.getSessionId=l,this.durations={testStart:0,tasks:[]},this.getDurations=()=>this.durations,this.setDurations=e=>{this.durations.testStart=e.testStart,this.durations.tasks=e.tasks},this.signalTask=(e,t,s)=>{if(!e)return console.error("User Testing: No Task ID Given");let i=this.durations.tasks.find(t=>t.taskId===e),n=this.getTimestamp(),r=i?n-i.started:0;return fetch(`${this.ingestPoint}/v1/web/uxt/signals/task`,{method:"POST",headers:{Authorization:`Bearer ${this.token}`},body:JSON.stringify({testId:this.testId,taskId:e,status:t,duration:r,timestamp:n,taskAnswer:s})})},this.signalTest=e=>{let t=this.getTimestamp();if("begin"===e&&this.testId){let e=this.getSessionId();this.setStorageKey(t3,e),this.setStorageKey(this.storageKey,this.testId.toString()),this.setStorageKey(t2,t.toString())}else this.removeStorageKey(this.storageKey),this.removeStorageKey(t5),this.removeStorageKey(t2);let s=this.durations.testStart||t;return fetch(`${this.ingestPoint}/v1/web/uxt/signals/test`,{method:"POST",headers:{Authorization:`Bearer ${this.token}`},body:JSON.stringify({testId:this.testId,status:e,duration:t-s,timestamp:t})})};let h=this.getStorageKey(t2);h&&(this.durations.testStart=parseInt(h,10))}}class t8{constructor(e,t){this.app=e,this.storageKey=t,this.bg=t1("div","bg",tN,void 0,"__or_ut_bg"),this.container=t1("div","container",tO,void 0,"__or_ut_ct"),this.widgetGuidelinesVisible=!0,this.widgetTasksVisible=!1,this.widgetVisible=!0,this.isActive=!1,this.descriptionSection=null,this.taskSection=null,this.endSection=null,this.stopButton=null,this.stopButtonContainer=null,this.test=null,this.testId=null,this.signalManager=null,this.getTest=(e,t,s)=>{this.testId=e;let i=this.app.options.ingestPoint;return fetch(`${i}/v1/web/uxt/test/${e}`,{headers:{Authorization:`Bearer ${t}`}}).then(e=>e.json()).then(({test:i})=>{this.isActive=!0,this.test=i,this.signalManager=new t4(this.app.options.ingestPoint,()=>this.app.timestamp(),t,e,this.storageKey,(e,t)=>this.app.localStorage.setItem(e,t),e=>this.app.localStorage.removeItem(e),e=>this.app.localStorage.getItem(e),()=>this.app.getSessionID()),this.createGreeting(i.title,i.reqMic,i.reqCamera),s&&((i.reqMic||i.reqCamera)&&this.userRecorder.startRecording(30,tZ.Standard,i.reqMic,i.reqCamera),this.showWidget(i.description,i.tasks,!0),this.showTaskSection())}).then(()=>e).catch(e=>{console.log("OR: Error fetching test",e)})},this.hideTaskSection=()=>!1,this.showTaskSection=()=>!0,this.collapseWidget=()=>!1,this.removeGreeting=()=>!1,this.toggleDescriptionVisibility=()=>{},this.currentTaskIndex=0,this.userRecorder=new t0(e),this.app.getSessionID()!==this.app.localStorage.getItem(t3)&&(this.app.localStorage.removeItem(this.storageKey),this.app.localStorage.removeItem(t3),this.app.localStorage.removeItem("or_uxt_test_id"),this.app.localStorage.removeItem(t5),this.app.localStorage.removeItem(t2));let s=this.app.localStorage.getItem(t5);s&&(this.currentTaskIndex=parseInt(s,10))}getTestId(){return this.testId}createGreeting(e,t,s){let i=t1("div","title",tM,e),n=t1("div","description",tD,`Welcome, you're here to help us improve, not to be judged. Your insights matter!

📹 We're recording this browser tab to learn from your experience.
🎤 Please enable mic and camera if asked, to give us a complete picture.`),r=t1("div","button",tA,"Read guidelines to begin");this.removeGreeting=()=>((t||s)&&this.userRecorder.startRecording(30,tZ.Standard,t,s),this.container.removeChild(r),this.container.removeChild(n),this.container.removeChild(i),!1),r.onclick=()=>{this.removeGreeting();let e=this.signalManager?.getDurations();e&&this.signalManager&&(e.testStart=this.app.timestamp(),this.signalManager.setDurations(e)),this.signalManager?.signalTest("begin"),this.container.style.fontFamily='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',Object.assign(this.container.style,tR),this.showWidget(this.test?.guidelines||"",this.test?.tasks||[])},this.container.append(i,n,r),this.bg.appendChild(this.container),document.body.appendChild(this.bg)}showWidget(e,t,s){this.container.innerHTML="",Object.assign(this.bg.style,{position:"fixed",zIndex:99999999999999,right:"8px",left:"unset",width:"fit-content",top:"8px",height:"fit-content",background:"unset",display:"unset",alignItems:"unset",justifyContent:"unset"});let i=this.createTitleSection();this.container.style.fontFamily='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',Object.assign(this.container.style,tR);let n=this.createDescriptionSection(e),r=this.createTasksSection(t),o=t1("div","stop_bn_or",tz,"Abort Session"),a=t1("div","stop_ct_or",{fontSize:"13px!important"});a.style.fontSize="13px",a.append(o),this.container.append(i,n,r,a),this.taskSection=r,this.descriptionSection=n,this.stopButton=o,this.stopButtonContainer=a,o.onclick=()=>{this.userRecorder.discard(),this.signalManager?.signalTest("skipped"),document.body.removeChild(this.bg),window.close()},s?this.toggleDescriptionVisibility():this.hideTaskSection()}createTitleSection(){var e;let t=t1("div","title",tj),s=function(){let e=document.createElement("div");e.className="grid";for(let t=0;t<16;t++){let t=document.createElement("div");Object.assign(t.style,{width:"2px",height:"2px",borderRadius:"10px",background:"white"}),t.className="cell",e.appendChild(t)}return Object.assign(e.style,{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gridTemplateRows:"repeat(4, 1fr)",gap:"2px",cursor:"grab"}),e}(),i=t1("div","title_text",{maxWidth:"19rem",overflow:"hidden",textOverflow:"ellipsis",width:"100%",fontSize:16,lineHeight:"auto",cursor:"pointer"},this.test?.title),n=function(){let e=document.createElement("div");Object.assign(e.style,{width:"0",height:"0",borderLeft:"7px solid transparent",borderRight:"7px solid transparent",borderBottom:"7px solid white"});let t=document.createElement("div");return t.appendChild(e),Object.assign(t.style,{display:"flex",alignItems:"center",justifyContent:"center",width:"16px",height:"16px",cursor:"pointer",marginLeft:"auto",transform:"rotate(180deg)"}),t}();t.append(s,i,n);let r=e=>(this.widgetVisible=e,this.container.style.fontFamily='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',Object.assign(this.container.style,this.widgetVisible?tR:{border:"none",background:"none",padding:0}),this.taskSection&&Object.assign(this.taskSection.style,this.widgetVisible?tP:{display:"none"}),this.descriptionSection&&Object.assign(this.descriptionSection.style,this.widgetVisible?tP:{display:"none"}),this.endSection&&Object.assign(this.endSection.style,this.widgetVisible?tP:{display:"none"}),this.stopButton&&Object.assign(this.stopButton.style,this.widgetVisible?tz:{display:"none"}),e),o=()=>{Object.assign(n.style,{transform:this.widgetVisible?"rotate(0deg)":"rotate(180deg)"}),r(!this.widgetVisible)};return i.onclick=o,n.onclick=o,e=this.bg,s.onmousedown=function(t){let s=e.getBoundingClientRect(),i=t.clientX-s.left,n=t.clientY-s.top;function r(t,r){let o=t-i,a=r-n;o<=5&&(o=5),a<=5&&(a=5),o>=window.innerWidth-s.width&&(o=window.innerWidth-s.width),a>=window.innerHeight-s.height&&(a=window.innerHeight-s.height),e.style.left=`${o}px`,e.style.top=`${a}px`}function o(e){r(e.pageX,e.pageY)}e.style.position="fixed",e.style.zIndex=99999999999999,r(t.pageX,t.pageY),document.addEventListener("mousemove",o);let a=()=>{document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",a)};document.addEventListener("mouseup",a)},s.ondragstart=function(){return!1},this.collapseWidget=()=>r(!1),t}createDescriptionSection(e){let t=t1("div","description_section_or",tP),s=t1("div","description_s_title_or",tL),i=t1("div","title",{fontSize:13,fontWeight:500,lineHeight:"auto"},"Introduction & Guidelines"),n=t1("div","icon",tU,"-"),r=t1("div","content",tF),o=t1("div","text_description",{maxHeight:"250px",overflowY:"auto",whiteSpace:"pre-wrap",fontSize:13,color:"#454545",lineHeight:"auto"});o.innerHTML=e;let a=t1("div","button_begin_or",tH,"Begin Test");s.append(i,n),r.append(o,a),t.append(s,r);let l=()=>{this.widgetGuidelinesVisible=!this.widgetGuidelinesVisible,n.textContent=this.widgetGuidelinesVisible?"-":"+",Object.assign(r.style,this.widgetGuidelinesVisible?tF:{display:"none"})};return s.onclick=l,this.toggleDescriptionVisibility=()=>{this.widgetGuidelinesVisible=!1,n.textContent=this.widgetGuidelinesVisible?"-":"+",Object.assign(r.style,this.widgetGuidelinesVisible?tF:{display:"none"}),r.removeChild(a)},a.onclick=()=>{if(l(),this.test){let e=this.signalManager?.getDurations(),t=e?e.tasks.findIndex(e=>this.test&&e.taskId===this.test.tasks[0].task_id):null;e&&-1===t&&(e.tasks.push({taskId:this.test.tasks[0].task_id,started:this.app.timestamp()}),this.signalManager?.setDurations(e)),this.signalManager?.signalTask(this.test.tasks[0].task_id,"begin")}this.showTaskSection(),r.removeChild(a)},t}createTasksSection(e){this.container.style.fontFamily='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',Object.assign(this.container.style,tR);let t=t1("div","task_section_or",tP),s=t1("div","description_t_title_or",tL),i=t1("div","title",{fontSize:"13px",fontWeight:"500",lineHeight:"auto"},"Tasks"),n=t1("div","icon",tU,"-"),r=t1("div","content",tF),o=t1("div","pagination",t$),a=t1("div","taskCard",tV),l=t1("div","taskText",tK),h=t1("div","taskDescription",tX),c=t1("div","taskButtons",tQ),u=t1("div","taskText",tK);u.textContent="Your answer";let d=t1("textarea","taskDescription",{resize:"vertical"}),p=t1("div","inputArea",tV);p.append(u,d);let f=t1("div","closePanelButton",tJ,"Collapse Panel"),g=t1("div","nextButton",tG,"Done, Next");s.append(i,n),a.append(l,h),c.append(f,g),r.append(o,a,p,c),t.append(s,r);let m=()=>{let t=e[this.currentTaskIndex];l.textContent=t.title,h.textContent=t.description,t.allow_typing?p.style.display="flex":p.style.display="none"};e.forEach((e,t)=>{let s=t1("span",`or_task_${t}`,{outline:"1px solid #efefef",fontSize:"13px",height:"24px",width:"24px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:"6.25em"},(t+1).toString());s.id=`or_task_${t}`,o.append(s)}),this.hideTaskSection=()=>(n.textContent="+",Object.assign(r.style,{display:"none"}),this.widgetTasksVisible=!1,!1),this.showTaskSection=()=>(n.textContent="-",Object.assign(r.style,tF),this.widgetTasksVisible=!0,!0);let b=()=>{let e=document.getElementById(`or_task_${this.currentTaskIndex}`);e&&Object.assign(e.style,tq);for(let e=0;e<this.currentTaskIndex;e++){let t=document.getElementById(`or_task_${e}`);t&&Object.assign(t.style,tW)}};return s.onclick=()=>{this.widgetTasksVisible=!this.widgetTasksVisible,n.textContent=this.widgetTasksVisible?"-":"+",Object.assign(r.style,this.widgetTasksVisible?tF:{display:"none"})},f.onclick=this.collapseWidget,g.onclick=()=>{let t=e[this.currentTaskIndex].allow_typing?d.value:void 0;if(d.value="",this.signalManager?.signalTask(e[this.currentTaskIndex].task_id,"done",t),this.currentTaskIndex<e.length-1){this.currentTaskIndex++,m();let t=this.signalManager?.getDurations();t&&-1===t.tasks.findIndex(t=>t.taskId===e[this.currentTaskIndex].task_id)&&(t.tasks.push({taskId:e[this.currentTaskIndex].task_id,started:this.app.timestamp()}),this.signalManager?.setDurations(t)),this.signalManager?.signalTask(e[this.currentTaskIndex].task_id,"begin"),b()}else this.showEndSection();this.app.localStorage.setItem("or_uxt_task_index",this.currentTaskIndex.toString())},setTimeout(()=>{let e=document.getElementById("or_task_0");e&&Object.assign(e.style,tq),m(),b()},1),t}showEndSection(){let e=!0;this.signalManager?.signalTest("done");let t=t1("div","end_section_or",tB),s=t1("div","end_title_or",{fontSize:"1.25rem",fontWeight:"500"},"Thank you! \uD83D\uDC4D"),i=t1("div","end_description_or",{},this.test?.conclusion??"Thank you for participating in our usability test. Your feedback has been captured and will be used to enhance our website. \n\nWe appreciate your time and valuable input."),n=t1("div","end_button_or",tH,"Submitting Feedback"),r=function(){!function(){let e=document.createElement("style");e.type="text/css",e.innerText=`@keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }`,document.head.appendChild(e)}();let e=document.createElement("div");return e.classList.add("spinner"),Object.assign(e.style,tY),e}();n.appendChild(r),this.test?.reqMic||this.test?.reqCamera?this.userRecorder.sendToAPI().then(()=>{n.removeChild(r),n.textContent="End Session",e=!1}).catch(t=>{console.error(t),n.removeChild(r),n.textContent="End Session",e=!1}):(n.removeChild(r),n.textContent="End Session",e=!1),this.taskSection&&this.container.removeChild(this.taskSection),this.descriptionSection&&this.container.removeChild(this.descriptionSection),this.stopButton&&this.stopButtonContainer&&this.container.removeChild(this.stopButtonContainer),n.onclick=()=>{e||(window.close(),document.body.removeChild(this.bg))},t.append(s,i,n),this.endSection=t,this.container.append(t)}}function t6(e){return!!e&&null!=e.nodeType}function t9(e){return"http://www.w3.org/2000/svg"===e.namespaceURI||"svg"===e.localName}function t7(e){return e.nodeType===Node.ELEMENT_NODE}function se(e){return e.nodeType===Node.TEXT_NODE}function st(e){return e.nodeType===Node.DOCUMENT_NODE}function ss(e){return e.nodeType===Node.DOCUMENT_NODE||e.nodeType===Node.DOCUMENT_FRAGMENT_NODE}function si(e,t){return e.localName===t}class sn{constructor(e,t){this.app=e,this.options=t,this.snapshots={},this.intervals=[],this.restartTracking=()=>{this.clear(),this.app.nodes.scanTree(this.captureCanvas)},this.captureCanvas=e=>{let t=this.app.nodes.getID(e);!t||!si(e,"canvas")||this.app.sanitizer.isObscured(t)||this.app.sanitizer.isHidden(t)||!si(e,"canvas")||this.snapshots[t]||new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target?this.snapshots[t]&&this.snapshots[t].createdAt?this.snapshots[t].paused=!1:this.recordCanvas(e.target,t):this.snapshots[t]&&(this.snapshots[t].paused=!0))})}).observe(e)},this.recordCanvas=(e,t)=>{let s=this.app.timestamp();this.snapshots[t]={images:[],createdAt:s,paused:!1,dummy:document.createElement("canvas")};let i=tv(t.toString(),s);this.app.send(i);let n=e=>{(function(e,t="medium",s,i=!1,n,r){let o=`image/${n}`;if(i){let i=window.devicePixelRatio||1;s.width=e.width/i,s.height=e.height/i;let n=s.getContext("2d");if(!n)return;n.clearRect(0,0,s.width,s.height),n.drawImage(e,0,0,s.width,s.height),s.toBlob(r,o,sr[t])}else e.toBlob(r,o,sr[t])})(e,this.options.quality,this.snapshots[t].dummy,this.options.fixedScaling,this.fileExt,e=>{if(e){if(!this.snapshots[t])return this.app.debug.warn("Canvas not present in snapshots after capture:",this.snapshots,t);this.snapshots[t].images.push({id:this.app.timestamp(),data:e}),this.snapshots[t].images.length>9&&(this.sendSnaps(this.snapshots[t].images,t,this.snapshots[t].createdAt),this.snapshots[t].images=[])}})},r=setInterval(()=>{let s=this.app.nodes.getID(e),i=s?this.app.nodes.getNode(s):void 0;if(!this.snapshots[t]){this.app.debug.log("Canvas is not present in {snapshots}"),clearInterval(r);return}if(i&&si(i,"canvas")&&i===e)this.snapshots[t].paused||(this.options.useAnimationFrame?requestAnimationFrame(()=>{n(i)}):n(i));else{this.app.debug.log("Canvas element not in sync",i,e),clearInterval(r);return}},this.interval);this.intervals.push(r)},this.fileExt=t.fileExt??"webp",this.interval=1e3/t.fps}startTracking(){setTimeout(()=>{this.app.nodes.scanTree(this.captureCanvas),this.app.nodes.attachNodeCallback(this.captureCanvas)},250)}sendSnaps(e,t,s){if(0===Object.keys(this.snapshots).length)return;let i=new FormData;e.forEach(e=>{let n=e.data;n&&(i.append("snapshot",n,`${s}_${t}_${e.id}.${this.fileExt}`),this.options.isDebug&&function(e,t){let s=URL.createObjectURL(e),i=document.createElement("a");i.href=s,i.download=t,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)}(n,`${s}_${t}_${e.id}.${this.fileExt}`))});let n=()=>{this.app.debug.log("Restarting tracker; token expired"),this.app.stop(!1),setTimeout(()=>{this.app.start({},!0)},250)};fetch(this.app.options.ingestPoint+"/v1/web/images",{method:"POST",headers:{Authorization:`Bearer ${this.app.session.getSessionToken()??""}`},body:i}).then(e=>401!==e.status||n()).catch(e=>{this.app.debug.error("error saving canvas",e)})}clear(){this.intervals.forEach(e=>clearInterval(e)),this.snapshots={}}}let sr={low:.35,medium:.55,high:.8};class so{constructor(e=0){this.shouldLog=e=>this.level>=e,this.info=(...e)=>{this.shouldLog(5)&&console.info(...e)},this.log=(...e)=>{this.shouldLog(4)&&console.log(...e)},this.warn=(...e)=>{this.shouldLog(3)&&console.warn(...e)},this.error=(...e)=>{this.shouldLog(2)&&console.error(...e)},this.level=e}}let sa={interval:3e4,batchSize:2500,enabled:!0};class sl{constructor(e,t,s){this.nodes=e,this.unregisterNode=t,this.start=()=>{this.options.enabled&&(this.stop(),this.interval=setInterval(()=>{!function(e,t,s){let i=e.entries();!function e(){let n=[],r=i.next();for(;!r.done&&n.length<t;)n.push(r.value),r=i.next();n.length>0&&(n.forEach(([e,t])=>{t&&s(t)}),setTimeout(e,50))}()}(this.nodes,this.options.batchSize,e=>{(function(e){try{if(!e.isConnected)return[!1,"not connected"];let t=e.nodeType===Node.DOCUMENT_NODE,s=t?e.defaultView:e.ownerDocument?.defaultView,i=t?e:e.ownerDocument;if(!s)return[!1,"no window"];if(s.closed)return[!1,"window closed"];if(!i?.documentElement.isConnected)return[!1,"documentElement not connected"];return[!0,"ok"]}catch(e){return[!1,e]}})(e)[0]||this.unregisterNode(e)})},this.options.interval))},this.stop=()=>{this.interval&&clearInterval(this.interval)},this.options={...sa,...s}}}class sh{constructor(e){this.nodes=new Map,this.totalNodeAmount=0,this.nodeCallbacks=[],this.elementListeners=new Map,this.nextNodeId=0,this.attachNodeCallback=e=>this.nodeCallbacks.push(e),this.scanTree=e=>{this.nodes.forEach(t=>t?e(t):void 0)},this.attachNodeListener=(e,t,s,i=!0)=>{let n=this.getID(e);if(void 0===n)return;eO(e,t,s,i,this.forceNgOff);let r=this.elementListeners.get(n);void 0===r&&(r=[],this.elementListeners.set(n,r)),r.push([t,s,i])},this.unregisterNode=e=>{let t=e[this.node_id];if(void 0!==t){e[this.node_id]=void 0,delete e[this.node_id],this.nodes.delete(t);let s=this.elementListeners.get(t);void 0!==s&&(this.elementListeners.delete(t),s.forEach(t=>eR(e,t[0],t[1],t[2],this.forceNgOff))),this.totalNodeAmount--}return t},this.node_id=e.node_id,this.forceNgOff=e.forceNgOff,this.maintainer=new sl(this.nodes,this.unregisterNode,e.maintainer),this.maintainer.start()}syntheticMode(e){let t=99999999*e;if(t>Number.MAX_SAFE_INTEGER)throw Error("Placeholder id overflow");this.nextNodeId=t}registerNode(e){let t=e[this.node_id],s=void 0===t;return s&&(t=this.nextNodeId,this.totalNodeAmount++,this.nextNodeId++,this.nodes.set(t,e),e[this.node_id]=t),[t,s]}cleanTree(){for(let[e,t]of this.nodes)t&&!document.contains(t)&&this.unregisterNode(t)}callNodeCallbacks(e,t){this.nodeCallbacks.forEach(s=>s(e,t))}getID(e){if(e)return e[this.node_id]}getNode(e){return this.nodes.get(e)}getNodeCount(){return this.totalNodeAmount}clear(){for(let[e,t]of this.nodes)t&&this.unregisterNode(t);this.nextNodeId=0,this.nodes.clear()}}let sc=99e6;function su(e){return ss(e)&&!!e.adoptedStyleSheets}let sd=15;function sp(){return sd++}let sf=new Map,sg={},sm={};async function sb(e,t,s){try{let i;let n=e.getAttribute("xlink:href")||e.getAttribute("href");if(!n){console.debug("Openreplay: xlink:href or href not found on <use>.");return}let[r,o]=n.split("#");if(!r&&o){let e;e=n.startsWith("#")?`#${CSS.escape(n.substring(1))}`:CSS.escape(n);let t=document.querySelector(e);if(t){let e=`
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="${t.getAttribute("viewBox")||"0 0 24 24"}">
          ${t.innerHTML}
        </svg>
      `;return sg[o]=e,e}console.warn("Openreplay: Sprite symbol not found in the document.");return}if(!r&&!o){console.warn("Openreplay: Invalid xlink:href or href found on <use>.");return}if(sg[o])return sg[o];if(sm[r])1===sm[r]?await new Promise(e=>{let t=0,s=setInterval(()=>{t>100&&(clearInterval(s),e(!1)),1!==sm[r]?(i=sm[r],clearInterval(s),e(!0)):t++},100)}):i=sm[r]??'<svg xmlns="http://www.w3.org/2000/svg"></svg>';else{sm[r]=1;let e=await fetch(r),t=await e.text();i=s.parseFromString(t,"image/svg+xml"),sm[r]=i}let a=i.getElementById(o);if(!a)return console.debug("Openreplay: Symbol not found in SVG."),"";if("svgtext"===t){let e=`
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="${a.getAttribute("viewBox")||"0 0 24 24"}">
          ${a.innerHTML}
        </svg>
      `;return sg[o]=e,e}console.debug(`Openreplay: Unknown mode: ${t}. Use "inline" or "dataurl".`)}catch(e){console.error("Openreplay: Error processing <use> element:",e)}}function sy(e){if(e.nodeType===Node.COMMENT_NODE)return!0;if(se(e))return!1;if(!t7(e))return!0;let t=e.tagName.toUpperCase();if("LINK"===t){let t=e.getAttribute("rel"),s=e.getAttribute("as");return!(t?.includes("stylesheet")||"style"===s||"font"===s)}return"SCRIPT"===t||"NOSCRIPT"===t||"META"===t||"TITLE"===t||"BASE"===t}function sv(e){return!!ss(e)||!sy(e)}(s9=is||(is={}))[s9.New=0]="New",s9[s9.Removed=1]="Removed",s9[s9.Changed=2]="Changed";class sS{constructor(e,t=!1,s={}){this.app=e,this.isTopContext=t,this.commited=[],this.recents=new Map,this.indexes=[],this.attributesMap=new Map,this.textSet=new Set,this.disableSprites=!1,this.inlineRemoteCss=!1,this.inlinerOptions=void 0,this.domParser=new DOMParser,this.disableSprites=!!s.disableSprites,this.inlineRemoteCss=!!s.inlineRemoteCss,this.inlinerOptions=s.inlinerOptions,this.observer=eN(this.app.safe(e=>{for(let t of e){let e=t.target,s=t.type;if(!sv(e))continue;if("childList"===s){for(let e=0;e<t.removedNodes.length;e++)sv(t.removedNodes[e])&&this.bindNode(t.removedNodes[e]);for(let e=0;e<t.addedNodes.length;e++)this.bindTree(t.addedNodes[e]);continue}let i=this.app.nodes.getID(e);if(void 0!==i){if(this.recents.has(i)||this.recents.set(i,is.Changed),"attributes"===s){let e=t.attributeName;if(null===e)continue;let s=this.attributesMap.get(i);void 0===s&&this.attributesMap.set(i,s=new Set),s.add(e);continue}if("characterData"===s){this.textSet.add(i);continue}}}this.commitNodes()}),this.app.options.forceNgOff)}clear(){this.commited.length=0,this.recents.clear(),this.indexes.length=1,this.attributesMap.clear(),this.textSet.clear()}handleIframeSrcChange(e){let t=e.contentDocument;if(t&&void 0!==this.app.nodes.getID(t)){let s=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT+NodeFilter.SHOW_TEXT,{acceptNode:e=>sy(e)||void 0===this.app.nodes.getID(e)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT},!1),i=0,n=this.app.nodes.getNodeCount(),r=e.contentDocument,o=this.app.nodes.unregisterNode.bind(this.app.nodes);for(;s.nextNode();)r.contains(s.currentNode)||(i+=1,o(s.currentNode));let a=Math.floor(i/n*100);a>30&&this.app.send(tg(a))}}sendNodeAttribute(e,t,s,i){if(t9(t)){if(s.startsWith("xlink:")&&(s=s.substring(6)),null===i&&this.app.send(eq(e,s)),"use"===t.localName&&"href"===s&&!this.disableSprites){sb(t,"svgtext",this.domParser).then(t=>{t&&this.app.send(e$(e,s,`_$OPENREPLAY_SPRITE$_${t}`))}).catch(e=>{console.error("Openreplay: Error parsing <use> element:",e)});return}"href"===s?(i.length>1e5&&(i=""),this.app.send(e9(e,s,i,this.app.getBaseHref()))):this.app.attributeSender.sendSetAttribute(e,s,i);return}if(!("src"===s||"srcset"===s||"integrity"===s||"crossorigin"===s||"autocomplete"===s||"on"===s.substring(0,2)||"value"===s&&si(t,"input")&&"button"!==t.type&&"reset"!==t.type&&"submit"!==t.type)){if(null===i){this.app.send(eq(e,s));return}if("style"===s||"href"===s&&si(t,"link")){if("rel"in t&&"stylesheet"===t.rel&&this.inlineRemoteCss){setTimeout(()=>{!function(e,t,s,i,n,r,o,a,l){let h=a?null:i();a||r(h,t);let c=e.sheet;if(c&&!o)try{let e=function e(t){try{var s;let i=t.rules||t.cssRules;if(!i)return null;let n=t.href;return!n&&t.ownerNode&&t.ownerNode.ownerDocument&&(n=t.ownerNode.ownerDocument.location.href),(s=Array.from(i,t=>(function(t,s){if("styleSheet"in t){let s;try{s=e(t.styleSheet)||function(e){let{cssText:t}=e;if(t.split('"').length<3)return t;let s=["@import",`url(${JSON.stringify(e.href)})`];return""===e.layerName?s.push("layer"):e.layerName&&s.push(`layer(${e.layerName})`),e.supportsText&&s.push(`supports(${e.supportsText})`),e.media.length&&s.push(e.media.mediaText),s.join(" ")+";"}(t)}catch(e){s=t.cssText}return t.styleSheet.href?d(s,t.styleSheet.href):s}{let e=t.cssText;return("selectorText"in t&&t.selectorText.includes(":")&&(e=e.replace(/(\[(?:[\w-]+)[^\\])(:(?:[\w-]+)\])/gm,"$1\\$2")),s)?d(e,s):e}})(t,n)).join("")).includes(" background-clip: text;")&&!s.includes(" -webkit-background-clip: text;")&&(s=s.replace(/\sbackground-clip:\s*text;/g," -webkit-background-clip: text; background-clip: text;")),s}catch(e){return null}}(c);if(e){u(e);return}}catch(e){}function u(e){let t=function(e){let t=[],s=!1,i=!1,n="",r=0,o="";for(let a=0;a<e.length;a++){let l=e[a],h=e[a+1]||"";if(!i&&"/"===l&&"*"===h){s=!0,a++;continue}if(s){"*"===l&&"/"===h&&(s=!1,a++);continue}if(!i&&('"'===l||"'"===l)){i=!0,n=l,o+=l;continue}if(i){o+=l,l===n&&"\\"!==e[a-1]&&(i=!1);continue}o+=l,"{"===l?r++:"}"===l&&0==--r&&(t.push(o.trim()),o="")}return o.trim()&&t.push(o.trim()),t}(e=e.replace(/\/\*[\s\S]*?\*\//g,""));for(let e=0;e<t.length;e++)n(h,t[e],e,s)}function d(e,t){if(!e)return"";let s=/^(?:[a-z+]+:)?\/\//i,i=/^www\..*/i,n=/^(data:)([^,]*),(.*)/i;return e.replace(/url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm,(e,r,o,a,l,h)=>{let c=o||l||h,u=r||a||"";if(!c)return e;if(s.test(c)||i.test(c)||n.test(c))return`url(${u}${c}${u})`;if("/"===c[0])return`url(${u}${(t.indexOf("//")>-1?t.split("/").slice(0,3).join("/"):t.split("/")[0]).split("?")[0]+c}${u})`;let d=t.split("/"),p=c.split("/");for(let e of(d.pop(),p))"."!==e&&(".."===e?d.pop():d.push(e));return`url(${u}${d.join("/")}${u})`})}e.href&&fetch(e.href).then(e=>{if(!e.ok)throw Error(`response status ${e.status}`);return e.text()}).then(e=>{a&&l?l(e,sc++):u(e)}).catch(t=>{console.error(`OpenReplay: Failed to fetch CSS from ${e.href}:`,t)})}(t,e,this.app.getBaseHref(),sp,(e,t,s,i)=>{this.app.send(tr(e,t,s,i))},(e,t)=>{this.app.send(ta(e,t))},this.inlinerOptions?.forceFetch,this.inlinerOptions?.forcePlain,(t,s)=>{this.app.send(eU(s,e,0)),setTimeout(()=>{this.app.send(e7(s,t,this.app.getBaseHref()))},10)})},0);return}this.app.send(e9(e,s,i,this.app.getBaseHref()));return}("href"===s||i.length>1e5)&&(i=""),["alt","placeholder"].includes(s)&&this.app.sanitizer.privateMode&&(i=i.replaceAll(/./g,"*")),this.app.attributeSender.sendSetAttribute(e,s,i)}}sendNodeData(e,t,s){if(si(t,"style")){this.app.send(e7(e,s,this.app.getBaseHref()));return}s=this.app.sanitizer.sanitize(e,s),this.app.send(eW(e,s))}bindNode(e){let[t,s]=this.app.nodes.registerNode(e);s?this.recents.set(t,is.New):this.recents.get(t)!==is.New&&this.recents.set(t,is.Removed)}bindTree(e){if(!sv(e))return;this.bindNode(e);let t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT+NodeFilter.SHOW_TEXT,{acceptNode:e=>(void 0!==this.app.nodes.getID(e)&&this.app.debug.info("! Node is already bound",e),sy(e)||void 0!==this.app.nodes.getID(e)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT)},!1);for(;t.nextNode();)this.bindNode(t.currentNode)}unbindTree(e){let t=this.app.nodes.unregisterNode(e);if(void 0!==t&&this.recents.get(t)===is.Removed){this.app.send(ez(t));let s=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT+NodeFilter.SHOW_TEXT,{acceptNode:e=>sy(e)||void 0===this.app.nodes.getID(e)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT},!1),i=0,n=this.app.nodes.getNodeCount();for(;s.nextNode();)i+=1,this.app.nodes.unregisterNode(s.currentNode);let r=Math.floor(i/n*100);r>30&&this.app.send(tg(r))}}_commitNode(e,t){let s;if(ss(t))return!0;let i=t.assignedSlot?t.assignedSlot:t.parentNode;if(!si(t,"html")||!this.isTopContext){if(null===i||void 0===(s=this.app.nodes.getID(i))||!this.commitNode(s))return this.unbindTree(t),!1;if(this.app.sanitizer.handleNode(e,s,t),this.app.sanitizer.isHidden(s))return!1}let n=t.previousSibling;for(;null!==n;){let t=this.app.nodes.getID(n);if(void 0!==t){this.commitNode(t),this.indexes[e]=this.indexes[t]+1;break}n=n.previousSibling}null===n&&(this.indexes[e]=0);let r=this.recents.get(e),o=r===is.New,a=this.indexes[e];if(void 0===a)throw"commitNode: missing node index";if(o){if(t7(t)){let i=t;if(void 0!==s){if(this.app.sanitizer.isHidden(e)){let e=i.clientWidth,s=i.clientHeight;(i=t.cloneNode()).style.width=`${e}px`,i.style.height=`${s}px`}"rel"in i&&"stylesheet"===i.rel&&this.inlineRemoteCss?this.app.send(eB(e,s,a,"STYLE",!1)):this.app.send(eB(e,s,a,i.tagName,t9(t)))}for(let t=0;t<i.attributes.length;t++){let s=i.attributes[t];this.sendNodeAttribute(e,i,s.nodeName,s.value)}}else se(t)&&(this.app.send(eU(e,s,a)),this.sendNodeData(e,i,t.data));return!0}r===is.Removed&&void 0!==s&&this.app.send(eH(e,s,a));let l=this.attributesMap.get(e);if(void 0!==l){if(!t7(t))throw"commitNode: node is not an element";for(let s of l)this.sendNodeAttribute(e,t,s,t.getAttribute(s))}if(this.textSet.has(e)){if(!se(t))throw"commitNode: node is not a text";this.sendNodeData(e,i,t.data)}return!0}commitNode(e){let t=this.app.nodes.getNode(e);if(!t)return!1;let s=this.commited[e];return void 0!==s?s:this.commited[e]=this._commitNode(e,t)}commitNodes(e=!1){let t;for(let[s,i]of this.recents.entries())this.commitNode(s),i===is.New&&(t=this.app.nodes.getNode(s))&&this.app.nodes.callNodeCallbacks(t,e);this.clear()}observeRoot(e,t,s=e){this.observer.observe(e,{childList:!0,attributes:!0,characterData:!0,subtree:!0,attributeOldValue:!1,characterDataOldValue:!1}),this.bindTree(s),t(this.app.nodes.getID(e)),this.commitNodes(!0)}disconnect(){this.observer.disconnect(),this.clear()}}class sw extends sS{observe(e){let t=e.contentDocument,s=this.app.nodes.getID(e);t&&void 0!==s&&this.observeRoot(t,e=>{if(void 0===e){this.app.debug.log("OpenReplay: Iframe document not bound");return}this.docId=e,this.app.send(ti(s,e))})}syntheticObserve(e,t){this.observeRoot(t,t=>{if(void 0===t){this.app.debug.log("OpenReplay: Iframe document not bound");return}this.app.send(ti(e,t))})}}class sk extends sS{observe(e){let t=e.shadowRoot,s=this.app.nodes.getID(e);t&&void 0!==s&&this.observeRoot(t,e=>{if(void 0===e){this.app.debug.error("OpenReplay: Shadow Root was not bound");return}this.app.send(ti(s,e))})}}class sT{constructor(){this.states=new WeakMap}calcOffset(e){let t=0,s=0;if(e.parent&&([t,s]=this.calcOffset(e.parent)),!e.offset){let{left:t,top:s}=e.iFrame.getBoundingClientRect();e.offset=[t,s]}let[i,n]=e.offset;return[t+i,s+n]}getDocumentOffset(e){let t=this.states.get(e);return t?this.calcOffset(t):[0,0]}observe(e){let t=e.contentDocument;if(!t)return;let s=e.ownerDocument,i={offset:null,iFrame:e,parent:this.states.get(s)||null,clear:()=>{s.removeEventListener("scroll",n),s.defaultView?.removeEventListener("resize",n)}},n=()=>{i.offset=null};s.addEventListener("scroll",n),s.defaultView?.addEventListener("resize",n),this.states.set(t,i)}clear(){this.states=new WeakMap}}(s7=ii||(ii={}))[s7.Disabled=0]="Disabled",s7[s7.Inline=1]="Inline",s7[s7.InlineFetched=2]="InlineFetched",s7[s7.PlainFetched=3]="PlainFetched";let sI=ed?Element.prototype.attachShadow:()=>new ShadowRoot;class sx extends sS{constructor(e){let t=Object.assign({captureIFrames:!0,disableSprites:!1,inlineCss:0},e.options);super(e.app,!0,{disableSprites:t.disableSprites,...function(e){switch(e){case ii.Inline:return{inlineRemoteCss:!0,inlinerOptions:{forceFetch:!1,forcePlain:!1}};case ii.InlineFetched:return{inlineRemoteCss:!0,inlinerOptions:{forceFetch:!0,forcePlain:!1}};case ii.PlainFetched:return{inlineRemoteCss:!0,inlinerOptions:{forceFetch:!0,forcePlain:!0}};case ii.Disabled:default:return{inlineRemoteCss:!1,inlinerOptions:{forceFetch:!1,forcePlain:!1}}}}(t.inlineCss)}),this.iframeOffsets=new sT,this.contextCallbacks=[],this.contextsSet=new WeakSet,this.iframeObserversArr=[],this.iframeObservers=new WeakMap,this.docObservers=new WeakMap,this.shadowRootObservers=new WeakMap,this.app=e.app,this.options=t,this.app.nodes.attachNodeCallback(e=>{si(e,"iframe")&&(this.options.captureIFrames&&!eI(e,"obscured")||eI(e,"capture"))&&this.handleIframe(e)}),this.app.nodes.attachNodeCallback(e=>{t7(e)&&null!==e.shadowRoot&&this.handleShadowRoot(e.shadowRoot)})}attachContextCallback(e){this.contextCallbacks.push(e)}getDocumentOffset(e){return this.iframeOffsets.getDocumentOffset(e)}handleIframe(e){let t=this.app.safe(()=>setTimeout(()=>{let t=this.app.nodes.getID(e);if(void 0===t||!function(e){try{return!!e.contentDocument}catch(e){return!1}}(e))return;let s=e.contentWindow,i=e.contentDocument;if(!i){this.app.debug.warn("no doc for iframe found",e);return}if(i&&this.docObservers.has(i)){this.app.debug.info("doc already observed for",t);return}let n=new sw(this.app,!1,{});this.iframeObservers.set(e,n),this.docObservers.set(i,n),this.iframeObserversArr.push(n),n.observe(e),this.iframeOffsets.observe(e),s&&s===s.window&&!this.contextsSet.has(s)&&(this.contextsSet.add(s),this.contextCallbacks.forEach(e=>e(s)))},250));e.addEventListener("load",t),t()}handleShadowRoot(e){let t=new sk(this.app);this.shadowRootObservers.set(e,t),t.observe(e.host)}observe(){let e=this;Element.prototype.attachShadow=function(){let t=sI.apply(this,arguments);return e.handleShadowRoot(t),t},this.app.nodes.clear(),this.observeRoot(window.document,()=>{this.app.send(eP()),this.app.nodes.callNodeCallbacks(document,!0)},window.document.documentElement)}crossdomainObserve(e,t){let s=this;Element.prototype.attachShadow=function(){let e=sI.apply(this,arguments);return s.handleShadowRoot(e),e},this.app.nodes.clear(),this.app.nodes.syntheticMode(t);let i=new sw(this.app);this.iframeObservers.set(window.document,i),i.syntheticObserve(e,window.document)}disconnect(){this.iframeOffsets.clear(),Element.prototype.attachShadow=sI,this.iframeObserversArr.forEach(e=>e.disconnect()),this.iframeObserversArr=[],this.iframeObservers=new WeakMap,this.shadowRootObservers=new WeakMap,this.docObservers=new WeakMap,super.disconnect()}}(ie=ir||(ir={}))[ie.Plain=0]="Plain",ie[ie.Obscured=1]="Obscured",ie[ie.Hidden=2]="Hidden";let sC=e=>e.trim().replace(/[^\f\n\r\t\v\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff\s]/g,"*");class sE{constructor(e){this.obscured=new Set,this.hidden=new Set,this.app=e.app,this.privateMode=e.options?.privateMode??!1,this.options=Object.assign({obscureTextEmails:!0,obscureTextNumbers:!1,privateMode:!1,domSanitizer:void 0},e.options)}handleNode(e,t,s){if(this.options.privateMode&&(t7(s)&&!eI(s,"unmask")||se(s)&&!eI(s.parentNode,"unmask")))return this.obscured.add(e);if((this.obscured.has(t)||t7(s)&&(eI(s,"masked")||eI(s,"obscured")))&&this.obscured.add(e),(this.hidden.has(t)||t7(s)&&(eI(s,"htmlmasked")||eI(s,"hidden")))&&this.hidden.add(e),void 0!==this.options.domSanitizer&&t7(s)){let t=this.options.domSanitizer(s);t===ir.Obscured&&this.obscured.add(e),t===ir.Hidden&&this.hidden.add(e)}}sanitize(e,t){return this.obscured.has(e)?sC(t):(this.options.obscureTextNumbers&&(t=t.replace(/\d/g,"0")),this.options.obscureTextEmails&&(t=t.replace(/^\w+([+.-]\w+)*@\w+([.-]\w+)*\.\w{2,3}$/g,e=>{let[t,s]=e.split("@"),[i,n]=s.split(".");return`${eb(t)}@${eb(i)}.${eb(n)}`})),t)}isObscured(e){return this.obscured.has(e)}isHidden(e){return this.hidden.has(e)}getInnerTextSecure(e){let t=this.app.nodes.getID(e);return t?this.sanitize(t,e.innerText):""}clear(){this.obscured.clear(),this.hidden.clear()}}class s_{constructor(e){this.metadata={},this.userID=null,this.callbacks=[],this.timestamp=0,this.getPageNumber=()=>{let e=this.app.sessionStorage.getItem(this.options.session_pageno_key);if(null!=e)return parseInt(e)},this.incPageNo=()=>{let e=this.getPageNumber();return void 0===e?e=0:e++,this.app.sessionStorage.setItem(this.options.session_pageno_key,e.toString()),e},this.app=e.app,this.options=e.options,this.createTabId()}attachUpdateCallback(e){this.callbacks.push(e)}handleUpdate(e){null==e.userID&&delete e.userID,null==e.sessionID&&delete e.sessionID,this.callbacks.forEach(t=>t(e))}assign(e){void 0!==e.userID&&(this.userID=e.userID),void 0!==e.metadata&&Object.entries(e.metadata).forEach(([e,t])=>this.metadata[e]=t),void 0!==e.sessionID&&(this.sessionID=e.sessionID),void 0!==e.timestamp&&(this.timestamp=e.timestamp),void 0!==e.projectID&&(this.projectID=e.projectID),this.handleUpdate(e)}setMetadata(e,t){this.metadata[e]=t,this.handleUpdate({metadata:{[e]:t}})}setUserID(e){this.userID=e,this.handleUpdate({userID:e})}setUserInfo(e){this.userInfo=e}getSessionToken(e){let t=this.token||this.app.sessionStorage.getItem(this.options.session_token_key);if(e&&t){let s=t.split("_&_")[1];if(!s||s!==e){this.app.sessionStorage.removeItem(this.options.session_token_key),this.token=void 0;return}}return(t?t.split("_&_")[0]:null)||void 0}setSessionToken(e,t){this.token=e,this.app.sessionStorage.setItem(this.options.session_token_key,`${e}_&_${t}`)}applySessionHash(e){let t=decodeURI(e).split("&"),s=e,i="100500";2==t.length&&([i,s]=t),i&&s&&(this.app.sessionStorage.setItem(this.options.session_token_key,s),this.app.sessionStorage.setItem(this.options.session_pageno_key,i))}getSessionHash(){let e=this.getPageNumber(),t=this.getSessionToken();if(void 0!==e&&void 0!==t)return encodeURI(String(e)+"&"+t)}getTabId(){return this.tabId||this.createTabId(),this.tabId}regenerateTabId(){let e=function(e){let t=new Uint8Array(6),s=window.crypto||window.msCrypto;return s?(s.getRandomValues(t),Array.from(t,eC).join("")):Array.from({length:12},()=>eC(Math.floor(16*Math.random()))).join("")}(0);this.app.sessionStorage.setItem(this.options.session_tabid_key,e),this.tabId=e}createTabId(){let e=this.app.sessionStorage.getItem(this.options.session_tabid_key);e?this.tabId=e:this.regenerateTabId()}getInfo(){return{sessionID:this.sessionID,metadata:this.metadata,userID:this.userID,timestamp:this.timestamp,projectID:this.projectID}}reset(){this.app.sessionStorage.removeItem(this.options.session_token_key),this.metadata={},this.userID=null,this.sessionID=void 0,this.timestamp=0}}class sN{constructor(e){this.app=e,this.timer=null,this.callbacks=[]}attach(e,t=0,s=!0,i){var n;let r;i&&(e=e.bind(i)),s&&(e=this.app.safe(e)),this.callbacks.unshift(t?(n=e,r=0,()=>{r++>=t&&(r=0,n())}):e)}start(){null===this.timer&&(this.timer=setInterval(()=>this.callbacks.forEach(e=>{e&&e()}),30))}stop(){null!==this.timer&&(clearInterval(this.timer),this.timer=null)}}let sO="canceled",sR="or_uxt_active",sM="or_buffer_1",sD=e=>({reason:e,success:!1}),sA=e=>({...e,success:!0});function sL(){let e=-1*new Date().getTimezoneOffset();return`UTC${e>=0?"+":"-"}${String(Math.floor(Math.abs(e)/60)).padStart(2,"0")}:${String(Math.abs(e)%60).padStart(2,"0")}`}(it=io||(io={}))[it.NotActive=0]="NotActive",it[it.Starting=1]="Starting",it[it.Active=2]="Active",it[it.ColdStart=3]="ColdStart";let sF=e=>new Promise(t=>setTimeout(t,e)),sj={ask:"never-gonna-give-you-up",resp:"never-gonna-let-you-down",reg:"never-gonna-run-around-and-desert-you",iframeSignal:"tracker inside a child iframe",iframeId:"getting node id for child iframe",iframeBatch:"batch of messages from an iframe window",parentAlive:"signal that parent is live",killIframe:"stop tracker inside frame",startIframe:"start tracker inside frame",polling:"hello-how-are-you-im-under-the-water-please-help-me"};class sP{constructor(e,t,s,i,n){if(this.signalError=i,this.insideIframe=n,this.messages=[],this.bufferedMessages1=[],this.bufferedMessages2=[],this.startCallbacks=[],this.stopCallbacks=[],this.commitCallbacks=[],this.activityState=io.NotActive,this.version="16.4.7",this.socketMode=!1,this.compressionThreshold=24e3,this.bc=null,this.canvasRecorder=null,this.conditionsManager=null,this.canStart=!1,this.rootId=null,this.pageFrames=[],this.frameOderNumber=0,this.features={"feature-flags":!0,"usability-test":!0},this.emptyBatchCounter=0,this.parentActive=!1,this.checkStatus=()=>this.parentActive,this.parentCrossDomainFrameListener=e=>{let{data:t}=e;if(t&&e.source!==window){if(t.line===sj.startIframe){if(this.active())return;try{this.allowAppStart(),this.start()}catch(e){console.error("children frame restart failed:",e)}}t.line===sj.parentAlive&&(this.parentActive=!0),t.line===sj.iframeId&&(this.parentActive=!0,this.rootId=t.id,this.session.setSessionToken(t.token,this.projectKey),this.frameOderNumber=t.frameOrderNumber,this.debug.log("starting iframe tracking",t),this.allowAppStart()),t.line===sj.killIframe&&this.active()&&this.stop()}},this.trackedFrames=[],this.crossDomainIframeListener=e=>{if(!this.active()||e.source===window)return;let{data:t}=e;if(t){if(t.line===sj.iframeSignal&&(e.source?.postMessage({ping:!0,line:sj.parentAlive},"*"),(async()=>{if(null===e.source)return console.error("Couldnt connect to event.source for child iframe tracking");let s=await this.checkNodeId(e.source);if(!s){this.debug.log("Couldnt get node id for iframe",e.source);return}try{this.trackedFrames.includes(t.context)?this.debug.log("Trying to observe already added iframe; ignore if its a restart"):this.trackedFrames.push(t.context),await this.waitStarted();let i=this.session.getSessionToken(this.projectKey),n=this.trackedFrames.findIndex(e=>e===t.context)+1;0===n&&this.debug.error("Couldnt get order number for iframe",t.context,this.trackedFrames);let r={line:sj.iframeId,id:s,token:i,frameOrderNumber:n};this.debug.log("Got child frame signal; nodeId",s,e.source,r),e.source?.postMessage(r,"*")}catch(e){console.error(e)}})()),t.line===sj.iframeBatch){let s=t.messages.map(t=>{if(20===t[0]){let s=t;return this.pageFrames.forEach(i=>{if(i.contentWindow===e.source){let[e,n,r]=t,{left:o,top:a}=i.getBoundingClientRect();s=[e,n+o,r+a]}}),s}if(68===t[0]){let s=t;return this.pageFrames.forEach(i=>{if(i.contentWindow===e.source){let[e,n,r,o,a,l,h]=t,{left:c,top:u,width:d,height:p}=i.getBoundingClientRect();s=[e,n,r,o,a,Math.round((l/100*d+c)/document.documentElement.scrollWidth*1e3)/10,Math.round((h/100*p+u)/document.documentElement.scrollHeight*1e3)/10]}}),s}return t});this.messages.push(...s)}if(t.line===sj.polling){if(!this.pollingQueue.order.length)return;let s=this.pollingQueue.order[0];if(s&&0===this.pollingQueue[s].length){this.pollingQueue.order=this.pollingQueue.order.filter(e=>e!==s);return}this.pollingQueue[s].includes(t.context)&&(this.pollingQueue[s]=this.pollingQueue[s].filter(e=>e!==t.context),e.source?.postMessage({line:s},"*"),0===this.pollingQueue[s].length&&this.pollingQueue.order.shift())}}},this.pollingQueue={order:[]},this.addCommand=e=>{this.pollingQueue.order.push(e),this.pollingQueue[e]=[...this.trackedFrames]},this.bootChildrenFrames=async()=>{await this.waitStarted(),this.addCommand(sj.startIframe)},this.killChildrenFrames=()=>{this.addCommand(sj.killIframe)},this.signalIframeTracker=()=>{let e=this.session.getTabId();window.parent.postMessage({line:sj.iframeSignal,source:e,context:this.contextId},this.options.crossdomain?.parentDomain??"*");let t=0,s=250,i=0,n=!1,r=()=>{if(n||this.checkStatus()){n=!0;return}window.parent.postMessage({line:sj.iframeSignal,source:e,context:this.contextId},this.options.crossdomain?.parentDomain??"*"),this.debug.info("Trying to signal to parent, attempt:",t+1),t++};for(let e=0;e<10;e++){if(this.checkStatus()){n=!0;break}setTimeout(()=>{r()},i+=s),s*=1.5}},this.startTimeout=null,this.send=(e,t=!1)=>{this.activityState!==io.NotActive&&(this.activityState===io.ColdStart?(this.bufferedMessages1.push(e),this.singleBuffer||this.bufferedMessages2.push(e),this.conditionsManager?.processMessage(e)):this.messages.push(e),this.activityState===io.Active&&t&&this.commit())},this.coldStartCommitN=0,this.delay=0,this.attachStartCallback=(e,t=!1)=>{t&&(e=this.safe(e)),this.startCallbacks.push(e)},this.attachStopCallback=(e,t=!1)=>{t&&(e=this.safe(e)),this.stopCallbacks.push(e)},this.attachEventListener=(e,t,s,i=!0,n=!0)=>{i&&(s=this.safe(s)),this.attachStartCallback(()=>e?eO(e,t,s,n,this.options.forceNgOff):null,i),this.attachStopCallback(()=>e?eR(e,t,s,n,this.options.forceNgOff):null,i)},this.coldInterval=null,this.orderNumber=0,this.coldStartTs=0,this.singleBuffer=!1,this.coldStart=async(e={},t)=>{this.singleBuffer=!1;let s=this.checkSessionToken(e.forceNew);t&&await this.setupConditionalStart(e);let i=()=>{this.orderNumber+=1,eg(),this.coldStartTs=em(),this.orderNumber%2==0?(this.bufferedMessages1.length=0,this.bufferedMessages1.push(eL(this.timestamp())),this.bufferedMessages1.push(ty(this.session.getTabId()))):(this.bufferedMessages2.length=0,this.bufferedMessages2.push(eL(this.timestamp())),this.bufferedMessages2.push(ty(this.session.getTabId()))),this.stop(!1),this.activityState=io.ColdStart,e.sessionHash&&this.session.applySessionHash(e.sessionHash),e.forceNew&&this.session.reset(),this.session.assign({userID:e.userID,metadata:e.metadata}),s||(this.debug.log("continuing session on new tab",this.session.getTabId()),this.send(tb(this.session.getTabId()))),this.observer.observe(),this.ticker.start()};this.coldInterval=setInterval(()=>{i()},3e4),i()},this.setupConditionalStart=async e=>{this.conditionsManager=new ea(this,e);let t=await fetch(this.options.ingestPoint+"/v1/web/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...this.getTrackerInfo(),timestamp:em(),doNotRecord:!0,bufferDiff:0,userID:this.session.getInfo().userID,token:void 0,deviceMemory:tx,jsHeapSizeLimit:tC,timezone:sL(),width:window.screen.width,height:window.screen.height})}),{token:s,userBrowser:i,userCity:n,userCountry:r,userDevice:o,userOS:a,userState:l,projectID:h,features:c}=await t.json();this.features=c||this.features,this.session.assign({projectID:h}),this.session.setUserInfo({userBrowser:i,userCity:n,userCountry:r,userDevice:o,userOS:a,userState:l});let u={sessionToken:s,userUUID:"",sessionID:""};this.startCallbacks.forEach(e=>e(u)),await this.conditionsManager?.fetchConditions(h,s),this.features["feature-flags"]&&(await this.featureFlags.reloadFlags(s),this.conditionsManager?.processFlags(this.featureFlags.flags)),await this.tagWatcher.fetchTags(this.options.ingestPoint,s)},this.onSessionSent=()=>{},this.offlineRecording=(e={},t)=>{this.onSessionSent=t,this.singleBuffer=!0;let s=this.checkSessionToken(e.forceNew);eg(),this.coldStartTs=em();let i=this.localStorage.getItem(sM);if(i){let e=JSON.parse(i);this.bufferedMessages1=Array.isArray(e)?e:this.bufferedMessages1,this.localStorage.removeItem(sM)}this.bufferedMessages1.push(eL(this.timestamp())),this.bufferedMessages1.push(ty(this.session.getTabId())),this.activityState=io.ColdStart,e.sessionHash&&this.session.applySessionHash(e.sessionHash),e.forceNew&&this.session.reset(),this.session.assign({userID:e.userID,metadata:e.metadata});let n={sessionToken:"",userUUID:"",sessionID:""};return this.startCallbacks.forEach(e=>e(n)),s||this.send(tb(this.session.getTabId())),this.observer.observe(),this.ticker.start(),{saveBuffer:this.saveBuffer,getBuffer:this.getBuffer,setBuffer:this.setBuffer}},this.saveBuffer=()=>{this.localStorage.setItem(sM,JSON.stringify(this.bufferedMessages1))},this.getBuffer=()=>this.bufferedMessages1,this.setBuffer=e=>{this.bufferedMessages1=e},this.prevOpts={},this.restartCanvasTracking=()=>{this.canvasRecorder?.restartTracking()},this.flushBuffer=async e=>new Promise((t,s)=>{if(0===e.length){t(null);return}let i=1;for(;i<e.length&&0!==e[i][0];)i++;eA(()=>{try{let s=e.splice(0,i);this.postToWorker(s.map(e=>[...e])),t(null)}catch(e){this._debug("flushBuffer",e),s(Error("flushBuffer failed"))}})}),this.onUxtCb=[],this.contextId=Math.random().toString(36).slice(2),this.projectKey=e,this.networkOptions=s.network,this.options=function e(t,s){let i={...t};for(let n in s)if(s.hasOwnProperty(n)){let r=s[n],o=t[n];"object"!=typeof r||Array.isArray(r)||null===r?i[n]=r:i[n]=e(o||{},r)}return i}({revID:"",node_id:"__openreplay_id",session_token_key:"__openreplay_token",session_pageno_key:"__openreplay_pageno",session_reset_key:"__openreplay_reset",session_tabid_key:"__openreplay_tabid",local_uuid_key:"__openreplay_uuid",ingestPoint:"https://api.openreplay.com/ingest",resourceBaseHref:null,__is_snippet:!1,__debug_report_edp:null,__debug__:0,localStorage:null,sessionStorage:null,forceSingleTab:!1,assistSocketHost:"",captureIFrames:!0,obscureTextEmails:!1,obscureTextNumbers:!1,disableStringDict:!1,crossdomain:{parentDomain:"*"},canvas:{disableCanvas:!1,fixedCanvasScaling:!1,__save_canvas_locally:!1,useAnimationFrame:!1},forceNgOff:!1,inlineCss:0,disableSprites:!1},s),!this.insideIframe&&!this.options.forceSingleTab&&globalThis&&"BroadcastChannel"in globalThis){let e=location.hostname.split(".").slice(-2).join("_");this.bc=new BroadcastChannel(`rick_${e}`)}else this.options.forceSingleTab&&this.allowAppStart();this.revID=this.options.revID,this.localStorage=this.options.localStorage??window.localStorage,this.sessionStorage=this.options.sessionStorage??window.sessionStorage,this.sanitizer=new sE({app:this,options:s}),this.nodes=new sh({node_id:this.options.node_id,forceNgOff:!!s.forceNgOff,maintainer:this.options.nodes?.maintainer}),this.observer=new sx({app:this,options:s}),this.ticker=new sN(this),this.ticker.attach(()=>this.commit()),this.debug=new so(this.options.__debug__),this.session=new s_({app:this,options:this.options}),this.attributeSender=new eo({app:this,isDictDisabled:!!(this.options.disableStringDict||this.options.crossdomain?.enabled)}),this.featureFlags=new ec(this),this.tagWatcher=new t_({sessionStorage:this.sessionStorage,errLog:this.debug.error,onTag:e=>this.send(tS(e))}),this.session.attachUpdateCallback(({userID:e,metadata:t})=>{null!=e&&this.send(e0(e)),null!=t&&Object.entries(t).forEach(([e,t])=>this.send(e2(e,t)))}),null!=t&&this.session.applySessionHash(t);let r=this.session.getTabId();this.insideIframe?(window.addEventListener("message",this.parentCrossDomainFrameListener),setInterval(()=>{document.hidden||window.parent.postMessage({line:sj.polling,context:this.contextId},s.crossdomain?.parentDomain??"*")},250)):(this.initWorker(),window.addEventListener("message",this.crossDomainIframeListener)),null!==this.bc&&(this.bc.postMessage({line:sj.ask,source:r,context:this.contextId,projectKey:this.projectKey}),this.startTimeout=setTimeout(()=>{this.allowAppStart()},250),this.bc.onmessage=e=>{if(e.data.context!==this.contextId&&this.projectKey===e.data.projectKey){if(this.debug.log(e),e.data.line===sj.resp){let t=e.data.token;this.session.setSessionToken(t,this.projectKey),this.allowAppStart()}if(e.data.line===sj.reg){let t=e.data.token;this.session.regenerateTabId(),this.session.setSessionToken(t,this.projectKey),this.allowAppStart()}if(e.data.line===sj.ask){let t=this.session.getSessionToken(this.projectKey);t&&this.bc&&this.bc.postMessage({line:e.data.source===r?sj.reg:sj.resp,token:t,source:r,context:this.contextId,projectKey:this.projectKey})}}})}allowAppStart(){this.canStart=!0,this.startTimeout&&(clearTimeout(this.startTimeout),this.startTimeout=null)}async checkNodeId(e){let t;if(this.pageFrames.length>0&&(t=this.pageFrames.find(t=>t.contentWindow===e)),!t||!this.pageFrames.length){let s=Array.from(document.querySelectorAll("iframe"));this.pageFrames=s,t=s.find(t=>t.contentWindow===e)}if(!t)return null;let s=0;for(;s<100;){let e=t[this.options.node_id];if(void 0!==e)return s=100,e;s++,await sF(100)}return null}initWorker(){try{this.worker=new Worker(URL.createObjectURL(new Blob(['!function(){"use strict";class t{constructor(t,s,i,e=10,n=250,h,r){this.onUnauthorised=s,this.onFailure=i,this.MAX_ATTEMPTS_COUNT=e,this.ATTEMPT_TIMEOUT=n,this.onCompress=h,this.pageNo=r,this.attemptsCount=0,this.busy=!1,this.queue=[],this.token=null,this.lastBatchNum=0,this.ingestURL=t+"/v1/web/i",this.isCompressing=void 0!==h}getQueueStatus(){return 0===this.queue.length&&!this.busy}authorise(t){this.token=t,this.busy||this.sendNext()}push(t){if(this.busy||!this.token)this.queue.push(t);else if(this.busy=!0,this.isCompressing&&this.onCompress)this.onCompress(t);else{const s=++this.lastBatchNum;this.sendBatch(t,!1,s)}}sendNext(){const t=this.queue.shift();if(t)if(this.busy=!0,this.isCompressing&&this.onCompress)this.onCompress(t);else{const s=++this.lastBatchNum;this.sendBatch(t,!1,s)}else this.busy=!1}retry(t,s,i){this.attemptsCount>=this.MAX_ATTEMPTS_COUNT?this.onFailure(`Failed to send batch after ${this.attemptsCount} attempts.`):(this.attemptsCount++,setTimeout((()=>this.sendBatch(t,s,i)),this.ATTEMPT_TIMEOUT*this.attemptsCount))}sendBatch(t,s,i){var e;const n=null==i?void 0:i.toString().replace(/^([^_]+)_([^_]+).*/,"$1_$2_$3");this.busy=!0;const h={Authorization:`Bearer ${this.token}`};s&&(h["Content-Encoding"]="gzip"),null!==this.token?fetch(`${this.ingestURL}?batch=${null!==(e=this.pageNo)&&void 0!==e?e:"noPageNum"}_${null!=n?n:"noBatchNum"}`,{body:t,method:"POST",headers:h,keepalive:t.length<65536}).then((e=>{if(401===e.status)return this.busy=!1,void this.onUnauthorised();e.status>=400?this.retry(t,s,`${null!=i?i:"noBatchNum"}_network:${e.status}`):(this.attemptsCount=0,this.sendNext())})).catch((e=>{console.warn("OpenReplay:",e),this.retry(t,s,`${null!=i?i:"noBatchNum"}_reject:${e.message}`)})):setTimeout((()=>{this.sendBatch(t,s,`${null!=i?i:"noBatchNum"}_newToken`)}),500)}sendCompressed(t){const s=++this.lastBatchNum;this.sendBatch(t,!0,s)}sendUncompressed(t){const s=++this.lastBatchNum;this.sendBatch(t,!1,s)}clean(){this.sendNext(),setTimeout((()=>{this.token=null,this.queue.length=0}),10)}}const s="function"==typeof TextEncoder?new TextEncoder:{encode(t){const s=t.length,i=new Uint8Array(3*s);let e=-1;for(let n=0,h=0,r=0;r!==s;){if(n=t.charCodeAt(r),r+=1,n>=55296&&n<=56319){if(r===s){i[e+=1]=239,i[e+=1]=191,i[e+=1]=189;break}if(h=t.charCodeAt(r),!(h>=56320&&h<=57343)){i[e+=1]=239,i[e+=1]=191,i[e+=1]=189;continue}if(n=1024*(n-55296)+h-56320+65536,r+=1,n>65535){i[e+=1]=240|n>>>18,i[e+=1]=128|n>>>12&63,i[e+=1]=128|n>>>6&63,i[e+=1]=128|63&n;continue}}n<=127?i[e+=1]=0|n:n<=2047?(i[e+=1]=192|n>>>6,i[e+=1]=128|63&n):(i[e+=1]=224|n>>>12,i[e+=1]=128|n>>>6&63,i[e+=1]=128|63&n)}return i.subarray(0,e+1)}};class i{constructor(t){this.size=t,this.offset=0,this.checkpointOffset=0,this.data=new Uint8Array(t)}getCurrentOffset(){return this.offset}checkpoint(){this.checkpointOffset=this.offset}get isEmpty(){return 0===this.offset}skip(t){return this.offset+=t,this.offset<=this.size}set(t,s){this.data.set(t,s)}boolean(t){return this.data[this.offset++]=+t,this.offset<=this.size}uint(t){for((t<0||t>Number.MAX_SAFE_INTEGER)&&(t=0);t>=128;)this.data[this.offset++]=t%256|128,t=Math.floor(t/128);return this.data[this.offset++]=t,this.offset<=this.size}int(t){return t=Math.round(t),this.uint(t>=0?2*t:-2*t-1)}string(t){const i=s.encode(t),e=i.byteLength;return!(!this.uint(e)||this.offset+e>this.size)&&(this.data.set(i,this.offset),this.offset+=e,!0)}reset(){this.offset=0,this.checkpointOffset=0}flush(){const t=this.data.slice(0,this.checkpointOffset);return this.reset(),t}}class e extends i{encode(t){switch(t[0]){case 0:case 11:case 114:case 115:return this.uint(t[1]);case 4:case 44:case 47:return this.string(t[1])&&this.string(t[2])&&this.uint(t[3]);case 5:case 20:case 38:case 70:case 75:case 76:case 77:case 82:return this.uint(t[1])&&this.uint(t[2]);case 6:return this.int(t[1])&&this.int(t[2]);case 7:return!0;case 8:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.string(t[4])&&this.boolean(t[5]);case 9:case 10:case 24:case 35:case 51:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3]);case 12:case 52:case 61:case 71:return this.uint(t[1])&&this.string(t[2])&&this.string(t[3]);case 13:case 14:case 17:case 34:case 50:case 54:return this.uint(t[1])&&this.string(t[2]);case 16:return this.uint(t[1])&&this.int(t[2])&&this.int(t[3]);case 18:return this.uint(t[1])&&this.string(t[2])&&this.int(t[3]);case 19:return this.uint(t[1])&&this.boolean(t[2]);case 21:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4])&&this.string(t[5])&&this.uint(t[6])&&this.uint(t[7])&&this.uint(t[8]);case 22:case 27:case 30:case 41:case 45:case 46:case 43:case 63:case 64:case 79:case 124:return this.string(t[1])&&this.string(t[2]);case 23:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.uint(t[4])&&this.uint(t[5])&&this.uint(t[6])&&this.uint(t[7])&&this.uint(t[8])&&this.uint(t[9]);case 28:case 29:case 42:case 117:case 118:return this.string(t[1]);case 37:return this.uint(t[1])&&this.string(t[2])&&this.uint(t[3]);case 39:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4])&&this.uint(t[5])&&this.uint(t[6])&&this.uint(t[7]);case 40:return this.string(t[1])&&this.uint(t[2])&&this.string(t[3])&&this.string(t[4]);case 48:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4])&&this.int(t[5]);case 49:return this.int(t[1])&&this.int(t[2])&&this.uint(t[3])&&this.uint(t[4]);case 53:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.uint(t[4])&&this.uint(t[5])&&this.uint(t[6])&&this.string(t[7])&&this.string(t[8]);case 55:return this.boolean(t[1]);case 57:case 60:return this.uint(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4]);case 58:case 120:return this.int(t[1]);case 59:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.uint(t[4])&&this.string(t[5])&&this.string(t[6])&&this.string(t[7]);case 67:case 73:return this.uint(t[1])&&this.string(t[2])&&this.uint(t[3])&&this.string(t[4]);case 68:return this.uint(t[1])&&this.uint(t[2])&&this.string(t[3])&&this.string(t[4])&&this.uint(t[5])&&this.uint(t[6]);case 69:return this.uint(t[1])&&this.uint(t[2])&&this.string(t[3])&&this.string(t[4]);case 78:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4]);case 81:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.int(t[4])&&this.string(t[5]);case 83:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4])&&this.string(t[5])&&this.uint(t[6])&&this.uint(t[7])&&this.uint(t[8])&&this.uint(t[9]);case 84:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.uint(t[4])&&this.string(t[5])&&this.string(t[6]);case 112:return this.uint(t[1])&&this.string(t[2])&&this.boolean(t[3])&&this.string(t[4])&&this.int(t[5])&&this.int(t[6]);case 113:return this.uint(t[1])&&this.uint(t[2])&&this.string(t[3]);case 116:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.uint(t[4])&&this.uint(t[5])&&this.uint(t[6])&&this.string(t[7])&&this.string(t[8])&&this.uint(t[9])&&this.boolean(t[10]);case 119:return this.string(t[1])&&this.uint(t[2]);case 121:return this.string(t[1])&&this.string(t[2])&&this.uint(t[3])&&this.uint(t[4]);case 122:return this.string(t[1])&&this.string(t[2])&&this.uint(t[3])&&this.string(t[4]);case 123:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4])&&this.uint(t[5])}}}class n{constructor(t,s,i,n,h,r){this.pageNo=t,this.timestamp=s,this.url=i,this.onBatch=n,this.tabId=h,this.onOfflineEnd=r,this.nextIndex=0,this.beaconSize=2e5,this.encoder=new e(this.beaconSize),this.sizeBuffer=new Uint8Array(3),this.isEmpty=!0,this.checkpoints=[],this.beaconSizeLimit=1e6,this.prepare()}writeType(t){return this.encoder.uint(t[0])}writeFields(t){return this.encoder.encode(t)}writeSizeAt(t,s){for(let s=0;s<3;s++)this.sizeBuffer[s]=t>>8*s;this.encoder.set(this.sizeBuffer,s)}prepare(){if(!this.encoder.isEmpty)return;this.checkpoints.length=0;const t=[81,1,this.pageNo,this.nextIndex,this.timestamp,this.url],s=[0,this.timestamp],i=[118,this.tabId];this.writeType(t),this.writeFields(t),this.writeWithSize(s),this.writeWithSize(i),this.isEmpty=!0}writeWithSize(t){const s=this.encoder;if(!this.writeType(t)||!s.skip(3))return!1;const i=s.getCurrentOffset(),e=this.writeFields(t);if(e){const e=s.getCurrentOffset()-i;if(e>16777215)return console.warn("OpenReplay: max message size overflow."),!1;this.writeSizeAt(e,i-3),s.checkpoint(),this.checkpoints.push(s.getCurrentOffset()),this.isEmpty=this.isEmpty&&0===t[0],this.nextIndex++}return e}setBeaconSizeLimit(t){this.beaconSizeLimit=t}writeMessage(t){if("q_end"===t[0])return this.finaliseBatch(),this.onOfflineEnd();0===t[0]&&(this.timestamp=t[1]),122===t[0]&&(this.url=t[1]),this.writeWithSize(t)||(this.finaliseBatch(),this.writeWithSize(t)||(this.encoder=new e(this.beaconSizeLimit),this.prepare(),this.writeWithSize(t)?this.finaliseBatch():console.warn("OpenReplay: beacon size overflow. Skipping large message.",t,this),this.encoder=new e(this.beaconSize),this.prepare()))}finaliseBatch(t=!1){if(this.isEmpty)return;const s=this.encoder.flush();this.onBatch(s,t),this.prepare()}clean(){this.encoder.reset(),this.checkpoints.length=0}}var h;!function(t){t[t.NotActive=0]="NotActive",t[t.Starting=1]="Starting",t[t.Stopping=2]="Stopping",t[t.Active=3]="Active",t[t.Stopped=4]="Stopped"}(h||(h={}));let r=null,a=null,u=h.NotActive;function o(t){a&&a.finaliseBatch(t)}function c(){return new Promise((t=>{u=h.Stopping,null!==p&&(clearInterval(p),p=null),a&&(a.clean(),a=null),r&&(r.clean(),setTimeout((()=>{r=null}),20)),setTimeout((()=>{u=h.NotActive,t(null)}),100)}))}function g(){[h.Stopped,h.Stopping].includes(u)||(postMessage("a_stop"),c().then((()=>{postMessage("a_start")})))}let l,p=null;self.onmessage=({data:s})=>{if("stop"===s)return o(),void c().then((()=>{u=h.Stopped}));if("forceFlushBatch"!==s)if("closing"!==s){if(!Array.isArray(s)){if("compressed"===s.type){if(!r)return console.debug("OR WebWorker: sender not initialised. Compressed batch."),void g();s.batch&&r.sendCompressed(s.batch)}if("uncompressed"===s.type){if(!r)return console.debug("OR WebWorker: sender not initialised. Uncompressed batch."),void g();s.batch&&r.sendUncompressed(s.batch)}return"start"===s.type?(u=h.Starting,r=new t(s.ingestPoint,(()=>{g()}),(t=>{!function(t){postMessage({type:"failure",reason:t}),c()}(t)}),s.connAttemptCount,s.connAttemptGap,(t=>{postMessage({type:"compress",batch:t},[t.buffer])}),s.pageNo),a=new n(s.pageNo,s.timestamp,s.url,((t,s)=>{r&&(s?r.sendUncompressed(t):r.push(t))}),s.tabId,(()=>postMessage({type:"queue_empty"}))),null===p&&(p=setInterval(o,3e4)),u=h.Active):"auth"===s.type?r?a?(r.authorise(s.token),void(s.beaconSizeLimit&&a.setBeaconSizeLimit(s.beaconSizeLimit))):(console.debug("OR WebWorker: writer not initialised. Received auth."),void g()):(console.debug("OR WebWorker: sender not initialised. Received auth."),void g()):void 0}if(a){const t=a;s.forEach((s=>{55===s[0]&&(s[1]?l=setTimeout((()=>g()),18e5):clearTimeout(l)),t.writeMessage(s)}))}else postMessage("not_init"),g()}else o(!0);else o()}}();\n'],{type:"text/javascript"}))),this.worker.onerror=e=>{this._debug("webworker_error",e)},this.worker.onmessage=({data:e})=>{this.handleWorkerMsg(e)};let e=!1,t=()=>{!e&&(e=!0,setTimeout(()=>{e=!1},500),this.worker&&this.worker.postMessage("closing"))};this.attachEventListener(document.body,"mouseleave",t,!1,!1),this.attachEventListener(window,"pagehide",t,!1,!1),this.attachEventListener(document,"visibilitychange",e=>"hidden"===document.visibilityState&&t(),!1)}catch(e){this._debug("worker_start",e)}}handleWorkerMsg(e){if("a_stop"===e)this.stop(!1);else if("a_start"===e)this.waitStatus(io.NotActive).then(()=>{this.allowAppStart(),this.start(this.prevOpts,!0).then(e=>{this.debug.info("Worker restart, session too long",e)}).catch(e=>{this.debug.error("Worker restart failed",e)})});else if("not_init"===e)this.debug.warn("OR WebWorker: writer not initialised. Restarting tracker");else if("failure"===e.type)this.stop(!1),this.debug.error("worker_failed",e.reason),this._debug("worker_failed",e.reason);else if("compress"===e.type){let n=e.batch;if(n.byteLength>this.compressionThreshold){var t,s,i;t=e.batch,s={mtime:0},(i=(e,t)=>{e?(this.debug.error("Openreplay compression error:",e),this.worker?.postMessage({type:"uncompressed",batch:n})):this.worker?.postMessage({type:"compressed",batch:t})})||(i=s,s={}),"function"!=typeof i&&N(7),Y(t,s,[J,G,function(){return[ei]}],function(e){return Q(ei(e.data[0],e.data[1]))},2,i)}else this.worker?.postMessage({type:"uncompressed",batch:n})}else"queue_empty"===e.type&&this.onSessionSent()}_debug(e,t){null!==this.options.__debug_report_edp&&fetch(this.options.__debug_report_edp,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context:e,error:`${t}`})}),this.debug.error("OpenReplay error: ",e,t)}_nCommit(){if(this.socketMode){this.messages.unshift(eL(this.timestamp()),ty(this.session.getTabId())),this.commitCallbacks.forEach(e=>e(this.messages)),this.messages.length=0;return}if(this.insideIframe){window.parent.postMessage({line:sj.iframeBatch,messages:this.messages},this.options.crossdomain?.parentDomain??"*"),this.commitCallbacks.forEach(e=>e(this.messages)),this.messages.length=0;return}if(void 0!==this.worker&&this.messages.length){if(!this.messages.length&&this.emptyBatchCounter<1e3){this.emptyBatchCounter++;return}this.emptyBatchCounter=0;try{eA(()=>{this.messages.unshift(eL(this.timestamp()),ty(this.session.getTabId())),this.worker?.postMessage(this.messages),this.commitCallbacks.forEach(e=>e(this.messages)),this.messages.length=0})}catch(e){this._debug("worker_commit",e),this.stop(!0),setTimeout(()=>{this.start()},500)}}}_cStartCommit(){if(this.coldStartCommitN+=1,2===this.coldStartCommitN){let e=[eL(this.timestamp()),ty(this.session.getTabId())];this.bufferedMessages1.push(...e),this.bufferedMessages2.push(...e),this.coldStartCommitN=0}}commit(){this.activityState===io.ColdStart?this._cStartCommit():this._nCommit()}postToWorker(e){this.worker?.postMessage(e),this.commitCallbacks.forEach(t=>t(e))}timestamp(){return em()+this.delay}safe(e){let t=this;return function(...s){try{e.apply(this,s)}catch(e){t._debug("safe_fn_call",e)}}}attachCommitCallback(e){this.commitCallbacks.push(e)}checkRequiredVersion(e){let t=e.split(/[.-]/),s=this.version.split(/[.-]/);for(let e=0;e<3;e++){if(isNaN(Number(s[e]))||isNaN(Number(t[e])))return!1;if(Number(s[e])>Number(t[e]))break;if(Number(s[e])<Number(t[e]))return!1}return!0}getTrackerInfo(){return{userUUID:this.localStorage.getItem(this.options.local_uuid_key),projectKey:this.projectKey,revID:this.revID,trackerVersion:this.version,isSnippet:this.options.__is_snippet}}getSessionInfo(){return{...this.session.getInfo(),...this.getTrackerInfo()}}getSessionToken(){return this.session.getSessionToken(this.projectKey)}getSessionID(){return this.session.getInfo().sessionID||void 0}getSessionURL(e){let{projectID:t,sessionID:s,timestamp:i}=this.session.getInfo();if(!t||!s){this.debug.error("OpenReplay error: Unable to build session URL");return}let n=this.options.ingestPoint,r=(/api\.openreplay\.com/.test(n)?"https://app.openreplay.com/ingest":n).replace(/ingest$/,`${t}/session/${s}`);if(e?.withCurrentTime){let e=em()-i;return`${r}?jumpto=${e}`}return r}getHost(){return new URL(this.options.ingestPoint).host}getProjectKey(){return this.projectKey}getBaseHref(){return"string"==typeof this.options.resourceBaseHref?this.options.resourceBaseHref:(this.options.resourceBaseHref,document.baseURI)?document.baseURI:document.head?.getElementsByTagName("base")[0]?.getAttribute("href")||location.origin+location.pathname}resolveResourceURL(e){let t=new URL(this.getBaseHref());return t.pathname+="/"+new URL(e).pathname,t.pathname.replace(/\/+/g,"/"),t.toString()}isServiceURL(e){return e.startsWith(this.options.ingestPoint)}active(){return this.activityState===io.Active}resetNextPageSession(e){e?this.sessionStorage.setItem(this.options.session_reset_key,"t"):this.sessionStorage.removeItem(this.options.session_reset_key)}checkSessionToken(e){let t=null!==this.sessionStorage.getItem(this.options.session_reset_key),s=this.session.getSessionToken(this.projectKey);return e||t||!s}async uploadOfflineRecording(){this.stop(!1);let e=em();this.worker?.postMessage({type:"start",pageNo:this.session.incPageNo(),ingestPoint:this.options.ingestPoint,timestamp:this.coldStartTs,url:document.URL,connAttemptCount:this.options.connAttemptCount,connAttemptGap:this.options.connAttemptGap,tabId:this.session.getTabId()});let t=await fetch(this.options.ingestPoint+"/v1/web/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...this.getTrackerInfo(),timestamp:e,doNotRecord:!1,bufferDiff:e-this.coldStartTs,userID:this.session.getInfo().userID,token:void 0,deviceMemory:tx,jsHeapSizeLimit:tC,timezone:sL()})}),{token:s,userBrowser:i,userCity:n,userCountry:r,userDevice:o,userOS:a,userState:l,beaconSizeLimit:h,projectID:c}=await t.json();for(this.worker?.postMessage({type:"auth",token:s,beaconSizeLimit:h}),this.session.assign({projectID:c}),this.session.setUserInfo({userBrowser:i,userCity:n,userCountry:r,userDevice:o,userOS:a,userState:l});this.bufferedMessages1.length>0;)await this.flushBuffer(this.bufferedMessages1);this.postToWorker([["q_end"]]),this.clearBuffers()}async _start(e={},t=!1,s){0!==Object.keys(e).length&&(this.prevOpts=e);let i=this.activityState===io.ColdStart;if(i&&this.coldInterval&&clearInterval(this.coldInterval),!this.worker&&!this.insideIframe){let e="No worker found: perhaps, CSP is not set.";return this.signalError(e,[]),Promise.resolve(sD(e))}if(this.activityState===io.Active||this.activityState===io.Starting)return Promise.resolve(sD("OpenReplay: trying to call `start()` on the instance that has been started already."));this.activityState=io.Starting,i||eg(),e.sessionHash&&this.session.applySessionHash(e.sessionHash),e.forceNew&&this.session.reset(),this.session.assign({userID:e.userID,metadata:e.metadata});let n=em();this.worker?.postMessage({type:"start",pageNo:this.session.incPageNo(),ingestPoint:this.options.ingestPoint,timestamp:i?this.coldStartTs:n,url:document.URL,connAttemptCount:this.options.connAttemptCount,connAttemptGap:this.options.connAttemptGap,tabId:this.session.getTabId()});let r=this.session.getSessionToken(this.projectKey),o=this.checkSessionToken(e.forceNew);this.sessionStorage.removeItem(this.options.session_reset_key),this.debug.log("OpenReplay: starting session; need new session id?",o,"session token: ",r);try{let t=await window.fetch(this.options.ingestPoint+"/v1/web/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...this.getTrackerInfo(),timestamp:n,doNotRecord:!1,bufferDiff:n-this.coldStartTs,userID:this.session.getInfo().userID,token:o?void 0:r,deviceMemory:tx,jsHeapSizeLimit:tC,timezone:sL(),condition:s,assistOnly:e.assistOnly??this.socketMode,width:window.screen.width,height:window.screen.height})});if(200!==t.status){let e=await t.text(),s=e===sO?sO:`Server error: ${t.status}. ${e}`;return sD(s)}if(!this.worker&&!this.insideIframe){let e="no worker found after start request (this should not happen in real world)";return this.signalError(e,[]),sD(e)}let{token:a,userUUID:l,projectID:h,beaconSizeLimit:c,compressionThreshold:u,delay:d,sessionID:p,startTimestamp:f,userBrowser:g,userCity:m,userCountry:b,userDevice:y,userOS:v,userState:S,canvasEnabled:w,canvasQuality:k,canvasFPS:T,assistOnly:I,features:x}=await t.json();if(this.features=x||this.features,"string"!=typeof a||"string"!=typeof l||"number"!=typeof f&&void 0!==f||"string"!=typeof p||"number"!=typeof d||"number"!=typeof c&&void 0!==c){let e=`Incorrect server response: ${JSON.stringify(t)}`;return this.signalError(e,[]),sD(e)}this.delay=d,this.session.setSessionToken(a,this.projectKey),this.session.setUserInfo({userBrowser:g,userCity:m,userCountry:b,userDevice:y,userOS:v,userState:S}),this.session.assign({sessionID:p,timestamp:f||n,projectID:h}),I?(this.socketMode=!0,this.worker?.postMessage("stop")):this.worker?.postMessage({type:"auth",token:a,beaconSizeLimit:c}),o||a!==r||(this.debug.log("continuing session on new tab",this.session.getTabId()),this.send(tb(this.session.getTabId()))),Object.entries(this.session.getInfo().metadata).forEach(([e,t])=>this.send(e2(e,t))),this.localStorage.setItem(this.options.local_uuid_key,l),this.compressionThreshold=u;let C={sessionToken:a,userUUID:l,sessionID:p};if(this.startCallbacks.forEach(e=>e(C)),e.startCallback&&e.startCallback(sA(C)),this.features["feature-flags"]&&this.featureFlags.reloadFlags(),await this.tagWatcher.fetchTags(this.options.ingestPoint,a),this.activityState=io.Active,this.options.crossdomain?.enabled&&!this.insideIframe&&this.bootChildrenFrames(),w&&!this.options.canvas.disableCanvas&&(this.canvasRecorder=this.canvasRecorder??new sn(this,{fps:T,quality:k,isDebug:this.options.canvas.__save_canvas_locally,fixedScaling:this.options.canvas.fixedCanvasScaling,useAnimationFrame:this.options.canvas.useAnimationFrame})),i){let e=this.bufferedMessages1.length>this.bufferedMessages2.length?this.bufferedMessages1:this.bufferedMessages2;for(;e.length>0;)await this.flushBuffer(e);this.clearBuffers(),this.commit()}else this.insideIframe&&this.rootId?this.observer.crossdomainObserve(this.rootId,this.frameOderNumber):this.observer.observe(),this.ticker.start();if(this.canvasRecorder?.startTracking(),this.features["usability-test"]&&!this.insideIframe){let e;this.uxtManager=this.uxtManager?this.uxtManager:new t8(this,sR);let t=this.localStorage.getItem(sR);if(t&&(e=parseInt(t,10)),location?.search){let t=new URLSearchParams(location.search);if(t.has("oruxt")){let s=t.get("oruxt");e=s?parseInt(s,10):void 0}}e&&(this.uxtManager.isActive?this.onUxtCb.forEach(t=>t(e)):this.uxtManager.getTest(e,a,!!t).then(e=>{e&&this.onUxtCb.forEach(t=>t(e))}))}return sA(C)}catch(t){if(this.stop(),this.session.reset(),!t)return console.error("Unknown error during start"),this.signalError("Unknown error",[]),sD("Unknown error");if(t===sO)return this.signalError(sO,[]),sD(sO);this._debug("session_start",t);let e=t instanceof Error?t.message:t.toString();return this.signalError(e,[]),sD(e)}}addOnUxtCb(e){this.onUxtCb.push(e)}getUxtId(){return this.uxtManager?.getTestId()}async waitStart(){return new Promise(e=>{let t=setInterval(()=>{this.canStart&&(clearInterval(t),e(!0))},100)})}async waitStarted(){return this.waitStatus(io.Active)}async waitStatus(e){return new Promise(t=>{let s=()=>{this.activityState===e?t(!0):setTimeout(s,25)};s()})}async start(...e){return this.activityState===io.Active||this.activityState===io.Starting?Promise.resolve(sD("OpenReplay: trying to call `start()` on the instance that has been started already.")):(this.insideIframe&&this.signalIframeTracker(),document.hidden)?new Promise(t=>{let s=async()=>{document.hidden||(await this.waitStart(),document.removeEventListener("visibilitychange",s),t(this._start(...e)))};document.addEventListener("visibilitychange",s)}):(await this.waitStart(),this._start(...e))}forceFlushBatch(){this.worker?.postMessage("forceFlushBatch")}getTabId(){return this.session.getTabId()}clearBuffers(){this.bufferedMessages1.length=0,this.bufferedMessages2.length=0}trackWs(e){return(t,s,i="down")=>{"string"!=typeof t||"string"!=typeof s||s.length>5242880||t.length>255||this.send(tu("websocket",e,s,this.timestamp(),i,t))}}stop(e=!0){if(this.activityState!==io.NotActive)try{!this.insideIframe&&this.options.crossdomain?.enabled&&this.killChildrenFrames(),this.attributeSender.clear(),this.sanitizer.clear(),this.observer.disconnect(),this.nodes.clear(),this.ticker.stop(),this.stopCallbacks.forEach(e=>e()),this.tagWatcher.clear(),this.worker&&e&&this.worker.postMessage("stop"),this.canvasRecorder?.clear(),this.messages.length=0,this.parentActive=!1}finally{this.activityState=io.NotActive,this.debug.log("OpenReplay tracking stopped.")}}}let sB=ed&&"InstallTrigger"in window?e=>e.message+"\n"+e.stack:e=>e.stack||e.message;function sU(e){return void 0===e?"undefined":null===e?"null":e instanceof Error?sB(e):Array.isArray(e)?`Array(${e.length})`:String(e)}function sH(e){if(void 0===e)return"undefined";if(null===e)return"null";if(e instanceof Error)return sB(e);if(Array.isArray(e)){let t=e.length,s=e.slice(0,10).map(sU).join(", ");return`Array(${t})[${s}]`}if("object"==typeof e){let t=[],s=0;for(let i in e){if(10==++s)break;let n=e[i];t.push(i+": "+sU(n))}return"{"+t.join(", ")+"}"}return e.toString()}let sz=["log","info","warn","error","debug","assert"],s$=/(^|@)\S+:\d+/,sq=/^\s*at .*(\S+:\d+|\(native\))/m,sW=/^(eval@)?(\[native code\])?$/;function sV(e){if(!e.includes(":"))return[e,void 0,void 0];let t=/(.+?)(?::(\d+))?(?::(\d+))?$/.exec(e.replace(/[()]/g,""));return[t[1],t[2]||void 0,t[3]||void 0]}function sK(e){return[{columnNumber:e.colno,lineNumber:e.lineno,fileName:e.filename,functionName:"",source:""}]}function sX(e,t,s={}){let i=t;try{i=(function(e,t){if(void 0!==e.stacktrace||void 0!==e["opera#sourceloc"])return!e.stacktrace||e.message.includes("\n")&&e.message.split("\n").length>e.stacktrace.split("\n").length?function(e,t){let s=/Line (\d+).*script (?:in )?(\S+)/i,i=e.message.split("\n"),n=[];for(let e=2,t=i.length;e<t;e+=2){let t=s.exec(i[e]);t&&n.push({file:t[2],line:+t[1],raw:i[e]})}return n}(e):e.stack?e.stack.split("\n").filter(e=>!!e.match(s$)&&!e.match(/^Error created at/)).map(e=>{let t;let s=e.split("@"),i=sV(s.pop()),n=s.shift()||"",r=n.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0;return n.match(/\(([^)]*)\)/)&&(t=n.replace(/^[^(]+\(([^)]*)\)$/,"$1")),{function:r,args:void 0===t||"[arguments not available]"===t?void 0:t.split(","),file:i[0],line:i[1]?+i[1]:void 0,col:i[2]?+i[2]:void 0,raw:e}}):function(e,t){let s=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,i=e.stacktrace.split("\n"),n=[];for(let e=0,t=i.length;e<t;e+=2){let t=s.exec(i[e]);t&&n.push({function:t[3]||void 0,file:t[2],line:t[1]?+t[1]:void 0,raw:i[e]})}return n}(e);if(e.stack&&e.stack.match(sq))return e.stack.split("\n").filter(e=>!!e.match(sq)).map(e=>{e.includes("(eval ")&&(e=e.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));let t=e.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),s=t.match(/ (\(.+\)$)/);t=s?t.replace(s[0],""):t;let i=sV(s?s[1]:t);return{function:s&&t||void 0,file:["eval","<anonymous>"].includes(i[0])?void 0:i[0],line:i[1]?+i[1]:void 0,col:i[2]?+i[2]:void 0,raw:e}});if(e.stack)return e.stack.split("\n").filter(e=>!e.match(sW)).map(e=>{if(e.includes(" > eval")&&(e=e.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),!e.includes("@")&&!e.includes(":"))return{function:e};{let t=/(([^\n\r"\u2028\u2029]*".[^\n\r"\u2028\u2029]*"[^\n\r@\u2028\u2029]*(?:@[^\n\r"\u2028\u2029]*"[^\n\r@\u2028\u2029]*)*(?:[\n\r\u2028\u2029][^@]*)?)?[^@]*)@/,s=e.match(t),i=s&&s[1]?s[1]:void 0,n=sV(e.replace(t,""));return{function:i,file:n[0],line:n[1]?+n[1]:void 0,col:n[2]?+n[2]:void 0,raw:e}}});throw Error("Cannot parse given Error object")})(e).map(e=>({functionName:e.function,args:e.args,fileName:e.file,lineNumber:e.line,columnNumber:e.col,source:e.raw}))}catch(e){}return th(e.name,e.message,JSON.stringify(i),JSON.stringify(s))}function sJ(e,t=window,s={}){if(e instanceof ErrorEvent){if(e.error instanceof Error)return sX(e.error,sK(e),s);{let[t,i]=e.message.split(":");return i||(t="Error",i=e.message),th(t,i,JSON.stringify(sK(e)),JSON.stringify(s))}}if("PromiseRejectionEvent"in t&&e instanceof t.PromiseRejectionEvent){if(e.reason instanceof Error)return sX(e.reason,[],s);{let t;try{t=JSON.stringify(e.reason)}catch(s){t=String(e.reason)}return th("Unhandled Promise Rejection",t,"[]",JSON.stringify(s))}}return null}function sG(e,t=document.location){return(e=e.trim()).startsWith("//")||e.startsWith("http://")||e.startsWith("https://")||e.startsWith("data:")?e:e.startsWith("/")?t.origin+e:t.origin+t.pathname+e}let sQ=["text","password","email","search","number","range","date","tel","time"],sY=ed&&"labels"in HTMLInputElement.prototype?e=>{let t=e;for(;null!==(t=t.parentNode);)if(si(t,"label"))return t;let s=e.labels;if(null!==s&&1===s.length)return s[0]}:e=>{let t=e;for(;null!==(t=t.parentNode);)if(si(t,"label"))return t;let s=e.id;if(s){let t=e.ownerDocument.querySelectorAll('label[for="'+s+'"]');if(null!==t&&1===t.length)return t[0]}};function sZ(e){let t=eT(e);if(null===t){let s=sY(e);t=s&&s.innerText||e.placeholder||e.name||e.id||e.className||e.type}return ey(t).slice(0,100)}let s0={Plain:0,Obscured:1,Hidden:2},s1="undefined"!=typeof CSS&&CSS.escape||(e=>e),s2=new WeakMap;function s5(e){let t=e.tagName.toUpperCase();return"BUTTON"===t||"A"===t||"LI"===t||"SELECT"===t||"TR"===t||"TH"===t||null!=e.onclick||"button"===e.getAttribute("role")}function s3(e,t){return e instanceof Element?function(e,t){let s=e;for(;null!==s&&s!==t.documentElement;){if(eI(s,"masked"))return null;s=s.parentElement}if(t9(e)){let t=e.ownerSVGElement;for(;null!==t;)e=t,t=t.ownerSVGElement}for(s=e;null!==s&&s!==t.documentElement;){let e=s.tagName.toUpperCase();if("LABEL"===e)return null;if("INPUT"===e||s5(s)||null!==eT(s))return s;s=s.parentElement}return e===t.documentElement?null:e}(e,t):null}function s4(e){return Math.round(1e4*e)}function s8(e,t){let s=s2.get(t);if(s||(s=Object.create(null),s2.set(t,s)),e in s)return s[e];let i=1===t.querySelectorAll(`.${s1(e)}`).length;return s[e]=i,i}function s6(e){if(/^[a-z\-]{3,}$/i.test(e)){for(let t of e.split(/-|[A-Z]/))if(t.length<=2||/[^aeiou]{4,}/i.test(t))return!1;return!0}return!1}var s9,s7,ie,it,is,ii,ir,io,ia,il=-1,ih=function(e){addEventListener("pageshow",function(t){t.persisted&&(il=t.timeStamp,e(t))},!0)},ic=function(){var e=self.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0];if(e&&e.responseStart>0&&e.responseStart<performance.now())return e},iu=function(){var e=ic();return e&&e.activationStart||0},id=function(e,t){var s=ic(),i="navigate";return il>=0?i="back-forward-cache":s&&(document.prerendering||iu()>0?i="prerender":document.wasDiscarded?i="restore":s.type&&(i=s.type.replace(/_/g,"-"))),{name:e,value:void 0===t?-1:t,rating:"good",delta:0,entries:[],id:"v4-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:i}},ip=function(e,t,s){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){var i=new PerformanceObserver(function(e){Promise.resolve().then(function(){t(e.getEntries())})});return i.observe(Object.assign({type:e,buffered:!0},s||{})),i}}catch(e){}},ig=function(e,t,s,i){var n,r;return function(o){var a;t.value>=0&&(o||i)&&((r=t.value-(n||0))||void 0===n)&&(n=t.value,t.delta=r,t.rating=(a=t.value)>s[1]?"poor":a>s[0]?"needs-improvement":"good",e(t))}},im=function(e){requestAnimationFrame(function(){return requestAnimationFrame(function(){return e()})})},ib=function(e){document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&e()})},iy=function(e){var t=!1;return function(){t||(e(),t=!0)}},iv=-1,iS=function(){return"hidden"!==document.visibilityState||document.prerendering?1/0:0},iw=function(e){"hidden"===document.visibilityState&&iv>-1&&(iv="visibilitychange"===e.type?e.timeStamp:0,iT())},ik=function(){addEventListener("visibilitychange",iw,!0),addEventListener("prerenderingchange",iw,!0)},iT=function(){removeEventListener("visibilitychange",iw,!0),removeEventListener("prerenderingchange",iw,!0)},iI=function(){return iv<0&&(iv=iS(),ik(),ih(function(){setTimeout(function(){iv=iS(),ik()},0)})),{get firstHiddenTime(){return iv}}},ix=function(e){document.prerendering?addEventListener("prerenderingchange",function(){return e()},!0):e()},iC=[1800,3e3],iE=function(e,t){t=t||{},ix(function(){var s,i=iI(),n=id("FCP"),r=ip("paint",function(e){e.forEach(function(e){"first-contentful-paint"===e.name&&(r.disconnect(),e.startTime<i.firstHiddenTime&&(n.value=Math.max(e.startTime-iu(),0),n.entries.push(e),s(!0)))})});r&&(s=ig(e,n,iC,t.reportAllChanges),ih(function(i){s=ig(e,n=id("FCP"),iC,t.reportAllChanges),im(function(){n.value=performance.now()-i.timeStamp,s(!0)})}))})},i_=[.1,.25],iN=function(e,t){t=t||{},iE(iy(function(){var s,i=id("CLS",0),n=0,r=[],o=function(e){e.forEach(function(e){if(!e.hadRecentInput){var t=r[0],s=r[r.length-1];n&&e.startTime-s.startTime<1e3&&e.startTime-t.startTime<5e3?(n+=e.value,r.push(e)):(n=e.value,r=[e])}}),n>i.value&&(i.value=n,i.entries=r,s())},a=ip("layout-shift",o);a&&(s=ig(e,i,i_,t.reportAllChanges),ib(function(){o(a.takeRecords()),s(!0)}),ih(function(){n=0,s=ig(e,i=id("CLS",0),i_,t.reportAllChanges),im(function(){return s()})}),setTimeout(s,0))}))},iO=0,iR=1/0,iM=0,iD=function(e){e.forEach(function(e){e.interactionId&&(iR=Math.min(iR,e.interactionId),iO=(iM=Math.max(iM,e.interactionId))?(iM-iR)/7+1:0)})},iA=function(){return ia?iO:performance.interactionCount||0},iL=function(){"interactionCount"in performance||ia||(ia=ip("event",iD,{type:"event",buffered:!0,durationThreshold:0}))},iF=[],ij=new Map,iP=0,iB=function(){var e=Math.min(iF.length-1,Math.floor((iA()-iP)/50));return iF[e]},iU=[],iH=function(e){if(iU.forEach(function(t){return t(e)}),e.interactionId||"first-input"===e.entryType){var t=iF[iF.length-1],s=ij.get(e.interactionId);if(s||iF.length<10||e.duration>t.latency){if(s)e.duration>s.latency?(s.entries=[e],s.latency=e.duration):e.duration===s.latency&&e.startTime===s.entries[0].startTime&&s.entries.push(e);else{var i={id:e.interactionId,latency:e.duration,entries:[e]};ij.set(i.id,i),iF.push(i)}iF.sort(function(e,t){return t.latency-e.latency}),iF.length>10&&iF.splice(10).forEach(function(e){return ij.delete(e.id)})}}},iz=function(e){var t=self.requestIdleCallback||self.setTimeout,s=-1;return e=iy(e),"hidden"===document.visibilityState?e():(s=t(e),ib(e)),s},i$=[200,500],iq=function(e,t){"PerformanceEventTiming"in self&&"interactionId"in PerformanceEventTiming.prototype&&(t=t||{},ix(function(){iL();var s,i,n=id("INP"),r=function(e){iz(function(){e.forEach(iH);var t=iB();t&&t.latency!==n.value&&(n.value=t.latency,n.entries=t.entries,i())})},o=ip("event",r,{durationThreshold:null!==(s=t.durationThreshold)&&void 0!==s?s:40});i=ig(e,n,i$,t.reportAllChanges),o&&(o.observe({type:"first-input",buffered:!0}),ib(function(){r(o.takeRecords()),i(!0)}),ih(function(){iP=iA(),iF.length=0,ij.clear(),i=ig(e,n=id("INP"),i$,t.reportAllChanges)}))}))},iW=[2500,4e3],iV={},iK=function(e,t){t=t||{},ix(function(){var s,i=iI(),n=id("LCP"),r=function(e){t.reportAllChanges||(e=e.slice(-1)),e.forEach(function(e){e.startTime<i.firstHiddenTime&&(n.value=Math.max(e.startTime-iu(),0),n.entries=[e],s())})},o=ip("largest-contentful-paint",r);if(o){s=ig(e,n,iW,t.reportAllChanges);var a=iy(function(){iV[n.id]||(r(o.takeRecords()),o.disconnect(),iV[n.id]=!0,s(!0))});["keydown","click"].forEach(function(e){addEventListener(e,function(){return iz(a)},{once:!0,capture:!0})}),ib(a),ih(function(i){s=ig(e,n=id("LCP"),iW,t.reportAllChanges),im(function(){n.value=performance.now()-i.timeStamp,iV[n.id]=!0,s(!0)})})}})},iX=[800,1800],iJ=function e(t){document.prerendering?ix(function(){return e(t)}):"complete"!==document.readyState?addEventListener("load",function(){return e(t)},!0):setTimeout(t,0)},iG=function(e,t){t=t||{};var s=id("TTFB"),i=ig(e,s,iX,t.reportAllChanges);iJ(function(){var n=ic();n&&(s.value=Math.max(n.responseStart-iu(),0),s.entries=[n],i(!0),ih(function(){(i=ig(e,s=id("TTFB",0),iX,t.reportAllChanges))(!0)}))})};function iQ(e){let t=e.defaultView;return[t&&t.scrollX||e.documentElement&&e.documentElement.scrollLeft||e.body&&e.body.scrollLeft||0,t&&t.scrollY||e.documentElement&&e.documentElement.scrollTop||e.body&&e.body.scrollTop||0]}let iY={checkCssInterval:200,scanInMemoryCSS:!1,checkLimit:void 0},iZ=new Set(["password","pass","pwd","mdp","token","bearer","jwt","api_key","api-key","apiKey","secret","ssn","zip","zipcode","x-api-key","www-authenticate","x-csrf-token","x-requested-with","x-forwarded-for","x-real-ip","cookie","authorization","auth","proxy-authorization","set-cookie","account_key"]);function i0(e){return"number"==typeof e?"9".repeat((0|Math.log10((e^e>>31)-(e>>31)))+1):"string"==typeof e?e.replace(/[^\f\n\r\t\v\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff\s]/g,"*"):e}function i1(e){let t={};if(Array.isArray(e))e.forEach(({name:e,value:s})=>{iZ.has(e.toLowerCase())?t[e]=i0(s):t[e]=s});else for(let[s,i]of Object.entries(e))iZ.has(s.toLowerCase())?t[s]=i0(i):t[s]=i;return t}function i2(e){let t;if(!e)return e;let s=!1;try{t=JSON.parse(e),s=!0}catch(e){}if(s)return i5(t),JSON.stringify(t);if(!("string"==typeof e&&e.includes("?")&&e.includes("=")))return e;try{let t=new URLSearchParams(e);for(let e of t.keys())if(iZ.has(e.toLowerCase())){let s=i0(t.get(e));t.set(e,s)}return t.toString()}catch(t){return e}}function i5(e){if(Array.isArray(e))e.forEach(i5);else if(e&&"object"==typeof e)for(let t in e)Object.hasOwn(e,t)&&(iZ.has(t.toLowerCase())?e[t]=i0(e[t]):null!==e[t]&&"object"==typeof e[t]&&i5(e[t]))}class i3{constructor(e=[],t,s){this.ignoredHeaders=e,this.setSessionTokenHeader=t,this.sanitize=s,this.id="",this.name="",this.method="",this.url="",this.status=0,this.statusText="",this.cancelState=0,this.readyState=0,this.header={},this.responseType="",this.requestType="xhr",this.requestHeader={},this.responseSize=0,this.responseSizeText="",this.startTime=0,this.endTime=0,this.duration=0,this.getData={},this.requestData=null}getMessage(){var e;let{reqHs:t,resHs:s}=this.writeHeaders(),i="GET"===this.method?JSON.stringify((i5(e=this.getData),e)):i2(this.requestData),n={headers:i1(t),body:i},r={headers:i1(s),body:i2(this.response)},o=this.sanitize({url:function(e){if(!e)return"";try{let t=new URL(e);if(t.searchParams)for(let e of t.searchParams.keys())iZ.has(e.toLowerCase())&&t.searchParams.set(e,"******");return t.toString()}catch(t){return e}}(this.url),method:this.method,status:this.status,request:n,response:r});if(!o)return null;if(o.url.includes("/graphql")&&o.response.body&&"string"==typeof o.response.body){let e=o.response.body.includes("errors");o.status=e?400:200,this.requestType="graphql"}return{requestType:this.requestType,method:o.method,url:o.url,request:JSON.stringify(o.request),response:JSON.stringify(o.response),status:o.status,startTime:this.startTime,duration:this.duration,responseSize:this.responseSize}}writeHeaders(){let e={};Object.entries(this.requestHeader).forEach(([t,s])=>{this.isHeaderIgnored(t)||(e[t]=s)}),this.setSessionTokenHeader((t,s)=>{e[t]=s});let t={};return Object.entries(this.header).forEach(([e,s])=>{this.isHeaderIgnored(e)||(t[e]=s)}),{reqHs:e,resHs:t}}isHeaderIgnored(e){return Array.isArray(this.ignoredHeaders)?this.ignoredHeaders.map(e=>e.toLowerCase()).includes(e.toLowerCase()):this.ignoredHeaders}}let i4=(e,t)=>{let s="";switch(e){case"":case"text":case"json":"string"==typeof t?s=t:i9(t)||Array.isArray(t)?s=JSON.stringify(t):void 0!==t&&(s=Object.prototype.toString.call(t));break;default:void 0!==t&&(s=Object.prototype.toString.call(t))}return s},i8=e=>{let t;if(!e)return null;try{if("string"==typeof e){("{"===e[0]||"["===e[0])&&(t=e);let s=e.split("&");t=1===s.length?e:s.join(",")}else if(null==e||ArrayBuffer.isView(e)||"undefined"==typeof Symbol||"function"!=typeof e[Symbol.iterator])e instanceof Blob||e instanceof ReadableStream||e instanceof ArrayBuffer?t="byte data":t=i9(e)?e:`can't parse body ${typeof e}`;else{let s=[];for(let[t,i]of e)s.push(`${t}=${"string"==typeof i?i:"[object Object]"}`);t=s.join(",")}return t}catch(e){return"can't parse body"}},i6=(e,t={})=>{i9(t)||(t={});let s=e?e.split("?"):[];if(s.shift(),s.length>0)for(let e of s=s.join("?").split("&")){let s=e.split("=");try{t[s[0]]=decodeURIComponent(s[1])}catch(e){t[s[0]]=s[1]}}return t};function i9(e){return null!==e&&"object"==typeof e}function i7(e){return e<=0?"":e>=1e6?(e/1e3/1e3).toFixed(1)+" MB":e>=1e3?(e/1e3).toFixed(1)+" KB":`${e}B`}let ne=e=>{if(e.startsWith("//")){let t=new URL(window.location.href);e=`${t.protocol}${e}`}return e.startsWith("http")?new URL(e):new URL(e,window.location.href)},nt=e=>e instanceof Blob?e.type:e instanceof FormData?"multipart/form-data":e instanceof URLSearchParams?"application/x-www-form-urlencoded;charset=UTF-8":"text/plain;charset=UTF-8";class ns{constructor(e,t,s,i,n){this.ignoredHeaders=e,this.setSessionTokenHeader=t,this.sanitize=s,this.sendMessage=i,this.isServiceUrl=n}apply(e,t,s){let i=s[0],n=s[1],r=new i3(this.ignoredHeaders,this.setSessionTokenHeader,this.sanitize);if(this.isServiceUrl(i))return e.apply(t,s);let o=ne(i);if(r.method="POST",r.url=i,r.name=(o.pathname.split("/").pop()||"")+o.search,r.requestType="beacon",r.requestHeader={"Content-Type":nt(n)},r.status=0,r.statusText="Pending",o.search&&o.searchParams)for(let[e,t]of(r.getData={},o.searchParams))r.getData[e]=t;r.requestData=i8(n),r.startTime||(r.startTime=performance.now());let a=e.apply(t,s);a?(r.endTime=performance.now(),r.duration=r.endTime-(r.startTime||r.endTime),r.status=0,r.statusText="Sent",r.readyState=4):(r.status=500,r.statusText="Unknown");let l=r.getMessage();return l&&this.sendMessage(l),a}}class ni{static create(e,t,s,i,n,r){if(e)return new Proxy(e,new ns(t,s,i,n,r))}}(i=n||(n={}))[i.UNSENT=0]="UNSENT",i[i.OPENED=1]="OPENED",i[i.HEADERS_RECEIVED=2]="HEADERS_RECEIVED",i[i.LOADING=3]="LOADING",i[i.DONE=4]="DONE";class nn{constructor(e,t){this.resp=e,this.item=t,this.mockReader()}set(e,t,s){return Reflect.set(e,t,s)}get(e,t){let s=Reflect.get(e,t);switch(t){case"arrayBuffer":case"blob":case"formData":case"json":case"text":return()=>(this.item.responseType=t.toLowerCase(),s.apply(e).then(e=>(this.item.response=i4(this.item.responseType,e),e)))}return"function"==typeof s?s.bind(e):s}mockReader(){let e;if(!this.resp.body||"function"!=typeof this.resp.body.getReader)return;let t=this.resp.clone(),s=t.body.getReader;t.body.getReader=()=>{let t=s.apply(this.resp.body);if(this.item.readyState===n.DONE)return t;let i=t.read,r=t.cancel;return this.item.responseType="arraybuffer",t.read=()=>i.apply(t).then(t=>{if(e){let s=new Uint8Array(e.length+t.value.length);s.set(e),s.set(t.value,e.length),e=s}else e=new Uint8Array(t.value);return this.item.endTime=performance.now(),this.item.duration=this.item.endTime-(this.item.startTime||this.item.endTime),this.item.readyState=t.done?4:3,this.item.statusText=t.done?String(this.item.status):"Loading",this.item.responseSize=e.length,this.item.responseSizeText=i7(this.item.responseSize),t.done&&(this.item.response=i4(this.item.responseType,e)),t}),t.cancel=(...s)=>(this.item.cancelState=2,this.item.statusText="Cancel",this.item.endTime=performance.now(),this.item.duration=this.item.endTime-(this.item.startTime||this.item.endTime),this.item.response=i4(this.item.responseType,e),r.apply(t,s)),t}}}class nr{constructor(e,t,s,i,n,r){this.ignoredHeaders=e,this.setSessionTokenHeader=t,this.sanitize=s,this.sendMessage=i,this.isServiceUrl=n,this.tokenUrlMatcher=r}apply(e,t,s){let i=s[0],n=s[1];if(!i||"string"!=typeof i&&!(null==i?void 0:i.url)||(i instanceof URL||"string"==typeof i?this.isServiceUrl(String(i)):this.isServiceUrl(String(i.url))))return e.apply(window,s);let r=new i3(this.ignoredHeaders,this.setSessionTokenHeader,this.sanitize);return this.beforeFetch(r,i,n),this.setSessionTokenHeader((e,t)=>{if(void 0===this.tokenUrlMatcher||this.tokenUrlMatcher(r.url)){if(void 0===s[1]&&s[0]instanceof Request)return s[0].headers.append(e,t);s[1]||(s[1]={}),void 0===s[1].headers&&(s[1]=Object.assign(Object.assign({},s[1]),{headers:{}})),s[1].headers instanceof Headers?s[1].headers.append(e,t):Array.isArray(s[1].headers)?s[1].headers.push([e,t]):s[1].headers[e]=t}}),e.apply(window,s).then(this.afterFetch(r)).catch(e=>{throw r.endTime=performance.now(),r.duration=r.endTime-(r.startTime||r.endTime),e})}beforeFetch(e,t,s){let i,n="GET",r={};if("string"==typeof t?(n=(null==s?void 0:s.method)||"GET",i=ne(t),r=(null==s?void 0:s.headers)||{}):(n=t.method||"GET",i=ne(t.url),r=t.headers),e.method=n,e.requestType="fetch",e.requestHeader=r,e.url=i.toString(),e.name=(i.pathname.split("/").pop()||"")+i.search,e.status=0,e.statusText="Pending",e.readyState=1,e.startTime||(e.startTime=performance.now()),"[object Headers]"===Object.prototype.toString.call(r))for(let[t,s]of(e.requestHeader={},r))e.requestHeader[t]=s;else e.requestHeader=r;if(i.search&&i.searchParams)for(let[t,s]of(e.getData={},i.searchParams))e.getData[t]=s;(null==s?void 0:s.body)&&(e.requestData=i8(s.body))}afterFetch(e){return t=>{e.endTime=performance.now(),e.duration=e.endTime-(e.startTime||e.endTime),e.status=t.status,e.statusText=String(t.status);let s=!1;for(let[i,n]of(e.header={},t.headers))e.header[i]=n,s=n.toLowerCase().indexOf("chunked")>-1||s;return s?e.readyState=3:(e.readyState=4,this.handleResponseBody(t.clone(),e).then(t=>{e.responseSize="string"==typeof t?t.length:t.byteLength,e.responseSizeText=i7(e.responseSize),e.response=i4(e.responseType,t);let s=e.getMessage();s&&this.sendMessage(s)}).catch(e=>{if("AbortError"!==e.name)throw e})),new Proxy(t,new nn(t,e))}}handleResponseBody(e,t){let s=e.headers.get("content-type");return s&&s.includes("application/json")?(t.responseType="json",e.text()):s&&(s.includes("text/html")||s.includes("text/plain"))?(t.responseType="text",e.text()):(t.responseType="arraybuffer",e.arrayBuffer())}}class no{static create(e,t,s,i,n,r){return new Proxy(fetch,new nr(e,t,s,i,n,r))}}class na{constructor(e,t,s,i,n,r,o){this.ignoredHeaders=t,this.setSessionTokenHeader=s,this.sanitize=i,this.sendMessage=n,this.isServiceUrl=r,this.tokenUrlMatcher=o,this.XMLReq=e,this.XMLReq.onreadystatechange=()=>{this.onReadyStateChange()},this.XMLReq.onabort=()=>{this.onAbort()},this.XMLReq.ontimeout=()=>{this.onTimeout()},this.item=new i3(t,s,i),this.item.requestType="xhr"}get(e,t){switch(t){case"open":return this.getOpen(e);case"send":return this.setSessionTokenHeader((t,s)=>{(void 0===this.tokenUrlMatcher||this.tokenUrlMatcher(this.item.url))&&e.setRequestHeader(t,s)}),this.getSend(e);case"setRequestHeader":return this.getSetRequestHeader(e);default:let s=Reflect.get(e,t);if("function"==typeof s)return s.bind(e);return s}}set(e,t,s){switch(t){case"onreadystatechange":return this.setOnReadyStateChange(e,t,s);case"onabort":return this.setOnAbort(e,t,s);case"ontimeout":return this.setOnTimeout(e,t,s)}return Reflect.set(e,t,s)}onReadyStateChange(){if(!(this.item.url&&this.isServiceUrl(this.item.url))&&(this.item.readyState=this.XMLReq.readyState,this.item.responseType=this.XMLReq.responseType,this.item.endTime=performance.now(),this.item.duration=this.item.endTime-this.item.startTime,this.updateItemByReadyState(),setTimeout(()=>{this.item.response=i4(this.item.responseType,this.item.response)},0),this.XMLReq.readyState===n.DONE)){let e=this.item.getMessage();e&&this.sendMessage(e)}}onAbort(){this.item.cancelState=1,this.item.statusText="Abort";let e=this.item.getMessage();e&&this.sendMessage(e)}onTimeout(){this.item.cancelState=3,this.item.statusText="Timeout";let e=this.item.getMessage();e&&this.sendMessage(e)}getOpen(e){let t=Reflect.get(e,"open");return(...s)=>{var i,n,r;let o=s[0],a=s[1];return this.item.method=o?o.toUpperCase():"GET",this.item.url=(null===(i=a.toString)||void 0===i?void 0:i.call(a))||"",this.item.name=null!==(r=null===(n=this.item.url)||void 0===n?void 0:n.replace(RegExp("/*$"),"").split("/").pop())&&void 0!==r?r:"",this.item.getData=i6(this.item.url,{}),t.apply(e,s)}}getSend(e){let t=Reflect.get(e,"send");return(...s)=>{let i=s[0];return this.item.requestData=i8(i),t.apply(e,s)}}getSetRequestHeader(e){let t=Reflect.get(e,"setRequestHeader");return(...s)=>(this.item.requestHeader||(this.item.requestHeader={}),this.item.requestHeader[s[0]]=s[1],t.apply(e,s))}setOnReadyStateChange(e,t,s){return Reflect.set(e,t,(...t)=>{this.onReadyStateChange(),null==s||s.apply(e,t)})}setOnAbort(e,t,s){return Reflect.set(e,t,(...t)=>{this.onAbort(),s.apply(e,t)})}setOnTimeout(e,t,s){return Reflect.set(e,t,(...t)=>{this.onTimeout(),s.apply(e,t)})}updateItemByReadyState(){switch(this.XMLReq.readyState){case n.UNSENT:case n.OPENED:this.item.status=n.UNSENT,this.item.statusText="Pending",this.item.startTime||(this.item.startTime=performance.now());break;case n.HEADERS_RECEIVED:this.item.status=this.XMLReq.status,this.item.statusText="Loading",this.item.header={};let e=(this.XMLReq.getAllResponseHeaders()||"").split("\n");for(let t=0;t<e.length;t++){let s=e[t];if(!s)continue;let i=s.split(": "),n=i[0];this.item.header[n]=i.slice(1).join(": ")}break;case n.LOADING:this.item.status=this.XMLReq.status,this.item.statusText="Loading",this.XMLReq.response&&this.XMLReq.response.length&&(this.item.responseSize=this.XMLReq.response.length,this.item.responseSizeText=i7(this.item.responseSize));break;case n.DONE:this.item.status=this.XMLReq.status||this.item.status||0,this.item.statusText=String(this.item.status),this.item.endTime=performance.now(),this.item.duration=this.item.endTime-(this.item.startTime||this.item.endTime),this.item.response=this.XMLReq.response,this.XMLReq.response&&this.XMLReq.response.length&&(this.item.responseSize=this.XMLReq.response.length,this.item.responseSizeText=i7(this.item.responseSize));break;default:this.item.status=this.XMLReq.status,this.item.statusText="Unknown"}}}class nl{static create(e,t,s,i,n,r){return new Proxy(XMLHttpRequest,{construct(o){let a=new o;return new Proxy(a,new na(a,e,t,s,i,n,r))}})}}let nh=e=>{console.warn(`Openreplay: Can't find ${e} in global context.`)},nc=Symbol("OpenReplayProxyOriginal"),nu=e=>!!e&&void 0!==e[nc],nd=e=>nu(e)?e[nc]:e,np=(e,t)=>(e[nc]=t,e);function nf(e){return e.__or_req_data__||(e.__or_req_data__={body:void 0,headers:{}}),e.__or_req_data__}function ng(e){return"string"==typeof e?e.toUpperCase():"GET"}let nm=tT,nb="/en/sdk/constructor",ny=()=>{try{return!!window.top?.document}catch{return!1}};class nv{constructor(e){if(this.options=e,this.app=null,this.crossdomainMode=!1,this.checkDoNotTrack=()=>this.options.respectDoNotTrack&&("1"==navigator.doNotTrack||"1"==window.doNotTrack),this.signalStartIssue=(e,t)=>{let s=this.checkDoNotTrack();console.log("Tracker couldn't start due to:",JSON.stringify({trackerVersion:"16.4.7",projectKey:this.options.projectKey,doNotTrack:s,reason:t.length?`missing api: ${t.join(",")}`:e}))},this.restartCanvasTracking=()=>{null!==this.app&&this.app.restartCanvasTracking()},this.handleError=(e,t={})=>{if(null!==this.app){if(e instanceof Error){let s=sX(e,[],t);this.app.send(s)}else if(e instanceof ErrorEvent||"PromiseRejectionEvent"in window&&e instanceof PromiseRejectionEvent){let s=sJ(e,void 0,t);null!=s&&this.app.send(s)}}},this.crossdomainMode=!!(eE()&&e.crossdomain?.enabled),!ed||!function(e){if(null==e)return console.error(`OpenReplay: invalid options argument type. Please, check documentation on ${eS}${nb}`),!1;if("string"!=typeof e.projectKey){if("number"!=typeof e.projectKey){if("number"!=typeof e.projectID)return console.error(`OpenReplay: projectKey is missing or wrong type (string is expected). Please, check ${eS}${nb} for more information.`),!1;e.projectKey=e.projectID.toString(),ek("`projectID` option","`projectKey` option",nb)}else console.warn("OpenReplay: projectKey is expected to have a string type."),e.projectKey=e.projectKey.toString()}return null!=e.sessionToken&&ek("`sessionToken` option","`sessionHash` start() option","/"),!0}(e))return;if(window.__OPENREPLAY__||!this.crossdomainMode&&eE()&&ny()&&window.top.__OPENREPLAY__){console.error("OpenReplay: one tracker instance has been initialised already");return}if(!e.__DISABLE_SECURE_MODE&&"https:"!==location.protocol){console.error("OpenReplay: Your website must be publicly accessible and running on SSL in order for OpenReplay to properly capture and replay the user session. You can disable this check by setting `__DISABLE_SECURE_MODE` option to `true` if you are testing in localhost. Keep in mind, that asset files on a local machine are not available to the outside world. This might affect tracking if you use css files.");return}let t=this.checkDoNotTrack(),s=[];if(t)s.push("doNotTrack");else for(let e of["Map","Set","MutationObserver","performance","timing","startsWith","Blob","Worker"])if("timing"===e){if("performance"in window&&!(e in performance)){s.push(e);break}}else if("startsWith"===e){if(!(e in String.prototype)){s.push(e);break}}else if(!(e in window)){s.push(e);break}if(s.length>0){let e=s.join(",");console.error(`OpenReplay: browser doesn't support API required for tracking or doNotTrack is set to 1. Reason: ${e}`),this.signalStartIssue("missing_api",s);return}let i=new sP(e.projectKey,e.sessionToken,e,this.signalStartIssue,this.crossdomainMode);this.app=i,this.crossdomainMode||(function(e,t){let s,i,n,r;let o=document.referrer,a=t?.urlSanitizer||(e=>e),l=t?.titleSanitizer||(e=>e),h=e.safe(()=>{let{URL:t}=document;if(t!==s){let i=a(s=t),n=e.sanitizer.privateMode?sC(document.title):l(document.title),h=e.sanitizer.privateMode?sC(i):i,c=e.sanitizer.privateMode?sC(o):o;e.send(tw(h,c,r,n)),r=0,o=s}}),c=e.safe(()=>{let{innerWidth:t,innerHeight:s}=window;(t!==i||s!==n)&&(i=t,n=s,e.send(eF(i,n)))}),u=void 0===document.hidden?Function.prototype:e.safe(()=>e.send(e4(document.hidden)));e.attachStartCallback(()=>{s=null,r=ef,i=n=-1,h(),c(),u()}),void 0!==document.hidden&&e.attachEventListener(document,"visibilitychange",u,!1,!1),e.ticker.attach(h,1,!1),e.ticker.attach(c,5,!1)}(i,e.urls),function(e){let t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(void 0===t)return;let s=()=>e.send(e3(Math.round(1e3*t.downlink),t.type||"unknown"));s(),t.addEventListener("change",s)}(i),function(e,t){let s,i;if(!Object.assign({capturePerformance:!0},t).capturePerformance)return;let n=()=>{void 0!==s&&-1!==s&&(s++,requestAnimationFrame(n))};e.ticker.attach(()=>{void 0!==i&&-1!==i&&i++},0,!1);let r=()=>{void 0!==s&&void 0!==i&&(e.send(e5(s,i,tI.memory.totalJSHeapSize||0,tI.memory.usedJSHeapSize||0)),i=s=document.hidden?-1:0)};e.attachStartCallback(()=>{i=s=-1,r(),n()}),e.attachStopCallback(()=>{i=s=void 0}),e.ticker.attach(r,165,!1),void 0!==document.hidden&&e.attachEventListener(document,"visibilitychange",r,!1,!1)}(i,e),function(e){e.attachEventListener(window,"focus",function(){document.hidden||(e.debug.log("Openreplay: tab change to"+e.session.getTabId()),e.send(tb(e.session.getTabId())))},!1,!1)}(i)),function(e,t){let s;let{disableClickmaps:i=!1}=t||{},n=-1,r=-1,o=!1,a=null,l=0,h={},c=0,u=0,d=0,p=0;e.attachStartCallback(()=>{s=setInterval(()=>(function(){let t=p/225;if(!c){c=t;return}let s=(t-c)/225;d>4&&s>.008&&e.send(tf(em())),p=0,d=0,c=t})(),225)}),e.attachStopCallback(()=>{n=-1,r=-1,o=!1,a=null,h={},s&&clearInterval(s)});let f=()=>{o&&(e.send(eJ(n,r)),o=!1)},g=(t,s=!1)=>{let c=s?e.attachEventListener.bind(e):e.nodes.attachNodeListener.bind(e.nodes);c(t.documentElement,"mouseover",e=>{let s=s3(e.target,t);s!==a&&(a=s,l=performance.now())}),c(t,"mousemove",s=>{let[i,a]=e.observer.getDocumentOffset(t);n=s.clientX+i,r=s.clientY+a,o=!0;let l=Math.sign(s.movementX);p+=Math.abs(s.movementX)+Math.abs(s.movementY),l!==u&&(u=l,d++)},!1),c(t,"click",s=>{let n=s3(s.target,t);if(!s.clientX&&!s.clientY||null===n)return;let r=e.nodes.getID(n);if(void 0!==r){let o=s.pageX,c=s.pageY,u=t.documentElement.scrollWidth,d=t.documentElement.scrollHeight,p=s4(o/u),g=s4(c/d);f();let m=function(t){let s=eT(t);if(null!==s)return s;if(si(t,"input"))return sZ(t);if(s5(t)){let s="";return t instanceof HTMLElement&&(s=e.sanitizer.getInnerTextSecure(t)),ey(s=s||t.id||t.className).slice(0,100)}return""}(n);e.send(ts(r,a===n?Math.round(performance.now()-l):0,e.sanitizer.privateMode?m.replaceAll(/./g,"*"):m,s5(n)&&!i?h[r]=h[r]||function(e){if(!e||1!==e.nodeType)return!1;if(e.id)return`#${s1(e.id)}`;let t=[];for(;e&&1===e.nodeType&&e!==e.ownerDocument;){if(e.id){t.unshift(`#${s1(e.id)}`);break}let s=e.tagName.toLowerCase();if(e.classList?.length){for(let i of e.classList)if(s6(i)&&s8(i,e.ownerDocument))return t.unshift(`${s}.${s1(i)}`),t.join(" > ")}let i=function(e){if(!e.classList?.length||!e.parentNode)return null;let t=e.parentNode.children;e:for(let s of e.classList)if(s6(s)&&s8(s,e.ownerDocument)){for(let i of t)if(i!==e&&i.classList?.contains(s))continue e;return s}return null}(e);if(i)t.unshift(`${s}.${s1(i)}`);else if(e===e.ownerDocument.body||e===e.ownerDocument.documentElement)t.unshift(s);else{let i=1;for(let t=e.previousElementSibling;t;t=t.previousElementSibling)t.tagName.toLowerCase()===s&&i++;t.unshift(`${s}:nth-of-type(${i})`)}e=e.parentNode}return t.join(" > ")}(n)||"":"",p,g),!0)}a=null})};e.nodes.attachNodeCallback(e=>{st(e)&&g(e)}),g(document,!0),e.ticker.attach(f,t?.trackingOffset||7)}(i,e.mouse),function(e,t){let s=!1,i=new Map;function n(e){t6(e)&&(t7(e)&&i.set(e,[e.scrollLeft,e.scrollTop]),st(e)&&i.set(e,iQ(e)))}let r=e.safe(()=>{t||e.send(ej(...iQ(document)))}),o=e.safe((t,s)=>{let i=e.nodes.getID(s);void 0!==i&&e.send(eV(i,t[0],t[1]))});e.attachStartCallback(r),e.attachStopCallback(()=>{s=!1,i.clear()}),e.nodes.attachNodeCallback((t,s)=>{s&&(t7(t)&&t.scrollLeft+t.scrollTop>0?i.set(t,[t.scrollLeft,t.scrollTop]):st(t)&&i.set(t,iQ(t))),ss(t)&&e.nodes.attachNodeListener(t,"scroll",e=>{n(e.target)})}),e.attachEventListener(document,"scroll",e=>{let t=e.target;if(t===document){s=!0;return}n(t)}),e.ticker.attach(()=>{s&&(r(),s=!1),i.forEach(o),i.clear()},5,!1)}(i,this.crossdomainMode),function(e,t){if(null===e)return;if(!window.CSSStyleSheet){e.send(te("no_stylesheet_prototype_in_window",""));return}let s={...iY,...t},i=new Map,n=null,r=new Set,o=s.checkCssInterval||200,a={};function l(){if(s.scanInMemoryCSS)for(let t of r.values())try{let n=sf.get(t);if(!n)continue;if(s.checkLimit&&(a[n]?a[n]++:a[n]=0,a[n]>s.checkLimit)){r.delete(t);return}for(let s=0;s<t.cssRules.length;s++)try{let r=t.cssRules[s],o=`${n}:${s}`,a=i.get(o),l=r.cssText;a!==l&&(void 0!==a&&e.send(to(n,s)),e.send(tr(n,l,s,e.getBaseHref())),i.set(o,l))}catch(e){}for(let e of Array.from(i.keys()).filter(e=>e.startsWith(`${n}:`)))parseInt(e.split(":")[1],10)>=t.cssRules.length&&i.delete(e)}catch(e){r.delete(t)}}let h=/{\s*}/,c=e.safe((t,s,n)=>{let o=sf.get(t);o&&("string"==typeof n?(e.send(tr(o,n,s,e.getBaseHref())),h.test(n)&&(i.set(`${o}:${s}`,n),r.add(t))):(e.send(to(o,s)),i.has(`${o}:${s}`)&&i.delete(`${o}:${s}`)))}),u=e.safe(t=>{let s=t;for(;s.parentRule;)s=s.parentRule;let n=s.parentStyleSheet;if(!n)return;let o=sf.get(n);if(!o)return;let a=s.cssText,l=Array.from(n.cssRules).indexOf(s);l>=0&&(e.send(tr(o,a,l,e.getBaseHref())),e.send(to(o,l+1)),h.test(a)&&(i.set(`${o}:${l}`,a),r.add(n)))}),d=e.safe(e=>{if(e.__css_tracking_patched__)return;e.__css_tracking_patched__=!0;let{insertRule:t,deleteRule:s}=e.CSSStyleSheet.prototype,{insertRule:i,deleteRule:n}=e.CSSGroupingRule.prototype;e.CSSStyleSheet.prototype.insertRule=function(e,s=0){let i=t.call(this,e,s);return c(this,i,e),i},e.CSSStyleSheet.prototype.deleteRule=function(e){return c(this,e),s.call(this,e)},e.CSSGroupingRule.prototype.insertRule=function(e,t=0){let s=i.call(this,e,t);return u(this),s},e.CSSGroupingRule.prototype.deleteRule=function(e){let t=n.call(this,e);return u(this),t}});d(window),e.observer.attachContextCallback(d),e.nodes.attachNodeCallback(t=>{if(!si(t,"style")||!t.sheet||null!==t.textContent&&t.textContent.trim().length>0)return;let s=e.nodes.getID(t);if(!s)return;let i=t.sheet,n=sp();sf.set(i,n),e.send(ta(n,s));for(let e=0;e<i.cssRules.length;e++)try{c(i,e,i.cssRules[e].cssText)}catch(e){}}),setTimeout(function(){!n&&s.scanInMemoryCSS&&(n=window.setInterval(l,o))},50),e.attachStopCallback(()=>{n&&(clearInterval(n),n=null),i.clear()})}(i,e.css),function(e){if(null===e||!su(document))return;let t=new Map,s=new Map,i=i=>setTimeout(()=>{let n=e.nodes.getID(i);if(i===document&&(n=0),void 0===n)return;let r=s.get(n);r||(r=[]);let o=[],a=i.adoptedStyleSheets;if(a&&Symbol.iterator in a)for(let s of a){let i=t.get(s),a=!i;if(i||(i=sp(),t.set(s,i)),r.includes(i)||e.send(ta(i,n)),a){let t=s.cssRules;for(let s=0;s<t.length;s++)e.send(tr(i,t[s].cssText,s,e.getBaseHref()))}o.push(i)}if(Symbol.iterator in r)for(let t of r)o.includes(t)||e.send(tl(t,n));s.set(n,o)},20);function n(e){let t=Object.getOwnPropertyDescriptor(e,"adoptedStyleSheets");t&&Object.defineProperty(e,"adoptedStyleSheets",{...t,set:function(e){let s=t.set.call(this,e);return i(this),s}})}let r=s=>{if(s.__openreplay_adpss_patched__)return;s.__openreplay_adpss_patched__=!0,n(s.Document.prototype),n(s.ShadowRoot.prototype);let{replace:i,replaceSync:r}=s.CSSStyleSheet.prototype;s.CSSStyleSheet.prototype.replace=function(s){return i.call(this,s).then(i=>{let n=t.get(this);return n&&e.send(tn(n,s,e.getBaseHref())),i})},s.CSSStyleSheet.prototype.replaceSync=function(s){let i=t.get(this);return i&&e.send(tn(i,s,e.getBaseHref())),r.call(this,s)}};r(window),e.observer.attachContextCallback(e.safe(r)),e.attachStopCallback(()=>{t.clear(),s.clear()}),e.attachStartCallback(()=>{i(document)}),e.nodes.attachNodeCallback(e=>{su(e)&&i(e)})}(i),function(e,t){let s=Object.assign({consoleMethods:sz,consoleThrottling:30},t);if(!Array.isArray(s.consoleMethods)||0===s.consoleMethods.length)return;let i=e.safe((t,s)=>{let i=("string"==typeof s[0]&&s.unshift(s.shift().replace(/%(o|s|f|d|i)/g,(e,t)=>{let i=s.shift();if(void 0===i)return e;switch(t){case"o":return sH(i);case"s":return sU(i);case"f":return"number"!=typeof i?"NaN":i.toString();case"d":case"i":return"number"!=typeof i?"NaN":Math.floor(i).toString();default:return e}})),s.map(sH).join(" "));e.sanitizer.privateMode&&(i=i.replaceAll(/./g,"*")),e.send(eG(t,i))}),n=0,r=()=>{n=0};e.attachStartCallback(r),e.ticker.attach(r,33,!1);let o=(t,r)=>{let o={apply:function(e,t,o){Reflect.apply(e,r,o),(n+=1)>s.consoleThrottling||i(e.name,o)}};s.consoleMethods.forEach(s=>{if(-1===sz.indexOf(s)){e.debug.error(`OpenReplay: unsupported console method "${s}"`);return}let i=r.console[s];t[s]=new Proxy(i,o)})},a=e.safe(e=>o(e.console,e));a(window),e.observer.attachContextCallback(a)}(i,e),function(e,t){function s(t){function s(s){let i=sJ(s,t);null!=i&&e.send(i)}try{e.attachEventListener(t,"unhandledrejection",s),e.attachEventListener(t,"error",s)}catch(e){console.error("Error while attaching to error proto contexts",e)}}Object.assign({captureExceptions:!0},t).captureExceptions&&(e.observer.attachContextCallback(s),s(window))}(i,e),function(e){function t(t,s){e.attributeSender.sendSetAttribute(t,"src","https://static.openreplay.com/tracker/placeholder.jpeg");let{width:i,height:n}=s.getBoundingClientRect();s.hasAttribute("width")||e.attributeSender.sendSetAttribute(t,"width",String(i)),s.hasAttribute("height")||e.attributeSender.sendSetAttribute(t,"height",String(n))}let s=function(t,s){let{srcset:i}=s;if(!i)return;let n=i.split(i.match(/,\s+/)?/,\s+/:",").map(e=>sG(e)).join(", ");e.attributeSender.sendSetAttribute(t,"srcset",n)},i=function(s,i){i.src.length>1e5&&t(s,i),e.send(e9(s,"src",i.src,e.getBaseHref()))},n=e.safe(function(t){let s=sG(t.src||"");ev(s)&&e.send(tm(e.timestamp(),0,0,0,0,0,s,"img",0,!1))}),r=e.safe(function(r){var o;let a=e.nodes.getID(r);void 0!==a&&r.complete&&(0!==r.naturalHeight||0!==r.naturalWidth||(o=r.src,ep&&(o.startsWith("data:image/svg+xml")||o.match(/.svg$|/i)))?e.sanitizer.isHidden(a)||e.sanitizer.isObscured(a)?t(a,r):(i(a,r),s(a,r)):n(r))}),o=eN(e.safe(t=>{for(let n of t)if("attributes"===n.type){let t=n.target,r=e.nodes.getID(t);if(void 0===r)return;"src"===n.attributeName&&i(r,t),"srcset"===n.attributeName&&s(r,t)}}),e.options.forceNgOff);e.attachStopCallback(()=>{o.disconnect()}),e.nodes.attachNodeCallback(t=>{si(t,"img")&&(e.nodes.attachNodeListener(t,"error",()=>n(t)),e.nodes.attachNodeListener(t,"load",()=>r(t)),r(t),o.observe(t,{attributes:!0,attributeFilter:["src","srcset"]}))})}(i),function(e,t){let s=Object.assign({obscureInputNumbers:!0,obscureInputEmails:!0,defaultInputMode:s0.Obscured,obscureInputDates:!1},t);function i(t,i){let n=i.value,r=s.defaultInputMode;"password"===i.type||e.sanitizer.isHidden(t)?r=s0.Hidden:(e.sanitizer.isObscured(t)||r===s0.Plain&&(s.obscureInputNumbers&&"date"!==i.type&&/\d\d\d\d/.test(n)||s.obscureInputDates&&"date"===i.type||s.obscureInputEmails&&("email"===i.type||~n.indexOf("@"))))&&(r=s0.Obscured);let o=0;switch(r){case s0.Hidden:o=-1,n="";break;case s0.Obscured:o=n.length,n=""}return{value:n,mask:o}}function n(t,s){let{value:n,mask:r}=i(t,s);e.send(eK(t,n,r))}let r=new Map,o=new Map;function a(e,t){r.get(e)!==t.value&&(r.set(e,t.value),n(e,t))}function l(t,s){o.get(t)!==s&&(o.set(t,s),e.send(eX(t,s)))}e.attachStopCallback(()=>{r.clear(),o.clear()}),e.ticker.attach(()=>{r.forEach((t,s)=>{let i=e.nodes.getNode(s);if(!i)return r.delete(s);a(s,i)}),o.forEach((t,s)=>{let i=e.nodes.getNode(s);if(!i)return o.delete(s);l(s,i.checked)})},3),e.nodes.attachNodeCallback(e.safe(t=>{let s=e.nodes.getID(t);if(void 0!==s){if(si(t,"select")&&(n(s,t),e.nodes.attachNodeListener(t,"change",()=>n(s,t))),si(t,"textarea")||si(t,"input")&&sQ.includes(t.type)){a(s,t);let n=0,r=0,o=0;e.nodes.attachNodeListener(t,"focus",()=>{n=em()}),e.nodes.attachNodeListener(t,"input",()=>{0===r&&0!==n&&(r=em()-n)}),e.nodes.attachNodeListener(t,"change",()=>{0!==n&&(o=em()-n),function(t,s,n,r){let{value:o,mask:a}=i(t,s),l=sZ(s);e.sanitizer.privateMode&&(l=l.replaceAll(/./g,"*")),e.send(td(t,o,0!==a,l,n,r))}(s,t,r,o),r=0,o=0,n=0});return}if(function(e){if(!si(e,"input"))return!1;let t=e.type;return"checkbox"===t||"radio"===t}(t)){l(s,t.checked),e.nodes.attachNodeListener(t,"change",()=>l(s,t.checked));return}}}))}(i,e),function(e,t){let s=Object.assign({captureResourceTimings:!0,capturePageLoadTimings:!0,capturePageRenderTimings:!0,excludedResourceUrls:[]},t);if("PerformanceObserver"in window||(s.captureResourceTimings=!1),!s.captureResourceTimings)return;let i={};function n(t){if(t.duration<0||!ev(t.name)||e.isServiceURL(t.name))return;null!==i&&(i[t.name]=t.startTime+t.duration);let n=!1;if(s.excludedResourceUrls?.forEach(e=>{if(t.name.startsWith(e)){n=!0;return}}),n)return;let r=s.resourceNameSanitizer?s.resourceNameSanitizer(t.name):t.name;e.send(tm(t.startTime+ef,t.duration,t.responseStart&&t.startTime?t.responseStart-t.startTime:0,t.transferSize>t.encodedBodySize?t.transferSize-t.encodedBodySize:0,t.encodedBodySize||0,t.decodedBodySize||0,e.sanitizer.privateMode?t.name.replaceAll(/./g,"*"):r,t.initiatorType,t.transferSize,t.responseStatus&&304===t.responseStatus||0===t.transferSize))}let r=new PerformanceObserver(e=>e.getEntries().forEach(n));function o(t){if(e.active())return e.send(tk(t.name,String(t.value)))}e.attachStartCallback(function({sessionID:e}){r.observe({type:"resource",buffered:!0}),iN(o),iq(o),iK(o),iG(o)}),e.attachStopCallback(function(){r.disconnect()});let a=0,l=0;if(s.capturePageLoadTimings){let t=!1;e.ticker.attach(()=>{if(!t&&((0===a||0===l)&&performance.getEntriesByType("paint").forEach(e=>{let{name:t,startTime:s}=e;switch(t){case"first-paint":a=s;break;case"first-contentful-paint":l=s}}),performance.timing.loadEventEnd||performance.now()>3e4)){t=!0;let{navigationStart:s,requestStart:i,responseStart:n,responseEnd:r,domContentLoadedEventStart:o,domContentLoadedEventEnd:h,loadEventStart:c,loadEventEnd:u}=performance.timing;e.send(eQ(i-s||0,n-s||0,r-s||0,o-s||0,h-s||0,c-s||0,u-s||0,a,l))}},30)}if(s.capturePageRenderTimings){let t=0,s=0,n=0,r=null,o=!1;e.ticker.attach(()=>{if(o)return;let h=performance.now();if(null!==i&&h-(t=Math.max.apply(null,Object.keys(i).map(e=>i[e])))>1e3&&(r=function(e){let t=[],s=document.getElementsByTagName("*"),i=/url\(("[^"]*"|'[^']*'|[^)]*)\)/i;for(let n=0;n<s.length;n++){let r=s[n],o="";if(si(r,"img")&&(o=r.currentSrc||r.src),!o){let e=getComputedStyle(r).getPropertyValue("background-image");if(e){let t=i.exec(e);null!==t&&((o=t[1]).startsWith('"')||o.startsWith("'"))&&(o=o.substr(1,o.length-2))}}if(!o)continue;let a="data:image"===o.substr(0,10)?0:e[o];if(void 0===a)continue;let l=r.getBoundingClientRect(),h=Math.max(l.top,0),c=Math.max(l.left,0),u=Math.min(l.bottom,window.innerHeight||document.documentElement&&document.documentElement.clientHeight||0),d=Math.min(l.right,window.innerWidth||document.documentElement&&document.documentElement.clientWidth||0);if(u<=h||d<=c)continue;let p=(u-h)*(d-c);t.push({time:a,area:p})}return t}(i),i=null),null!==n&&(h-n>50&&(s=h),n=h-s>5e3?null:h),null!==r&&null===n||h>3e4){o=!0,i=null;let h=null===r?0:function(e,t){let s=Math.max(document.documentElement&&document.documentElement.clientWidth||0,window.innerWidth||0)*Math.max(document.documentElement&&document.documentElement.clientHeight||0,window.innerHeight||0)/10,i=s*e;for(let n=0;n<t.length;n++){let{time:r,area:o}=t[n];s+=o,i+=o*(r>e?r:e)}return 0===s?0:i/s}(l||a,r),{domContentLoadedEventEnd:c,navigationStart:u}=performance.timing,d=null===n?Math.max(s,l,c-u||0):0;e.send(eY(h,l>t?l:t,d))}})}}(i,e),function(e){function t(t){let s=e.nodes.getID(t);void 0!==s&&e.send(e6(s))}let s=!1;e.nodes.attachNodeCallback(i=>{si(i,"body")&&(e.nodes.attachNodeListener(i,"focus",e=>{t6(e.target)&&(t(e.target),s=!1)}),e.nodes.attachNodeListener(i,"blur",t=>{null===t.relatedTarget&&(s=!0,setTimeout(()=>{s&&e.send(e6(-1))},0))}))}),e.attachStartCallback(()=>{let e=document.activeElement;for(;e&&si(e,"iframe")&&e.contentDocument;)e=e.contentDocument.activeElement;e&&e!==e.ownerDocument.body&&t(e)},!0)}(i),function(e){if(!window.FontFace)return;let t=new Map,s=s=>{class i extends s.FontFace{constructor(...i){if("string"==typeof i[1]){let n="";i[2]&&e.safe(()=>{n=JSON.stringify(i[2])});let r=[i[0],i[1],n],o=t.get(s.document)||[];o.push(r),t.set(s.document,o);let a=s===window?0:e.nodes.getID(s.document);if(void 0===a)return;e.active()&&e.send(e8(a,...r))}super(...i)}}s.FontFace=i};e.observer.attachContextCallback(s),s(window),e.nodes.attachNodeCallback(e.safe(s=>{if(!st(s))return;let i=t.get(s);if(!i)return;let n=s.defaultView===window?0:e.nodes.getID(s);void 0!==n&&i.forEach(t=>{e.send(e8(n,...t))})}))}(i),e.network?.disabled||function(e,t={}){if(t.disabled)return;let s=Object.assign({failuresOnly:!1,ignoreHeaders:["cookie","set-cookie","authorization"],capturePayload:!1,sessionTokenHeader:!1,captureInIframes:!0,axiosInstances:void 0,useProxy:!0},t);!1===s.useProxy&&e.debug.warn("Network module is migrating to proxy api, to gradually migrate and test it set useProxy to true");let i=s.ignoreHeaders,n=Array.isArray(i)?e=>i.includes(e):()=>i,r=!0===s.sessionTokenHeader?"X-OpenReplay-SessionToken":s.sessionTokenHeader;function o(t){if(r){let s=e.getSessionToken();s&&e.safe(t)(r,s)}}function a(t){if((!s.capturePayload||e.sanitizer.privateMode)&&(delete t.request.body,delete t.response.body),s.sanitizer){let e=t.response.body;if("string"==typeof e)try{t.response.body=JSON.parse(e)}catch{}return s.sanitizer(t)}return t}function l(t){if(t&&"string"!=typeof t.body)try{t.body=JSON.stringify(t.body)}catch{t.body="<unable to stringify>",e.notify.warn("Openreplay fetch couldn't stringify body:",t.body)}return JSON.stringify(t)}let h=t=>{if(s.useProxy)return function(e,t,s,i,n,r,o={xhr:!0,fetch:!0,beacon:!0},a){var l;if(e){if(o.xhr){let o=nd(e.XMLHttpRequest);o?e.XMLHttpRequest=np(nl.create(t,s,i,n,r,a),o):nh("XMLHttpRequest")}if(o.fetch){let o=nd(e.fetch);o?e.fetch=np(no.create(t,s,i,n,r,a),o):nh("fetch")}if(o.beacon&&(null===(l=e.navigator)||void 0===l?void 0:l.sendBeacon)){let o=nd(e.navigator.sendBeacon);e.navigator.sendBeacon=np(ni.create(o,t,s,i,n,r),o)}}}(t,!!e.sanitizer.privateMode||s.ignoreHeaders,o,a,t=>{if(s.failuresOnly&&t.status<400)return;let i=e.sanitizer.privateMode?"************":t.url;e.send(tc(t.requestType,t.method,i,t.request,t.response,t.status,t.startTime+ef,t.duration,t.responseSize))},t=>e.isServiceURL(t),{xhr:!0,fetch:!0,beacon:!0},s.tokenUrlMatcher);let r=t.fetch.bind(t);t.fetch=(t,h={})=>{if(!("string"==typeof t||t instanceof URL)||e.isServiceURL(String(t)))return r(t,h);o(function(e,t){void 0===h.headers&&(h.headers={}),h.headers instanceof Headers?h.headers.append(e,t):Array.isArray(h.headers)?h.headers.push([e,t]):h.headers[e]=t});let c=performance.now();return r(t,h).then(r=>{let o=performance.now()-c;if(s.failuresOnly&&r.status<400)return r;let u=r.clone();return u.text().then(s=>{let r={},d={};if(!0!==i){let e=([e,t])=>{n(e)||(r[e]=t)};h.headers instanceof Headers?h.headers.forEach((t,s)=>e([s,t])):Array.isArray(h.headers)?h.headers.forEach(e):"object"==typeof h.headers&&Object.entries(h.headers).forEach(e),u.headers.forEach((e,t)=>{n(t)||(d[t]=e)})}let p=ng(h.method),f=a({url:String(t),method:p,status:u.status,request:{headers:r,body:h.body||null},response:{headers:d,body:s}});f&&e.send(tc("fetch",p,String(f.url),l(f.request),l(f.response),u.status,c+ef,o,0))}).catch(t=>e.debug.error("Could not process Fetch response:",t)),r})};let h=t.XMLHttpRequest.prototype.open,c=t.XMLHttpRequest.prototype.setRequestHeader,u=t.XMLHttpRequest.prototype.send;s.axiosInstances||(t.XMLHttpRequest.prototype.open=function(t,s){let i=this;o((e,t)=>i.setRequestHeader(e,t));let r=0;return i.addEventListener("loadstart",e=>{r=e.timeStamp}),i.addEventListener("load",e.safe(o=>{let{headers:h,body:c}=nf(i),u=r>0?o.timeStamp-r:0,d=(i.getAllResponseHeaders()||"").trim().split(/[\r\n]+/),p={};d.forEach(function(e){let t=e.split(": "),s=t.shift();n(s)||(p[s]=t.join(": "))});let f=ng(t),g=a({url:String(s),method:f,status:i.status,request:{headers:h,body:c||null},response:{headers:p,body:i.response}});g&&e.send(tc("xhr",f,String(g.url),l(g.request),l(g.response),i.status,r+ef,u,0))})),h.apply(this,arguments)},t.XMLHttpRequest.prototype.send=function(e){return nf(this).body=e,u.apply(this,arguments)},t.XMLHttpRequest.prototype.setRequestHeader=function(e,t){return n(e)||(nf(this).headers[e]=t),c.apply(this,arguments)})};h(window),s.axiosInstances&&s.axiosInstances.forEach(t=>{!function(e,t,s,i,n){function r(t){e.debug.log("Openreplay: capturing axios response data",t);let{headers:r,data:o,method:a,url:l,baseURL:h}=t.config,{data:c,headers:u,status:d,response:p}=t,{data:f,headers:g,status:m}=p||{},b=s.ignoreHeaders,y=Array.isArray(b)?e=>b.includes(e):()=>b;function v(e,t){y(t[0])||(e[t[0]]=t[1])}let S={},w={};r.toJSON?S=r.toJSON():r instanceof Headers?r.forEach((e,t)=>v(S,[t,e])):Array.isArray(r)?r.forEach(e=>v(S,e)):"object"==typeof r&&Object.entries(r).forEach(e=>v(S,e));let k=g||u;k.toJSON?w=k.toJSON():k instanceof Headers?k.forEach((e,t)=>v(w,[t,e])):Array.isArray(k)?k.forEach(e=>v(w,e)):"object"==typeof k&&Object.entries(k).forEach(([e,t])=>{y(e)||(w[e]=t)});let T=i({url:l,method:a||"",status:d||m||0,request:{headers:S,body:o},response:{headers:w,body:f||c}});if(!T){e.debug.log("Openreplay: empty request/response info, skipping");return}let I=t.config.__openreplay_timing,x=performance.now()-I;e.debug.log("Openreplay: final req object",T),e.send(tc("xhr",String(a),String(T.url),n(T.request),n(T.response),T.status,I+ef,x,0))}e.debug.log("Openreplay: attaching axios spy to instance",t);let o=t.interceptors.request.use(function(t){if(e.debug.log("Openreplay: capturing API request",t),t.__openreplay_timing=performance.now(),s.sessionTokenHeader){let i="string"==typeof s.sessionTokenHeader?s.sessionTokenHeader:"X-OpenReplay-Session-Token",n=e.getSessionToken();n&&t.headers.set(i,n)}return t},function(t){e.debug.log("Openreplay: failed API request, skipping",t)},{synchronous:!0}),a=t.interceptors.response.use(function(e){return s.failuresOnly||r(e),e},function(t){return e.debug.log("Openreplay: capturing API request error",t),null!==t&&"object"==typeof t&&!0===t.isAxiosError&&t.response?r(t.response):t instanceof Error&&e.send(sX(t,[])),Promise.reject(t)},{synchronous:!0});e.attachStopCallback(()=>{t.interceptors.request.eject?.(o),t.interceptors.response.eject?.(a)})}(e,t,s,a,l)}),s.captureInIframes&&e.observer.attachContextCallback(e.safe(h))}(i,e.network),function(e){e.attachEventListener(document,"selectionchange",()=>{let t=document.getSelection();if(null===t||t.isCollapsed)e.send(tp(-1,-1,""));else{let s=e.nodes.getID(t.anchorNode),i=e.nodes.getID(t.focusNode),n=t.toString().replace(/\s+/g," ");s&&i&&e.send(tp(s,i,n))}})}(i),window.__OPENREPLAY__=this,e.flags&&e.flags.onFlagsLoad&&this.onFlagsLoad(e.flags.onFlagsLoad);let n=window.open;(e.autoResetOnWindowOpen||e.resetTabOnWindowOpen)&&(i.attachStartCallback(()=>{let t=i.getTabId(),s=i.sessionStorage??window.sessionStorage;window.open=function(...r){return e.autoResetOnWindowOpen&&i.resetNextPageSession(!0),e.resetTabOnWindowOpen&&s.removeItem(e.session_tabid_key||"__openreplay_tabid"),i.resetNextPageSession(!1),s.setItem(e.session_tabid_key||"__openreplay_tabid",t),n.call(window,...r)}}),i.attachStopCallback(()=>{window.open=n}))}isFlagEnabled(e){return this.featureFlags.isFlagEnabled(e)}onFlagsLoad(e){this.app?.featureFlags.onFlagsLoad(e)}clearPersistFlags(){this.app?.featureFlags.clearPersistFlags()}reloadFlags(){return this.app?.featureFlags.reloadFlags()}getFeatureFlag(e){return this.app?.featureFlags.getFeatureFlag(e)}getAllFeatureFlags(){return this.app?.featureFlags.flags}use(e){return e(this.app,this.options)}isActive(){return null!==this.app&&this.app.active()}trackWs(e){if(null!==this.app)return this.app.trackWs(e)}start(e){return this.browserEnvCheck()?null===this.app?Promise.reject("Browser doesn't support required api, or doNotTrack is active."):this.app.start(e):Promise.reject("Trying to start not in browser.")}browserEnvCheck(){return!!ed||(console.error(`OpenReplay: you are trying to start Tracker on a node.js environment. If you want to use OpenReplay with SSR, please, use componentDidMount or useEffect API for placing the \`tracker.start()\` line. Check documentation on ${eS}${nb}`),!1)}coldStart(e,t){return this.browserEnvCheck()?null===this.app?Promise.reject("Tracker not initialized"):void this.app.coldStart(e,t):Promise.reject("Trying to start not in browser.")}startOfflineRecording(e,t){return this.browserEnvCheck()?null===this.app?Promise.reject("Tracker not initialized"):this.app.offlineRecording(e,t):Promise.reject("Trying to start not in browser.")}uploadOfflineRecording(){if(null!==this.app)return this.app.uploadOfflineRecording()}stop(){if(null!==this.app)return this.app.stop(),this.app.session.getSessionHash()}forceFlushBatch(){null!==this.app&&this.app.forceFlushBatch()}getSessionToken(){return null===this.app?null:this.app.getSessionToken()}getSessionInfo(){return null===this.app?null:this.app.session.getInfo()}getSessionID(){return null===this.app?null:this.app.getSessionID()}getTabId(){return null===this.app?null:this.app.getTabId()}getUxId(){return null===this.app?null:this.app.getUxtId()}sessionID(){return ek("'sessionID' method","'getSessionID' method","/"),this.getSessionID()}getSessionURL(e){if(null!==this.app)return this.app.getSessionURL(e)}setUserID(e){"string"==typeof e&&null!==this.app&&this.app.session.setUserID(e)}userID(e){ek("'userID' method","'setUserID' method","/"),this.setUserID(e)}setUserAnonymousID(e){"string"==typeof e&&null!==this.app&&this.app.send(e1(e))}userAnonymousID(e){ek("'userAnonymousID' method","'setUserAnonymousID' method","/"),this.setUserAnonymousID(e)}setMetadata(e,t){"string"==typeof e&&"string"==typeof t&&null!==this.app&&this.app.session.setMetadata(e,t)}metadata(e,t){ek("'metadata' method","'setMetadata' method","/"),this.setMetadata(e,t)}event(e,t=null,s=!1){if("string"==typeof e&&null!==this.app){if(s)return this.issue(e,t);try{t=JSON.stringify(t)}catch(e){return}this.app.send(eZ(e,t))}}issue(e,t=null){if("string"==typeof e&&null!==this.app){try{t=JSON.stringify(t)}catch(e){return}this.app.send(tt(e,t))}}}class nS{constructor(){this.instance=null,this.isConfigured=!1}configure(e){if(ed){if(this.isConfigured){console.warn("OpenReplay: Tracker is already configured. You should only call configure once.");return}if(!e.projectKey){console.error("OpenReplay: Missing required projectKey option");return}this.instance=new nv(e),this.isConfigured=!0}}get options(){return this.instance?.options||null}start(e){return ed?this.ensureConfigured()?this.instance?.start(e)||Promise.resolve({success:!1,reason:"Tracker not initialized"}):Promise.resolve({success:!1,reason:"Tracker not configured"}):Promise.resolve({success:!1,reason:"Not in browser environment"})}stop(){if(ed&&this.ensureConfigured()&&this.instance)return this.instance.stop()}setUserID(e){ed&&this.ensureConfigured()&&this.instance&&this.instance.setUserID(e)}setMetadata(e,t){ed&&this.ensureConfigured()&&this.instance&&this.instance.setMetadata(e,t)}getSessionURL(e){if(ed&&this.ensureConfigured()&&this.instance)return this.instance.getSessionURL(e)}getSessionID(){return ed&&this.ensureConfigured()&&this.instance?this.instance.getSessionID():null}getSessionToken(){return ed&&this.ensureConfigured()&&this.instance?this.instance.getSessionToken():null}event(e,t=null,s=!1){ed&&this.ensureConfigured()&&this.instance&&this.instance.event(e,t,s)}issue(e,t=null){ed&&this.ensureConfigured()&&this.instance&&this.instance.issue(e,t)}handleError(e,t={}){ed&&this.ensureConfigured()&&this.instance&&this.instance.handleError(e,t)}isFlagEnabled(e){return!!(ed&&this.ensureConfigured())&&!!this.instance&&this.instance.isFlagEnabled(e)}onFlagsLoad(...e){ed&&this.ensureConfigured()&&this.instance&&this.instance.onFlagsLoad(...e)}clearPersistFlags(){ed&&this.ensureConfigured()&&this.instance&&this.instance.clearPersistFlags()}reloadFlags(){if(ed&&this.ensureConfigured()&&this.instance)return this.instance.reloadFlags()}getFeatureFlag(e){if(ed&&this.ensureConfigured()&&this.instance)return this.instance.getFeatureFlag(e)}getAllFeatureFlags(){if(ed&&this.ensureConfigured()&&this.instance)return this.instance.getAllFeatureFlags()}restartCanvasTracking(){ed&&this.ensureConfigured()&&this.instance&&this.instance.restartCanvasTracking()}setUserAnonymousID(e){ed&&this.ensureConfigured()&&this.instance&&this.instance.setUserAnonymousID(e)}isActive(){return!!(ed&&this.ensureConfigured())&&!!this.instance&&this.instance.isActive()}getInstance(){return this.ensureConfigured()&&ed?this.instance:null}coldStart(e,t){if(ed&&this.ensureConfigured()&&this.instance)return this.instance.coldStart(e,t)}trackWs(e){return ed&&this.ensureConfigured()&&this.instance?this.instance.trackWs(e):()=>{}}ensureConfigured(){return!!this.isConfigured||!ed||(console.warn('OpenReplay: Tracker must be configured before use. Call tracker.configure({projectKey: "your-project-key"}) first.'),!1)}use(e){return ed&&this.ensureConfigured()&&this.instance?this.instance.use(e):e(null)}startOfflineRecording(...e){if(ed&&this.ensureConfigured()&&this.instance)return this.instance.startOfflineRecording(...e)}uploadOfflineRecording(){if(ed&&this.ensureConfigured()&&this.instance)return this.instance.uploadOfflineRecording()}forceFlushBatch(){if(ed&&this.ensureConfigured()&&this.instance)return this.instance.forceFlushBatch()}getSessionInfo(){return ed&&this.ensureConfigured()&&this.instance?this.instance.getSessionInfo():null}getTabId(){return ed&&this.ensureConfigured()&&this.instance?this.instance.getTabId():null}getUxId(){return ed&&this.ensureConfigured()&&this.instance?this.instance.getUxId():null}}let nw=new nS}}]);