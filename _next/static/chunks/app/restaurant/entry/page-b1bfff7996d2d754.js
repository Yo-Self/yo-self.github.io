(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[687],{2802:function(e,t,n){Promise.resolve().then(n.bind(n,2245))},2245:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return x}});var i=n(7437),a=n(2265),r=n(6463),o=n(8768),s=n(357);let l=new Map;function c(){return Math.floor(Date.now()/1e3)}function u(e){let t=l.get(e);if(t&&t.expiresAt>c())return t.value;try{let t=localStorage.getItem(e);if(t){let n=JSON.parse(t);if(n.expiresAt>c())return l.set(e,n),n.value}}catch(e){}return null}function d(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:90,i={value:t,expiresAt:c()+n};l.set(e,i);try{localStorage.setItem(e,JSON.stringify(i))}catch(e){}}function m(e){return null==e||Number.isNaN(e)?"0,00":(Math.round(100*e)/100).toFixed(2).replace(".",",")}let p=s.env.NEXT_PUBLIC_SUPABASE_URL||"https://wulazaggdihidadkhilg.supabase.co",g=s.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind1bGF6YWdnZGloaWRhZGtoaWxnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ0NzkxODQsImV4cCI6MjA3MDA1NTE4NH0.MxXnFZAUoMPCy9LJFTWv_6-X_8AmLr553wrAhoeRrOQ",f="".concat(p,"/rest/v1");async function _(e,t){var n;let i=await fetch("".concat(f,"/").concat(e),{...t,headers:{apikey:g,Authorization:"Bearer ".concat(g),...(null==t?void 0:t.headers)||{}},cache:null!==(n=null==t?void 0:t.cache)&&void 0!==n?n:"force-cache"});if(!i.ok){let e=await i.text().catch(()=>"");throw Error("Supabase REST error ".concat(i.status,": ").concat(e))}return i.json()}async function h(){let e="sb:restaurants",t=u(e);if(t)return t;let n=await _("restaurants?select=*&order=created_at.asc");return d(e,null!=n?n:[]),null!=n?n:[]}async function v(e){let t="sb:categories:".concat(e),n=u(t);if(n)return n;let i=await _("categories?select=*&restaurant_id=eq.".concat(encodeURIComponent(String(e)),"&order=name.asc"));return d(t,i),i}async function w(e){let t="sb:dishes:".concat(e),n=u(t);if(n)return n;let i=await _("dishes?select=*&restaurant_id=eq.".concat(encodeURIComponent(String(e)),"&is_available=eq.true&order=category_id.asc"));return d(t,i),i}async function y(e){if(0===e.length)return[];let t=e.map(e=>encodeURIComponent(e)).join(","),n=await _("complement_groups?select=*&dish_id=in.(".concat(t,")&order=position.asc"));return null!=n?n:[]}async function S(e){if(0===e.length)return[];let t=e.map(e=>encodeURIComponent(e)).join(","),n=await _("complements?select=*&group_id=in.(".concat(t,")&order=position.asc"));return null!=n?n:[]}function I(e,t,n,i,a){let r=new Map;for(let e of t)r.set(e.id,e.name);let o=new Map;for(let e of i){let t=o.get(e.dish_id)||[];t.push(e),o.set(e.dish_id,t)}let s=new Map;for(let e of a){let t=s.get(e.group_id)||[];t.push(e),s.set(e.group_id,t)}let l=n.map(e=>{var t,n,i,a;let l=(o.get(String(e.id))||[]).map(e=>({title:e.title,description:e.description||"",required:e.required,max_selections:e.max_selections,complements:(s.get(e.id)||[]).map(e=>({name:e.name,description:e.description||"",price:m(e.price),image:e.image_url||"",ingredients:e.ingredients||""}))}));return{category:null!=e.category_id&&null!==(t=r.get(e.category_id))&&void 0!==t?t:"Sem categoria",name:null!==(n=e.name)&&void 0!==n?n:"",description:null!==(i=e.description)&&void 0!==i?i:"",price:m(e.price),image:null!==(a=e.image_url)&&void 0!==a?a:"",tags:e.tags&&Array.isArray(e.tags)?e.tags:[],ingredients:e.ingredients||"",allergens:e.allergens||"Nenhum",portion:e.portion||"Serve 1 pessoa",complement_groups:l.length>0?l:void 0}}),c=n.filter(e=>!!e.is_featured&&!!e.is_available).map(e=>{var t,n,i,a;return{name:null!==(t=e.name)&&void 0!==t?t:"",description:null!==(n=e.description)&&void 0!==n?n:"",price:m(e.price),image:null!==(i=e.image_url)&&void 0!==i?i:"",tags:e.tags&&e.tags.length?e.tags:["Destaque"],ingredients:e.ingredients||"",allergens:e.allergens||"Nenhum",portion:e.portion||"Serve 1 pessoa",category:null!=e.category_id&&null!==(a=r.get(e.category_id))&&void 0!==a?a:"Sem categoria",complement_groups:(o.get(String(e.id))||[]).map(e=>({title:e.title,description:e.description||"",required:e.required,max_selections:e.max_selections,complements:(s.get(e.id)||[]).map(e=>({name:e.name,description:e.description||"",price:m(e.price),image:e.image_url||"",ingredients:e.ingredients||""}))}))}});return{id:String(e.id),name:e.name,welcome_message:e.description||"Bem-vindo ao ".concat(e.name),image:e.image_url||"",menu_categories:t.map(e=>e.name),featured_dishes:c,menu_items:l}}async function N(){let e=await h(),t=[];for(let n of e){let[e,i]=await Promise.all([v(n.id),w(n.id)]),a=i.map(e=>String(e.id)),[r,o]=await Promise.all([y(a),(async()=>S((await y(a)).map(e=>e.id)))()]);t.push(I(n,e,i,r,o))}return t}async function A(e){if("[id]"===e)return null;let t=await _("restaurants?select=*&id=eq.".concat(encodeURIComponent(e),"&limit=1")),n=t&&t[0];if(!n)return null;let[i,a]=await Promise.all([v(n.id),w(n.id)]),r=a.map(e=>String(e.id)),o=await y(r),s=o.map(e=>e.id);return I(n,i,a,o,await S(s))}function b(){let e=(0,r.useSearchParams)().get("id")||"",[t,n]=(0,a.useState)(null),[s,l]=(0,a.useState)([]);return((0,a.useEffect)(()=>{if(!e)return;let t=!1;return(async()=>{try{let[i,a]=await Promise.all([A(e),N().catch(()=>[])]);t||(n(i),l(a))}catch(e){t||(n(null),l([]))}})(),()=>{t=!0}},[e]),e&&t)?(0,i.jsx)(o.default,{initialRestaurant:t,restaurants:s}):null}function x(){return(0,i.jsx)(a.Suspense,{fallback:null,children:(0,i.jsx)(b,{})})}}},function(e){e.O(0,[447,768,971,23,744],function(){return e(e.s=2802)}),_N_E=e.O()}]);