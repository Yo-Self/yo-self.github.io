(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[687],{2802:function(e,t,n){Promise.resolve().then(n.bind(n,420))},420:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return E}});var i=n(7437),r=n(2265),a=n(9376),o=n(4443),s=n(257);let l=new Map;function c(){return Math.floor(Date.now()/1e3)}function u(e){let t=l.get(e);if(t&&t.expiresAt>c())return t.value;try{let t=localStorage.getItem(e);if(t){let n=JSON.parse(t);if(n.expiresAt>c())return l.set(e,n),n.value}}catch(e){}return null}function p(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:90,i={value:t,expiresAt:c()+n};l.set(e,i);try{localStorage.setItem(e,JSON.stringify(i))}catch(e){}}function d(e){return null==e||Number.isNaN(e)?"0,00":(Math.round(100*e)/100).toFixed(2).replace(".",",")}async function m(e,t){var n;if("true"===s.env.DISABLE_API_CALLS)throw console.log("\uD83E\uDDEA Test mode: API calls disabled"),Error("API calls disabled in test mode");let i=function(){let e="https://wulazaggdihidadkhilg.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind1bGF6YWdnZGloaWRhZGtoaWxnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ0NzkxODQsImV4cCI6MjA3MDA1NTE4NH0.MxXnFZAUoMPCy9LJFTWv_6-X_8AmLr553wrAhoeRrOQ";return e&&t?{SUPABASE_URL:e,SUPABASE_ANON_KEY:t}:(console.warn("NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY must be defined in environment variables"),null)}();if(!i)throw Error("Supabase configuration not available");let{SUPABASE_URL:r,SUPABASE_ANON_KEY:a}=i,o="".concat("".concat(r,"/rest/v1"),"/").concat(e),l=await fetch(o,{...t,headers:{apikey:a,Authorization:"Bearer ".concat(a),...(null==t?void 0:t.headers)||{}},cache:null!==(n=null==t?void 0:t.cache)&&void 0!==n?n:"default"});if(!l.ok){let e=await l.text().catch(()=>"");throw Error("Supabase REST error ".concat(l.status,": ").concat(e))}return await l.json()}async function g(){let e="sb:restaurants",t=u(e);if(t)return t;let n=await m("restaurants?select=*&order=created_at.asc");return p(e,null!=n?n:[]),null!=n?n:[]}async function _(e){let t="sb:categories:".concat(e),n=u(t);if(n)return n;let i=await m("categories?select=*&restaurant_id=eq.".concat(encodeURIComponent(String(e)),"&order=position.asc"));return p(t,i),i}async function f(e){let t="sb:dishes:".concat(e),n=u(t);if(n)return n;let i=await m("dishes?select=*&restaurant_id=eq.".concat(encodeURIComponent(String(e)),"&is_available=eq.true&order=created_at.asc"));return p(t,i),i}async function h(e){if(0===e.length)return[];let t=e.map(e=>encodeURIComponent(e)).join(","),n=await m("dish_categories?select=*&dish_id=in.(".concat(t,")&order=position.asc"));return null!=n?n:[]}async function w(e){if(0===e.length)return{groups:[],associations:new Map};try{let t=e.map(e=>encodeURIComponent(e)).join(","),n=await m("dish_complement_groups?select=dish_id,complement_group_id,position&dish_id=in.(".concat(t,")"));if(!n||0===n.length)return{groups:[],associations:new Map};let i=new Map;for(let e of n){let t=e.dish_id,n=e.complement_group_id,r=e.position,a=i.get(t)||[];a.push({groupId:n,position:r}),i.set(t,a)}let r=[...new Set(n.map(e=>e.complement_group_id))].map(e=>encodeURIComponent(e)).join(","),a=await m("complement_groups?select=*&id=in.(".concat(r,")"));return{groups:null!=a?a:[],associations:i}}catch(e){return console.error("Erro ao buscar complement groups:",e),{groups:[],associations:new Map}}}async function S(e){if(0===e.length)return[];let t=e.map(e=>encodeURIComponent(e)).join(","),n=await m("complements?select=*&group_id=in.(".concat(t,")&is_active=eq.true&order=position.asc"));return null!=n?n:[]}function v(e,t,n,i,r,a,o){let s=new Map;for(let e of t)s.set(e.id,e.name);let l=new Map;for(let e of i){let t=s.get(e.category_id)||"Sem categoria",n=l.get(e.dish_id)||[];n.push(t),l.set(e.dish_id,n)}let c=new Map;for(let e of i){let t=c.get(e.dish_id);(void 0===t||e.position<t)&&c.set(e.dish_id,e.position)}let u=new Map,p=new Map;for(let e of r)p.set(e.id,e);for(let[e,t]of o.entries()){let n=[];for(let{groupId:e,position:i}of t){let t=p.get(e);t&&n.push({group:t,position:i})}n.sort((e,t)=>null!==e.position&&null!==t.position?e.position!==t.position?e.position-t.position:e.group.title.localeCompare(t.group.title):null!==e.position&&null===t.position?-1:null===e.position&&null!==t.position?1:e.group.title.localeCompare(t.group.title));let i=n.map(e=>e.group);i.length>0&&u.set(e,i)}let m=new Map;for(let e of a){let t=m.get(e.group_id)||[];t.push(e),m.set(e.group_id,t)}let g=n.filter(e=>e.name&&""!==e.name.trim()).map(e=>{var t,n,i,r,a;let o=l.get(String(e.id))||[],p=o.length>0?o[0]:null!=e.category_id&&null!==(t=s.get(e.category_id))&&void 0!==t?t:"Sem categoria",g=(u.get(String(e.id))||[]).map(e=>({title:e.title,description:e.description||"",required:e.required,max_selections:e.max_selections,complements:(m.get(e.id)||[]).map(e=>({name:e.name,description:e.description||"",price:d(e.price),image:e.image_url||"",ingredients:e.ingredients||""}))}));return{categories:o.length>0?o:[p],category:p,name:null!==(n=e.name)&&void 0!==n?n:"",description:null!==(i=e.description)&&void 0!==i?i:"",price:d(e.price),image:null!==(r=e.image_url)&&void 0!==r?r:"",tags:e.tags&&Array.isArray(e.tags)?e.tags:[],ingredients:e.ingredients||"",allergens:e.allergens||"Nenhum",portion:e.portion||"Serve 1 pessoa",complement_groups:g.length>0?g:void 0,_position:null!==(a=c.get(String(e.id)))&&void 0!==a?a:Number.MAX_SAFE_INTEGER}}).sort((e,t)=>e._position!==t._position?e._position-t._position:e.name.localeCompare(t.name)).map(e=>{let{_position:t,...n}=e;return n}),_=n.filter(e=>!!e.is_featured&&!!e.is_available&&e.name&&""!==e.name.trim()).map(e=>{var t,n,i,r,a;let o=l.get(String(e.id))||[],p=o.length>0?o[0]:null!=e.category_id&&null!==(t=s.get(e.category_id))&&void 0!==t?t:"Sem categoria";return{name:null!==(n=e.name)&&void 0!==n?n:"",description:null!==(i=e.description)&&void 0!==i?i:"",price:d(e.price),image:null!==(r=e.image_url)&&void 0!==r?r:"",tags:e.tags&&e.tags.length?e.tags:["Destaque"],ingredients:e.ingredients||"",allergens:e.allergens||"Nenhum",portion:e.portion||"Serve 1 pessoa",categories:o.length>0?o:[p],category:p,complement_groups:(u.get(String(e.id))||[]).map(e=>({title:e.title,description:e.description||"",required:e.required,max_selections:e.max_selections,complements:(m.get(e.id)||[]).map(e=>({name:e.name,description:e.description||"",price:d(e.price),image:e.image_url||"",ingredients:e.ingredients||""}))})),_position:null!==(a=c.get(String(e.id)))&&void 0!==a?a:Number.MAX_SAFE_INTEGER}}).sort((e,t)=>e._position!==t._position?e._position-t._position:e.name.localeCompare(t.name)).map(e=>{let{_position:t,...n}=e;return n}).filter(e=>e.name&&""!==e.name.trim());return{id:String(e.id),slug:e.slug||String(e.id),name:e.name,welcome_message:e.description||"Bem-vindo ao ".concat(e.name),image:e.image_url||"",waiter_call_enabled:!0===e.waiter_call_enabled,whatsapp_phone:e.whatsapp_phone,whatsapp_enabled:!1!==e.whatsapp_enabled,whatsapp_custom_message:e.whatsapp_custom_message,menu_categories:t.map(e=>e.name),featured_dishes:_,menu_items:g}}async function I(){try{let e=await g(),t=[];for(let n of e){let[e,i]=await Promise.all([_(n.id),f(n.id)]),r=i.map(e=>String(e.id)),[a,o,s]=await Promise.all([h(r),w(r),(async()=>{let e=(await w(r)).groups.map(e=>e.id);return S(e)})()]),l=o.groups;t.push(v(n,e,i,a,l,s,o.associations))}return t}catch(e){return console.error("Erro ao buscar restaurantes:",e),[]}}async function y(e){if("[id]"===e)return null;try{let t=await m("restaurants?select=*&id=eq.".concat(encodeURIComponent(e),"&limit=1")),n=t&&t[0];if(!n)return null;let[i,r]=await Promise.all([_(n.id),f(n.id)]),a=r.map(e=>String(e.id)),[o,s]=await Promise.all([h(a),w(a)]),l=s.groups.map(e=>e.id),c=await S(l);return v(n,i,r,o,s.groups,c,s.associations)}catch(e){return console.error("Erro ao buscar restaurante por ID:",e),null}}function b(){let e=(0,a.useSearchParams)().get("id")||"",[t,n]=(0,r.useState)(null),[s,l]=(0,r.useState)([]);return((0,r.useEffect)(()=>{if(!e)return;let t=!1;return(async()=>{try{let[i,r]=await Promise.all([y(e),I().catch(()=>[])]);t||(n(i),l(r))}catch(e){t||(n(null),l([]))}})(),()=>{t=!0}},[e]),e&&t)?(0,i.jsx)(o.default,{initialRestaurant:t,restaurants:s}):null}function E(){return(0,i.jsx)(r.Suspense,{fallback:null,children:(0,i.jsx)(b,{})})}}},function(e){e.O(0,[475,189,932,678,443,971,117,744],function(){return e(e.s=2802)}),_N_E=e.O()}]);