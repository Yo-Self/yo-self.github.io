"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[276],{2276:function(e,a,r){r.r(a),r.d(a,{default:function(){return l}});var t=r(7437),n=r(2265),o=r(8783);function l(e){let{restaurantId:a,waiterCallEnabled:r=!1,className:l="",...s}=e,[i,c]=(0,n.useState)(!1),[d,u]=(0,n.useState)(!1),[m,h]=(0,n.useState)(""),[f,g]=(0,n.useState)(""),[b,y]=(0,n.useState)(!1),{createCall:p,error:x,clearError:w}=function(){let[e,a]=(0,n.useState)([]),[r,t]=(0,n.useState)(!1),[o,l]=(0,n.useState)(null),s=(0,n.useCallback)(()=>{l(null)},[]);return{calls:e,isLoading:r,error:o,createCall:(0,n.useCallback)(async(e,r,n)=>{t(!0),l(null);try{let t="https://wulazaggdihidadkhilg.supabase.co",o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind1bGF6YWdnZGloaWRhZGtoaWxnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ0NzkxODQsImV4cCI6MjA3MDA1NTE4NH0.MxXnFZAUoMPCy9LJFTWv_6-X_8AmLr553wrAhoeRrOQ";if(!t||!o)return console.warn("Configura\xe7\xe3o do Supabase n\xe3o encontrada - funcionalidade de chamada de gar\xe7om desabilitada"),null;let l=await fetch("".concat(t,"/functions/v1/waiter-calls"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)},body:JSON.stringify({restaurant_id:e,table_number:r,notes:n||null})}),s=await l.json();if(!l.ok){if(409===l.status)throw Error(s.error||"J\xe1 existe uma chamada pendente para esta mesa");throw Error(s.error||"Erro ao criar chamada de gar\xe7om")}if(s.success&&s.call)return a(e=>[s.call,...e]),s.call;return null}catch(e){return l(e instanceof Error?e.message:"Erro desconhecido"),null}finally{t(!1)}},[]),fetchCalls:(0,n.useCallback)(async function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pending";t(!0),l(null);try{let t="https://wulazaggdihidadkhilg.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind1bGF6YWdnZGloaWRhZGtoaWxnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ0NzkxODQsImV4cCI6MjA3MDA1NTE4NH0.MxXnFZAUoMPCy9LJFTWv_6-X_8AmLr553wrAhoeRrOQ";if(!t||!n)return console.warn("Configura\xe7\xe3o do Supabase n\xe3o encontrada - funcionalidade de chamada de gar\xe7om desabilitada"),[];let o="".concat(t,"/functions/v1/waiter-calls?restaurant_id=").concat(e,"&status=").concat(r),l=await fetch(o,{method:"GET",headers:{Authorization:"Bearer ".concat(n)}}),s=await l.json();if(!l.ok)throw Error(s.error||"Erro ao buscar chamadas de gar\xe7om");if(s.success&&s.calls)return a(s.calls),s.calls;return[]}catch(e){return l(e instanceof Error?e.message:"Erro desconhecido"),[]}finally{t(!1)}},[]),updateCall:(0,n.useCallback)(async(e,r,n,o)=>{t(!0),l(null);try{let t="https://wulazaggdihidadkhilg.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind1bGF6YWdnZGloaWRhZGtoaWxnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ0NzkxODQsImV4cCI6MjA3MDA1NTE4NH0.MxXnFZAUoMPCy9LJFTWv_6-X_8AmLr553wrAhoeRrOQ";if(!t||!l)return console.warn("Configura\xe7\xe3o do Supabase n\xe3o encontrada - funcionalidade de chamada de gar\xe7om desabilitada"),null;let s=await fetch("".concat(t,"/functions/v1/waiter-calls"),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(l)},body:JSON.stringify({call_id:e,status:r,attended_by:n||null,notes:o||null})}),i=await s.json();if(!s.ok)throw Error(i.error||"Erro ao atualizar chamada de gar\xe7om");if(i.success&&i.call)return a(a=>a.map(a=>a.id===e?i.call:a)),i.call;return null}catch(e){return l(e instanceof Error?e.message:"Erro desconhecido"),null}finally{t(!1)}},[]),clearError:s}}(),k=(0,n.useRef)(null),v=(0,n.useRef)(null),j=(0,n.useRef)(null);if((0,o.y)(i),!r)return null;let I=async e=>{if(e.preventDefault(),!m.trim()){alert("Por favor, informe o n\xfamero da mesa");return}let r=parseInt(m);if(isNaN(r)||r<=0){alert("Por favor, informe um n\xfamero de mesa v\xe1lido");return}y(!0),w();try{await p(a,r,f.trim()||void 0)?(await E(),alert("Chamada de gar\xe7om enviada com sucesso!"),u(!0),setTimeout(()=>{c(!1),u(!1),h(""),g("")},250)):alert("Erro ao enviar chamada de gar\xe7om. Tente novamente.")}catch(e){console.error("Error creating waiter call:",e)}finally{y(!1)}},N=()=>{u(!0),setTimeout(()=>{c(!1),u(!1),h(""),g(""),w()},250)},C=()=>{if(!v.current)try{v.current=new(window.AudioContext||window.webkitAudioContext)}catch(e){}},z=async()=>{if(v.current&&!j.current)try{let e=await fetch("/restaurant-bell.mp3"),a=await e.arrayBuffer();j.current=await v.current.decodeAudioData(a)}catch(e){}},M=()=>{if(!v.current)return null;try{let e=v.current.sampleRate,a=Math.floor(2*e),r=v.current.createBuffer(1,a,e),t=r.getChannelData(0),n=[{freq:800,amplitude:1,decay:.1},{freq:1600,amplitude:.5,decay:.15},{freq:2400,amplitude:.3,decay:.2},{freq:3200,amplitude:.2,decay:.25}];for(let r=0;r<a;r++){let a=r/e,o=0;n.forEach(e=>{let r=Math.exp(-a/e.decay);o+=e.amplitude*r*Math.sin(2*Math.PI*e.freq*a)});let l=Math.exp(-a/.5);t[r]=o*l*.3}return r}catch(e){return null}},E=async()=>{try{if(k.current){if(k.current.src&&""!==k.current.src||(k.current.src="/restaurant-bell.mp3"),k.current.readyState<2)throw Error("Audio not ready");k.current.muted=!1,k.current.volume=.5,k.current.currentTime=0;let e=k.current.play();try{await Promise.race([e,new Promise((e,a)=>setTimeout(()=>a(Error("HTML Audio timeout")),1e3))]);return}catch(e){}}}catch(e){}try{if(C(),await z(),v.current&&j.current){let e=v.current.createBufferSource();e.buffer=j.current,e.connect(v.current.destination),e.start(0);return}{let e=M();if(e&&v.current){let a=v.current.createBufferSource();a.buffer=e,a.connect(v.current.destination),a.start(0);return}}}catch(e){}},J=async()=>{let e=document.querySelector("[data-waiter-button]");e&&(e.style.transform="scale(0.95)",setTimeout(()=>{e.style.transform="scale(1)"},150)),c(!0)};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("audio",{ref:k,preload:"auto",muted:!0,src:"/restaurant-bell.mp3",children:"Seu navegador n\xe3o suporta o elemento de \xe1udio."}),(0,t.jsx)("button",{onClick:J,className:"".concat(l||"w-8 h-8 rounded-full bg-white/80 hover:bg-white/90 dark:!bg-gray-900/80 dark:hover:!bg-gray-900/90 border-2 border-white/60 dark:!border-gray-800/60 shadow-lg backdrop-blur-sm flex items-center justify-center"," transition-all duration-200 hover:scale-110 active:scale-95 hover:shadow-xl"),"aria-label":"Chamar gar\xe7om",title:"Chamar gar\xe7om","data-waiter-button":!0,...s,children:(0,t.jsx)("svg",{width:"55",height:"55",viewBox:"0 0 258 234",fill:"none",style:{display:"block"},children:(0,t.jsxs)("g",{transform:"translate(0.000000,234.000000) scale(0.100000,-0.100000)",className:"fill-gray-700 dark:fill-white",stroke:"none",children:[(0,t.jsx)("path",{d:"M2014 2098 c-34 -34 -131 -98 -319 -210 -303 -181 -982 -644 -1003 -684 -29 -56 21 -134 87 -134 31 0 83 33 351 219 l315 219 40 -28 c22 -15 73 -46 114 -71 l74 -43 -189 -182 c-186 -180 -189 -182 -189 -224 0 -35 6 -47 33 -71 23 -20 43 -29 68 -29 32 0 52 17 231 188 187 179 197 187 243 193 147 20 360 229 360 355 0 28 12 44 89 116 l89 83 -173 176 -173 177 -48 -50z m196 -150 c77 -78 140 -146 140 -151 0 -13 -129 -135 -136 -128 -3 3 -4 2 -3 -4 6 -23 -36 -151 -59 -177 -8 -10 -13 -18 -10 -18 10 0 -95 -105 -138 -138 -23 -18 -51 -32 -62 -32 -12 0 -23 -4 -27 -9 -3 -5 -29 -15 -58 -21 -42 -9 -63 -21 -112 -68 -269 -255 -323 -302 -349 -302 -31 0 -66 32 -66 60 0 22 82 117 142 165 20 17 37 36 37 43 1 6 5 12 10 12 16 0 171 163 171 180 0 9 -9 26 -20 38 -21 22 -135 92 -151 92 -5 0 -9 4 -9 8 0 11 -45 32 -67 32 -17 0 -35 -11 -146 -86 -32 -21 -65 -43 -74 -49 -9 -5 -26 -18 -37 -28 -11 -10 -31 -20 -43 -23 -13 -4 -23 -10 -23 -14 0 -5 -33 -30 -72 -56 -40 -27 -75 -50 -78 -54 -3 -3 -27 -21 -55 -39 -27 -19 -53 -40 -57 -45 -4 -6 -8 -7 -8 -2 0 5 -8 2 -17 -6 -34 -30 -61 -31 -88 -4 -46 46 -31 71 90 154 34 23 64 42 67 42 7 0 45 30 84 66 12 12 25 20 28 17 3 -3 12 2 21 10 9 9 64 49 123 88 59 39 126 87 150 106 23 19 42 32 42 28 0 -3 12 6 27 20 15 14 31 25 35 25 4 0 32 16 62 35 30 19 58 35 61 35 4 0 25 13 48 29 50 34 145 91 153 91 5 0 64 40 74 50 3 3 23 14 45 26 81 42 105 58 164 111 20 18 40 33 44 33 4 0 71 -64 147 -142z"}),(0,t.jsx)("path",{d:"M1338 1402 c-94 -65 -98 -69 -124 -135 -36 -90 -29 -105 66 -140 l72 -27 69 63 c38 34 69 64 69 67 0 3 -20 12 -45 19 -25 7 -45 16 -45 20 0 4 16 47 35 96 51 130 42 133 -97 37z m66 -24 c-4 -13 -11 -34 -17 -48 -17 -43 -15 -63 10 -87 12 -13 23 -28 23 -32 0 -19 -72 -72 -89 -66 -9 4 -29 12 -46 17 -53 19 -60 30 -44 83 15 49 41 79 110 124 54 36 62 37 53 9z"}),(0,t.jsx)("path",{d:"M1463 1361 l-30 -79 41 -16 41 -16 43 44 44 44 -52 17 c-41 13 -50 20 -45 34 11 26 11 44 -1 48 -6 2 -25 -32 -41 -76z m51 -27 c17 -7 10 -34 -9 -34 -17 0 -28 17 -20 30 7 12 8 12 29 4z"}),(0,t.jsx)("path",{d:"M1802 1178 c-31 -33 -31 -33 -13 -57 l19 -24 26 26 c17 17 26 37 26 57 0 39 -18 39 -58 -2z"}),(0,t.jsx)("path",{d:"M1680 1060 c-35 -32 -62 -62 -58 -66 4 -3 28 -9 53 -12 38 -4 50 -1 70 18 13 12 26 32 29 45 6 25 -8 75 -21 75 -5 -1 -37 -27 -73 -60z"}),(0,t.jsx)("path",{d:"M693 994 c-9 -24 15 -35 72 -32 42 3 50 6 50 23 0 17 -8 20 -58 23 -46 2 -59 0 -64 -14z"}),(0,t.jsx)("path",{d:"M710 910 c0 -5 20 -10 45 -10 25 0 45 5 45 10 0 6 -20 10 -45 10 -25 0 -45 -4 -45 -10z"}),(0,t.jsx)("path",{d:"M625 866 c-61 -20 -136 -60 -181 -100 -84 -72 -163 -226 -134 -261 18 -22 871 -22 889 -1 18 21 4 77 -36 143 -93 156 -231 234 -411 232 -48 0 -105 -6 -127 -13z m230 -28 c22 -5 68 -23 102 -39 94 -46 199 -168 210 -246 l4 -23 -411 0 c-347 0 -411 2 -416 14 -6 15 23 86 35 86 3 0 12 12 19 28 18 39 30 52 97 103 66 50 118 74 186 84 24 4 46 9 48 11 5 5 72 -5 126 -18z"}),(0,t.jsx)("path",{d:"M530 448 l0 -23 225 0 225 0 0 23 0 22 -225 0 -225 0 0 -22z"}),(0,t.jsx)("path",{d:"M312 388 c-13 -17 -48 -146 -40 -153 7 -7 959 -7 967 0 7 8 -26 135 -40 152 -16 19 -871 19 -887 1z m862 -40 c24 -38 30 -70 15 -79 -18 -11 -850 -11 -868 0 -11 7 -11 15 -1 45 6 20 19 40 28 46 10 6 174 10 414 10 l398 0 14 -22z"})]})})}),i&&(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 transition-all duration-300 ".concat(d?"animate-waiter-backdrop-close":"animate-waiter-backdrop-open"),style:{background:d?"rgba(0, 0, 0, 0.3)":"rgba(0, 0, 0, 0.5)",backdropFilter:d?"blur(4px)":"blur(8px)"},children:(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-900 rounded-2xl shadow-xl max-w-md w-full p-6 waiter-modal-transition ".concat(d?"animate-waiter-modal-close":"animate-waiter-modal-open"),children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4 transform transition-all duration-300 delay-25",style:{animation:d?"none":"fadeInUp 0.4s ease-out forwards"},children:[(0,t.jsx)("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:"Chamar Gar\xe7om"}),(0,t.jsx)("button",{onClick:N,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-all duration-200 hover:scale-110 active:scale-95 p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800","aria-label":"Fechar",children:(0,t.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,t.jsxs)("form",{onSubmit:I,className:"space-y-4",children:[(0,t.jsxs)("div",{className:"transform transition-all duration-300 delay-75",style:{animation:d?"none":"fadeInUp 0.4s ease-out forwards"},children:[(0,t.jsx)("label",{htmlFor:"tableNumber",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"N\xfamero da Mesa *"}),(0,t.jsx)("input",{type:"number",id:"tableNumber",value:m,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 transition-all duration-200 hover:border-orange-400 focus:border-orange-500",placeholder:"Ex: 5",min:"1",required:!0})]}),(0,t.jsxs)("div",{className:"transform transition-all duration-300 delay-150",style:{animation:d?"none":"fadeInUp 0.4s ease-out forwards"},children:[(0,t.jsx)("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Observa\xe7\xf5es (opcional)"}),(0,t.jsx)("textarea",{id:"notes",value:f,onChange:e=>g(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 transition-all duration-200 hover:border-orange-400 focus:border-orange-500",placeholder:"Ex: Preciso de mais \xe1gua, tem alguma d\xfavida sobre o card\xe1pio...",rows:3})]}),x&&(0,t.jsx)("div",{className:"p-3 bg-red-100 dark:bg-red-900/30 border border-red-300 dark:border-red-700 rounded-lg",children:(0,t.jsx)("p",{className:"text-sm text-red-700 dark:text-red-300",children:x})}),(0,t.jsxs)("div",{className:"flex gap-3 pt-2 transform transition-all duration-300 delay-200",style:{animation:d?"none":"fadeInUp 0.4s ease-out forwards"},children:[(0,t.jsx)("button",{type:"button",onClick:N,className:"flex-1 px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-all duration-200 hover:scale-105 active:scale-95",disabled:b,children:"Cancelar"}),(0,t.jsx)("button",{type:"submit",className:"flex-1 px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-all duration-200 disabled:bg-orange-400 disabled:cursor-not-allowed hover:scale-105 active:scale-95 hover:shadow-lg",disabled:b,children:b?(0,t.jsxs)("div",{className:"flex items-center justify-center",children:[(0,t.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Enviando..."]}):"Chamar Gar\xe7om"})]})]})]})})]})}}}]);